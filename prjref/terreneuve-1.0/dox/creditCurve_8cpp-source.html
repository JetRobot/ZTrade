<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>creditCurve.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>creditCurve.cpp</h1><a href="creditCurve_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include ".\creditCurve.h"</span>
00002 <span class="preprocessor">#include "..\common\utils.h"</span>
00003 <span class="preprocessor">#include &lt;cmath&gt;</span>
00004 
<a name="l00005"></a><a class="code" href="classCreditSpreadPoint.html#a0">00005</a> <a class="code" href="classCreditSpreadPoint.html#a0">CreditSpreadPoint::CreditSpreadPoint</a>(<span class="keywordtype">void</span>) : 
00006         _rate(0), _maturity(0), _spreadtype(<a class="code" href="creditCurve_8h.html#a7a6">Relative</a>) { }
<a name="l00007"></a><a class="code" href="classCreditSpreadPoint.html#a1">00007</a> <a class="code" href="classCreditSpreadPoint.html#a0">CreditSpreadPoint::CreditSpreadPoint</a>(<a class="code" href="types_8h.html#a10">Real</a> r, <a class="code" href="types_8h.html#a10">Real</a> T, CreditSpreadType t) : 
00008         _rate(<a class="code" href="ParkMiller_8h.html#a3">r</a>), _maturity(T), _spreadtype(t) { }
<a name="l00009"></a><a class="code" href="classCreditSpreadPoint.html#a2">00009</a> <a class="code" href="classCreditSpreadPoint.html#a2">CreditSpreadPoint::~CreditSpreadPoint</a>(<span class="keywordtype">void</span>) { }
00010 
<a name="l00011"></a><a class="code" href="classCreditSpreadPoint.html#e0">00011</a> <span class="keywordtype">char</span> *<a class="code" href="classCreditSpreadPoint.html#e0">CreditSpreadPoint::TypeAsString</a>(CreditSpreadType t)
00012 {
00013         <span class="keywordflow">switch</span> (t) {
00014                 <span class="keywordflow">case</span> <a class="code" href="creditCurve_8h.html#a7a5">Absolute</a>:
00015                         <span class="keywordflow">return</span> <span class="stringliteral">"Abs"</span>;
00016                 <span class="keywordflow">case</span> <a class="code" href="creditCurve_8h.html#a7a6">Relative</a>:
00017                         <span class="keywordflow">return</span> <span class="stringliteral">"Rel"</span>;
00018                 <span class="keywordflow">default</span>:
00019                         <span class="keywordflow">return</span> <span class="stringliteral">"No spread type has been defined"</span>;
00020         }
00021 }
00022 
00023 
<a name="l00024"></a><a class="code" href="classcreditCurve.html#a0">00024</a> <a class="code" href="classcreditCurve.html#a0">creditCurve::creditCurve</a>(<span class="keywordtype">void</span>) :
00025  <a class="code" href="classyieldCurve.html">yieldCurve</a>(),
00026  _spreads(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00027  _survivalProbability(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00028  _defaultProbability(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00029  _swapFees(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>) {
00030 }
00031 
<a name="l00032"></a><a class="code" href="classcreditCurve.html#a2">00032</a> <a class="code" href="classcreditCurve.html#a0">creditCurve::creditCurve</a>(<a class="code" href="classyieldCurve.html">yieldCurve</a> &amp;yc, 
00033                                                  valarray&lt;CreditSpreadPoint&gt; &amp;cp, 
00034                                                  <span class="keywordtype">char</span> *name,
00035                                                  <a class="code" href="types_8h.html#a10">Real</a> recoveryRate,
00036                                                  Currency currency,
00037                                                  Frequency frequency) :
00038 _spreads(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00039 _survivalProbability(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00040 _defaultProbability(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00041 _swapFees(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00042 _recoveryRate(recoveryRate),
00043 _currency(currency),
00044 _frequency(frequency) {
00045 
00046         <span class="comment">// make a local copy of the underlying yieldcurve - its ours now!</span>
00047         <a class="code" href="classcreditCurve.html#p0">_underlying</a> = <span class="keyword">new</span> <a class="code" href="classyieldCurve.html#a0">yieldCurve</a>(yc);       
00048         yieldCurve *spreadCurve = <a class="code" href="classcreditCurve.html#a8">createSpreadCurve</a>(*<a class="code" href="classcreditCurve.html#p0">_underlying</a>, cp);
00049         <a class="code" href="classcreditCurve.html#p1">_combined</a> = <a class="code" href="classcreditCurve.html#a9">combineUnderlyingAndSpreads</a>(*<a class="code" href="classcreditCurve.html#p0">_underlying</a>, *spreadCurve);
00050         <a class="code" href="classcreditCurve.html#a11">resampleSpread</a>();
00051 
00052         <span class="keyword">delete</span> spreadCurve;
00053 }
00054 
<a name="l00055"></a><a class="code" href="classcreditCurve.html#a3">00055</a> <a class="code" href="classcreditCurve.html#a0">creditCurve::creditCurve</a>(<a class="code" href="types_8h.html#a10">Real</a> flatRate,
00056                                                  <a class="code" href="types_8h.html#a10">Real</a> flatSpread,
00057                                                  <span class="keywordtype">char</span> *name,
00058                                                  <a class="code" href="types_8h.html#a10">Real</a> recoveryRate,
00059                                                  Currency currency,
00060                                                  Frequency frequency) :
00061 _spreads(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00062 _survivalProbability(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00063 _defaultProbability(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00064 _swapFees(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00065 _recoveryRate(recoveryRate),
00066 _currency(currency),
00067 _frequency(frequency) {
00068 
00069         <a class="code" href="classcreditCurve.html#p0">_underlying</a> = <span class="keyword">new</span> <a class="code" href="classyieldCurve.html#a0">yieldCurve</a>(flatRate);
00070         yieldCurve *spreadCurve = <span class="keyword">new</span> <a class="code" href="classyieldCurve.html#a0">yieldCurve</a>(flatSpread);
00071         <a class="code" href="classcreditCurve.html#p1">_combined</a> = <a class="code" href="classcreditCurve.html#a9">combineUnderlyingAndSpreads</a>(*<a class="code" href="classcreditCurve.html#p0">_underlying</a>, *spreadCurve);
00072         <a class="code" href="classcreditCurve.html#a10">assignFlatSpread</a>(flatSpread);
00073         
00074         <span class="keyword">delete</span> spreadCurve;
00075 }
00076 
<a name="l00077"></a><a class="code" href="classcreditCurve.html#a4">00077</a> <a class="code" href="classcreditCurve.html#a0">creditCurve::creditCurve</a>(<a class="code" href="classyieldCurve.html">yieldCurve</a> &amp;yc,
00078                                                  <a class="code" href="types_8h.html#a10">Real</a> flatSpread,
00079                                                  <span class="keywordtype">char</span> *name,
00080                                                  <a class="code" href="types_8h.html#a10">Real</a> recoveryRate,
00081                                                  Currency currency,
00082                                                  Frequency frequency) :
00083 _spreads(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00084 _survivalProbability(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00085 _defaultProbability(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00086 _swapFees(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00087 _recoveryRate(recoveryRate),
00088 _currency(currency),
00089 _frequency(frequency) {
00090 
00091         <span class="comment">// make a local copy of the underlying yieldcurve - its ours now!</span>
00092         <a class="code" href="classcreditCurve.html#p0">_underlying</a> = <span class="keyword">new</span> <a class="code" href="classyieldCurve.html#a0">yieldCurve</a>(yc);       
00093         yieldCurve *spreadCurve = <span class="keyword">new</span> <a class="code" href="classyieldCurve.html#a0">yieldCurve</a>(flatSpread);
00094         <a class="code" href="classcreditCurve.html#p1">_combined</a> = <a class="code" href="classcreditCurve.html#a9">combineUnderlyingAndSpreads</a>(*<a class="code" href="classcreditCurve.html#p0">_underlying</a>, *spreadCurve);
00095         <a class="code" href="classcreditCurve.html#a10">assignFlatSpread</a>(flatSpread);
00096         
00097         <span class="keyword">delete</span> spreadCurve;
00098 }
00099 
<a name="l00100"></a><a class="code" href="classcreditCurve.html#a1">00100</a> <a class="code" href="classcreditCurve.html#a0">creditCurve::creditCurve</a>(valarray&lt;yieldPoint&gt; &amp;yp, 
00101                                                  valarray&lt;CreditSpreadPoint&gt; &amp;cp, 
00102                                                  <span class="keywordtype">char</span> *name,
00103                                                  <a class="code" href="types_8h.html#a10">Real</a> recoveryRate, 
00104                                                  Currency currency, 
00105                                                  Frequency frequency) : 
00106 _spreads(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00107 _survivalProbability(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00108 _defaultProbability(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00109 _swapFees(<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>),
00110 _recoveryRate(recoveryRate), 
00111 _currency(currency), 
00112 _frequency(frequency) {
00113 
00114         <a class="code" href="classcreditCurve.html#p0">_underlying</a> = <span class="keyword">new</span> <a class="code" href="classyieldCurve.html#a0">yieldCurve</a>(yp, name);
00115         yieldCurve *spreadCurve = 
00116                 <a class="code" href="classcreditCurve.html#a8">createSpreadCurve</a>(*<a class="code" href="classcreditCurve.html#p0">_underlying</a>, cp);
00117         <a class="code" href="classcreditCurve.html#p1">_combined</a> = 
00118                 <a class="code" href="classcreditCurve.html#a9">combineUnderlyingAndSpreads</a>(*<a class="code" href="classcreditCurve.html#p0">_underlying</a>, *spreadCurve);
00119         <a class="code" href="classcreditCurve.html#a11">resampleSpread</a>();
00120 
00121         <span class="comment">// cout &lt;&lt; _underlying-&gt;getName() &lt;&lt; ": " &lt;&lt; _underlying &lt;&lt; endl;</span>
00122         <span class="comment">// cout &lt;&lt; spreadCurve-&gt;getName() &lt;&lt; ": " &lt;&lt; spreadCurve &lt;&lt; endl;</span>
00123         <span class="comment">// cout &lt;&lt; _combined-&gt;getName() &lt;&lt; ": " &lt;&lt; _combined &lt;&lt; endl;</span>
00124         <span class="comment">// cout &lt;&lt; "end." &lt;&lt; endl;</span>
00125 
00126         <span class="keyword">delete</span> spreadCurve;
00127 }
00128 
<a name="l00129"></a><a class="code" href="classcreditCurve.html#a5">00129</a> <a class="code" href="classcreditCurve.html#a0">creditCurve::creditCurve</a>(<span class="keyword">const</span> <a class="code" href="classcreditCurve.html">creditCurve</a> &amp;rhs) {
00130         <a class="code" href="classcreditCurve.html#d0">copyObj</a>(rhs);
00131 }
00132 
00133 <a class="code" href="classcreditCurve.html">creditCurve</a> &amp;
<a name="l00134"></a><a class="code" href="classcreditCurve.html#a6">00134</a> <a class="code" href="classcreditCurve.html#a6">creditCurve::operator=</a>(<span class="keyword">const</span> <a class="code" href="classcreditCurve.html">creditCurve</a> &amp;rhs) {
00135         <a class="code" href="classcreditCurve.html#d0">copyObj</a>(rhs);
00136         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00137 }
00138 
00139 <span class="keywordtype">void</span>
<a name="l00140"></a><a class="code" href="classcreditCurve.html#d0">00140</a> <a class="code" href="classcreditCurve.html#d0">creditCurve::copyObj</a>(<span class="keyword">const</span> <a class="code" href="classcreditCurve.html">creditCurve</a> &amp;rhs) {
00141         <a class="code" href="classcreditCurve.html#p0">_underlying</a> = <span class="keyword">new</span> <a class="code" href="classyieldCurve.html#a0">yieldCurve</a>(*(rhs.<a class="code" href="classcreditCurve.html#b0">getUnderlying</a>()));
00142         <a class="code" href="classcreditCurve.html#p1">_combined</a> = <span class="keyword">new</span> <a class="code" href="classyieldCurve.html#a0">yieldCurve</a>(*(rhs.<a class="code" href="classcreditCurve.html#b1">getCombined</a>()));
00143         <a class="code" href="classcreditCurve.html#r0">_spreads</a> = rhs.<a class="code" href="classcreditCurve.html#b2">getSpreads</a>();
00144         <a class="code" href="classcreditCurve.html#r1">_survivalProbability</a> = rhs.<a class="code" href="classcreditCurve.html#b3">getSurvivalProbability</a>();
00145         <a class="code" href="classcreditCurve.html#r2">_defaultProbability</a> = rhs.<a class="code" href="classcreditCurve.html#b4">getDefaultProbability</a>();
00146         <a class="code" href="classcreditCurve.html#r3">_swapFees</a> = rhs.<a class="code" href="classcreditCurve.html#b5">getSwapFees</a>();
00147         <a class="code" href="classcreditCurve.html#r4">_recoveryRate</a> = rhs.<a class="code" href="classcreditCurve.html#a32">getRecoveryRate</a>();
00148         <a class="code" href="classcreditCurve.html#r6">_frequency</a> = rhs.<a class="code" href="classcreditCurve.html#a34">getFrequency</a>();
00149         <a class="code" href="classcreditCurve.html#r5">_currency</a> = rhs.<a class="code" href="classcreditCurve.html#a33">getCurrency</a>();
00150 }
00151 
00152 <a class="code" href="classyieldCurve.html">yieldCurve</a> *
<a name="l00153"></a><a class="code" href="classcreditCurve.html#a8">00153</a> <a class="code" href="classcreditCurve.html#a8">creditCurve::createSpreadCurve</a>(<a class="code" href="classyieldCurve.html">yieldCurve</a> &amp;underlying,
00154                                                            valarray&lt;CreditSpreadPoint&gt; &amp;spreads) {
00155         <span class="comment">// convert all credit spreads to relative, and use this to create a</span>
00156         <span class="comment">//  temporary yieldcurve object (so we can use the interpolation</span>
00157         <span class="comment">//  functionality)</span>
00158         valarray&lt;yieldPoint&gt; _tempspreads(spreads.size());
00159         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i = 0; i &lt; spreads.size(); i++) {
00160                 <span class="keywordflow">if</span> (spreads[i].getSpreadType() == <a class="code" href="creditCurve_8h.html#a7a5">Absolute</a>) {
00161                         _tempspreads[i].setRate(
00162                                 spreads[i].getRate() -
00163                                 underlying.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(spreads[i].getMaturity())
00164                                 );
00165                 } <span class="keywordflow">else</span> {
00166                         _tempspreads[i].setRate(spreads[i].getRate());
00167                 }               
00168                 _tempspreads[i].setMaturity(spreads[i].getMaturity());
00169                 _tempspreads[i].setType(<a class="code" href="yieldCurve_8h.html#a9a6">Cash</a>);
00170         }
00171 
00172         <a class="code" href="classyieldCurve.html">yieldCurve</a> *result = <span class="keyword">new</span> <a class="code" href="classyieldCurve.html#a0">yieldCurve</a>(_tempspreads, <span class="stringliteral">"tempspreads"</span>);
00173         
00174         <span class="comment">// cout &lt;&lt; result-&gt;getName() &lt;&lt; ": " &lt;&lt; result &lt;&lt; endl;</span>
00175         <span class="comment">// cout &lt;&lt; "end." &lt;&lt; endl;</span>
00176 
00177         <span class="keywordflow">return</span> result;
00178 }
00179 
00180 <a class="code" href="classyieldCurve.html">yieldCurve</a> *
<a name="l00181"></a><a class="code" href="classcreditCurve.html#a9">00181</a> <a class="code" href="classcreditCurve.html#a9">creditCurve::combineUnderlyingAndSpreads</a>(<a class="code" href="classyieldCurve.html">yieldCurve</a> &amp;underlying, 
00182                                                                                  <a class="code" href="classyieldCurve.html">yieldCurve</a> &amp;spreadcurve) {
00183         <a class="code" href="types_8h.html#a7">Natural</a> numTermValues = 0;
00184         valarray&lt;Real&gt; underlyingMaturities =
00185                 underlying.<a class="code" href="classyieldCurve.html#a10">getMaturitiesInTheZCBCurve</a>();
00186 
00187         valarray&lt;Real&gt; spreadMaturities =
00188                 spreadcurve.<a class="code" href="classyieldCurve.html#a10">getMaturitiesInTheZCBCurve</a>();
00189 
00190         <span class="comment">// create a curve combining the underlying points and the credit spreads</span>
00191 
00192         <span class="comment">// 1. first get a merged unique list of maturities from the yieldcurve and</span>
00193         <span class="comment">//  the spreads</span>
00194         valarray&lt;Real&gt; termValues = 
00195                 <a class="code" href="utils_8h.html#a6">mergeunique</a>(underlyingMaturities, spreadMaturities);
00196         numTermValues = termValues.size();
00197 
00198         <span class="comment">// 2. then iterate through all known term values adding the spotrate </span>
00199         <span class="comment">//  of the underlying to the credit spread "spotrate" to create</span>
00200         <span class="comment">//  the combined yieldcurve</span>
00201         valarray&lt;yieldPoint&gt; combinedyp(numTermValues); 
00202         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i = 0; i &lt; numTermValues; i++) {
00203                 combinedyp[i].setRate(
00204                         underlying.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(termValues[i]) +
00205                         spreadcurve.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(termValues[i]));
00206                 combinedyp[i].setMaturity(termValues[i]);
00207                 combinedyp[i].setType(<a class="code" href="yieldCurve_8h.html#a9a6">Cash</a>);
00208         }
00209 
00210         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classyieldCurve.html#a0">yieldCurve</a>(combinedyp, <span class="stringliteral">"combined"</span>);
00211 }
00212 
00213 <span class="keywordtype">void</span> 
<a name="l00214"></a><a class="code" href="classcreditCurve.html#a10">00214</a> <a class="code" href="classcreditCurve.html#a10">creditCurve::assignFlatSpread</a>(<a class="code" href="types_8h.html#a10">Real</a> r) {
00215      <a class="code" href="types_8h.html#a7">Natural</a> size = <a class="code" href="classcreditCurve.html#r0">_spreads</a>.size();
00216      <span class="keywordflow">for</span>(<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;size;i++){
00217          <a class="code" href="classcreditCurve.html#r0">_spreads</a>[i].setRate(<a class="code" href="ParkMiller_8h.html#a3">r</a>);       
00218                  <a class="code" href="classcreditCurve.html#r0">_spreads</a>[i].setMaturity(i);
00219                  <a class="code" href="classcreditCurve.html#r0">_spreads</a>[i].setType(<a class="code" href="creditCurve_8h.html#a7a6">Relative</a>);
00220 
00221                  <a class="code" href="classcreditCurve.html#r1">_survivalProbability</a>[i].isCached = 
00222                          <a class="code" href="classcreditCurve.html#r2">_defaultProbability</a>[i].isCached =
00223                          <a class="code" href="classcreditCurve.html#r3">_swapFees</a>[i].isCached = <span class="keyword">false</span>;
00224          }
00225 }
00226 
00227 <span class="keywordtype">void</span>
<a name="l00228"></a><a class="code" href="classcreditCurve.html#a11">00228</a> <a class="code" href="classcreditCurve.html#a11">creditCurve::resampleSpread</a>() {
00229         <a class="code" href="types_8h.html#a7">Natural</a> size = <a class="code" href="classcreditCurve.html#r0">_spreads</a>.size();
00230         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i = 0; i &lt; size; i++) {
00231                 <a class="code" href="classcreditCurve.html#r0">_spreads</a>[i].setRate(<a class="code" href="classcreditCurve.html#p1">_combined</a>-&gt;<a class="code" href="classyieldCurve.html#a8">spotRate</a>(i) - 
00232                         <a class="code" href="classcreditCurve.html#p0">_underlying</a>-&gt;<a class="code" href="classyieldCurve.html#a8">spotRate</a>(i));
00233                 <a class="code" href="classcreditCurve.html#r0">_spreads</a>[i].setMaturity(i);
00234                 <a class="code" href="classcreditCurve.html#r0">_spreads</a>[i].setType(<a class="code" href="creditCurve_8h.html#a7a6">Relative</a>);
00235 
00236                  <a class="code" href="classcreditCurve.html#r1">_survivalProbability</a>[i].isCached = 
00237                          <a class="code" href="classcreditCurve.html#r2">_defaultProbability</a>[i].isCached =
00238                          <a class="code" href="classcreditCurve.html#r3">_swapFees</a>[i].isCached = <span class="keyword">false</span>;
00239         }
00240 }
00241 
00242 
<a name="l00243"></a><a class="code" href="classcreditCurve.html#a7">00243</a> <a class="code" href="classcreditCurve.html#a7">creditCurve::~creditCurve</a>(<span class="keywordtype">void</span>) { 
00244         <span class="keyword">delete</span> <a class="code" href="classcreditCurve.html#p0">_underlying</a>;
00245         <span class="keyword">delete</span> <a class="code" href="classcreditCurve.html#p1">_combined</a>;
00246 }
00247 
00248 <a class="code" href="types_8h.html#a10">Real</a> 
<a name="l00249"></a><a class="code" href="classcreditCurve.html#a14">00249</a> <a class="code" href="classcreditCurve.html#a14">creditCurve::timeOfCurrentSpread</a>(<a class="code" href="types_8h.html#a10">Real</a> maturity)<span class="keyword"> const </span>{
00250         <span class="keywordflow">return</span> <a class="code" href="classcreditCurve.html#r0">_spreads</a>[<a class="code" href="classcreditCurve.html#a15">indexOfCurrentSpread</a>(maturity)].getMaturity();
00251 }
00252 
00253 <a class="code" href="types_8h.html#a7">Natural</a>
<a name="l00254"></a><a class="code" href="classcreditCurve.html#a15">00254</a> <a class="code" href="classcreditCurve.html#a15">creditCurve::indexOfCurrentSpread</a>(<a class="code" href="types_8h.html#a10">Real</a> maturity)<span class="keyword"> const </span>{
00255         <a class="code" href="types_8h.html#a7">Natural</a> i = 0;
00256         <a class="code" href="types_8h.html#a7">Natural</a> result = 0;
00257 
00258         <span class="comment">// linear search through the array...  performance optimization</span>
00259         <span class="keywordflow">while</span> (i &lt; <a class="code" href="classcreditCurve.html#r0">_spreads</a>.size() &amp;&amp;  <a class="code" href="classcreditCurve.html#r0">_spreads</a>[i].getMaturity() &lt; maturity) {
00260                 i++;
00261         }
00262 
00263         <span class="comment">// if index is past the end of _spreads, take last point, </span>
00264         <span class="comment">//  otherwise take the point we have (first point equal to or </span>
00265         <span class="comment">//  after specified maturity)</span>
00266         result = (i == <a class="code" href="classcreditCurve.html#r0">_spreads</a>.size() ? i - 1 : i);
00267 
00268         <span class="keywordflow">return</span> result;
00269 }
00270 
00271 <a class="code" href="types_8h.html#a7">Natural</a>
<a name="l00272"></a><a class="code" href="classcreditCurve.html#a17">00272</a> <a class="code" href="classcreditCurve.html#a17">creditCurve::indexOfPreviousSpread</a>(<a class="code" href="types_8h.html#a10">Real</a> maturity)<span class="keyword"> const </span>{
00273         <a class="code" href="types_8h.html#a7">Natural</a> i = 0;
00274 
00275         <span class="keywordflow">while</span> (i &lt; <a class="code" href="classcreditCurve.html#r0">_spreads</a>.size() &amp;&amp;  <a class="code" href="classcreditCurve.html#r0">_spreads</a>[i].getMaturity() &lt; maturity) {
00276                 i++;
00277         }
00278         <span class="comment">// now go back one index</span>
00279         i = (i - 1 &lt; 0 ? 0 : i - 1);
00280 
00281         <span class="keywordflow">return</span> i;
00282 }
00283 
00284 <a class="code" href="types_8h.html#a10">Real</a> 
<a name="l00285"></a><a class="code" href="classcreditCurve.html#a16">00285</a> <a class="code" href="classcreditCurve.html#a16">creditCurve::timeOfPreviousSpread</a>(<a class="code" href="types_8h.html#a10">Real</a> maturity)<span class="keyword"> const </span>{
00286     <span class="keywordflow">return</span> <a class="code" href="classcreditCurve.html#r0">_spreads</a>[<a class="code" href="classcreditCurve.html#a17">indexOfPreviousSpread</a>(maturity)].getMaturity();
00287 }
00288 
00289 <a class="code" href="types_8h.html#a10">Real</a>
<a name="l00290"></a><a class="code" href="classcreditCurve.html#a19">00290</a> <a class="code" href="classcreditCurve.html#a19">creditCurve::cumulativeDefaultProbability</a>(<a class="code" href="types_8h.html#a10">Real</a> maturity)<span class="keyword"> const </span>{
00291         <span class="keywordflow">return</span> (1 - <a class="code" href="classcreditCurve.html#a18">survivalProbability</a>(maturity));
00292 }
00293 
00294 <a class="code" href="types_8h.html#a10">Real</a> 
<a name="l00295"></a><a class="code" href="classcreditCurve.html#a18">00295</a> <a class="code" href="classcreditCurve.html#a18">creditCurve::survivalProbability</a>(<a class="code" href="types_8h.html#a10">Real</a> maturity)<span class="keyword"> const </span>{
00296         <a class="code" href="types_8h.html#a10">Real</a> result = 0;
00297         <span class="comment">// cout &lt;&lt; "survivalProbability(" &lt;&lt; maturity &lt;&lt; ")" &lt;&lt; endl;</span>
00298         <span class="keywordflow">if</span> (maturity == 0) {
00299                 <span class="comment">// no time has passed so survivalProbability is 100%</span>
00300                 result = 1;
00301         } <span class="keywordflow">else</span> {
00302                 <a class="code" href="types_8h.html#a7">Natural</a> i = <a class="code" href="classcreditCurve.html#a15">indexOfCurrentSpread</a>(maturity);
00303                 <span class="comment">// if this value is not cached, calculate and cache it</span>
00304                 <span class="keywordflow">if</span> (!<a class="code" href="classcreditCurve.html#r1">_survivalProbability</a>[i].isCached) {
00305                         <a class="code" href="types_8h.html#a10">Real</a> T = <a class="code" href="classcreditCurve.html#a14">timeOfCurrentSpread</a>(maturity);
00306                         <a class="code" href="types_8h.html#a10">Real</a> Tminus = <a class="code" href="classcreditCurve.html#a16">timeOfPreviousSpread</a>(maturity);
00307                         <a class="code" href="types_8h.html#a10">Real</a> Sminus = <a class="code" href="classcreditCurve.html#a18">survivalProbability</a>(Tminus);
00308                         <a class="code" href="types_8h.html#a10">Real</a> qminus = <a class="code" href="classcreditCurve.html#a21">defaultProbability</a>(T);
00309 
00310                         <a class="code" href="classcreditCurve.html#r1">_survivalProbability</a>[i].value = Sminus * (1 - qminus);
00311                         <a class="code" href="classcreditCurve.html#r1">_survivalProbability</a>[i].isCached = <span class="keyword">true</span>;
00312                 }
00313                 result = <a class="code" href="classcreditCurve.html#r1">_survivalProbability</a>[i].value;
00314         }
00315 
00316         <span class="keywordflow">return</span> result;
00317 }
00318 
00319 <a class="code" href="types_8h.html#a10">Real</a> 
<a name="l00320"></a><a class="code" href="classcreditCurve.html#a20">00320</a> <a class="code" href="classcreditCurve.html#a20">creditCurve::swapFees</a>(<a class="code" href="types_8h.html#a10">Real</a> maturity)<span class="keyword"> const </span>{
00321         <span class="comment">// cout &lt;&lt; "swapFees(" &lt;&lt; maturity &lt;&lt; ")" &lt;&lt; endl;</span>
00322         <a class="code" href="types_8h.html#a10">Real</a> result = 0;
00323 
00324         <span class="keywordflow">if</span> (maturity == 0) {
00325                 result = 0;
00326         } <span class="keywordflow">else</span> {
00327                 <a class="code" href="types_8h.html#a7">Natural</a> i = <a class="code" href="classcreditCurve.html#a15">indexOfCurrentSpread</a>(maturity);
00328 
00329                 <span class="comment">// if this value is not cached, calculate and cache it</span>
00330                 <span class="keywordflow">if</span> (!<a class="code" href="classcreditCurve.html#r3">_swapFees</a>[i].isCached) {
00331                         <a class="code" href="types_8h.html#a10">Real</a> T = <a class="code" href="classcreditCurve.html#a14">timeOfCurrentSpread</a>(maturity);
00332                         <a class="code" href="types_8h.html#a10">Real</a> Tminus = <a class="code" href="classcreditCurve.html#a16">timeOfPreviousSpread</a>(maturity);
00333                         <a class="code" href="types_8h.html#a10">Real</a> Fminus = <a class="code" href="classcreditCurve.html#a20">swapFees</a>(Tminus);
00334                         <a class="code" href="types_8h.html#a10">Real</a> Sminus = <a class="code" href="classcreditCurve.html#a18">survivalProbability</a>(Tminus);
00335                         <a class="code" href="types_8h.html#a10">Real</a> qminus = <a class="code" href="classcreditCurve.html#a21">defaultProbability</a>(T);
00336                         <a class="code" href="types_8h.html#a10">Real</a> DF = <a class="code" href="classcreditCurve.html#p0">_underlying</a>-&gt;<a class="code" href="classyieldCurve.html#a12">discountFactor</a>(T);
00337                         <a class="code" href="types_8h.html#a10">Real</a> CS = <a class="code" href="classcreditCurve.html#a12">creditSpread</a>(T);
00338                         <a class="code" href="types_8h.html#a10">Real</a> CSminus = <a class="code" href="classcreditCurve.html#a12">creditSpread</a>(Tminus);
00339 
00340                         <a class="code" href="classcreditCurve.html#r3">_swapFees</a>[i].isCached = <span class="keyword">true</span>;
00341                         <a class="code" href="classcreditCurve.html#r3">_swapFees</a>[i].value = 
00342                                 Fminus * CS/CSminus + DF * CS * Sminus * (1 - qminus);
00343                 }
00344                 result = <a class="code" href="classcreditCurve.html#r3">_swapFees</a>[i].value;
00345         }
00346 
00347         <span class="keywordflow">return</span> result;
00348 }
00349 
00356 <a class="code" href="types_8h.html#a10">Real</a> 
<a name="l00357"></a><a class="code" href="classcreditCurve.html#a21">00357</a> <a class="code" href="classcreditCurve.html#a21">creditCurve::defaultProbability</a>(<a class="code" href="types_8h.html#a10">Real</a> maturity)<span class="keyword"> const </span>{
00358         <span class="comment">// cout &lt;&lt; "defaultProbability(" &lt;&lt; maturity &lt;&lt; ")" &lt;&lt; endl;</span>
00359         <a class="code" href="types_8h.html#a10">Real</a> result = 0;
00360 
00361         <span class="keywordflow">if</span> (maturity == 0) {
00362                 result = 0;
00363         } <span class="keywordflow">else</span> {
00364                 <a class="code" href="types_8h.html#a7">Natural</a> i = <a class="code" href="classcreditCurve.html#a15">indexOfCurrentSpread</a>(maturity);
00365 
00366                 <span class="comment">// if this value is not cached, calculate and cache it</span>
00367                 <span class="keywordflow">if</span> (!<a class="code" href="classcreditCurve.html#r2">_defaultProbability</a>[i].isCached) {
00368                         <a class="code" href="types_8h.html#a10">Real</a> T = <a class="code" href="classcreditCurve.html#a14">timeOfCurrentSpread</a>(maturity);
00369                         <a class="code" href="types_8h.html#a10">Real</a> Tminus = <a class="code" href="classcreditCurve.html#a16">timeOfPreviousSpread</a>(maturity);
00370                         <a class="code" href="types_8h.html#a10">Real</a> Sminus = <a class="code" href="classcreditCurve.html#a18">survivalProbability</a>(Tminus);
00371                         <a class="code" href="types_8h.html#a10">Real</a> Fminus = <a class="code" href="classcreditCurve.html#a20">swapFees</a>(Tminus);
00372                         <a class="code" href="types_8h.html#a10">Real</a> DF = <a class="code" href="classcreditCurve.html#p0">_underlying</a>-&gt;<a class="code" href="classyieldCurve.html#a12">discountFactor</a>(T);
00373 
00374                         <a class="code" href="types_8h.html#a10">Real</a> Tdefault = T - (T - Tminus)/2;
00375                         <a class="code" href="types_8h.html#a10">Real</a> DFd = <a class="code" href="classcreditCurve.html#p0">_underlying</a>-&gt;<a class="code" href="classyieldCurve.html#a12">discountFactor</a>(Tdefault);
00376                         <a class="code" href="types_8h.html#a10">Real</a> CS = <a class="code" href="classcreditCurve.html#a12">creditSpread</a>(T);
00377                         <a class="code" href="types_8h.html#a10">Real</a> CSminus = <a class="code" href="classcreditCurve.html#a12">creditSpread</a>(Tminus);
00378 
00379                         <span class="comment">// cout &lt;&lt; "DFd: " &lt;&lt; DFd &lt;&lt; endl;</span>
00380                         <a class="code" href="types_8h.html#a10">Real</a> num = Fminus * (CS/CSminus - 1) + DF * CS * Sminus;
00381                         <a class="code" href="types_8h.html#a10">Real</a> denom = Sminus * (DFd * (1 - <a class="code" href="classcreditCurve.html#r4">_recoveryRate</a>) + DF * CS);
00382 
00383                         <a class="code" href="classcreditCurve.html#r2">_defaultProbability</a>[i].isCached = <span class="keyword">true</span>;
00384                         <a class="code" href="classcreditCurve.html#r2">_defaultProbability</a>[i].value = num/denom;
00385                 }
00386 
00387                 result = <a class="code" href="classcreditCurve.html#r2">_defaultProbability</a>[i].value;
00388         }
00389 
00390         <span class="keywordflow">return</span> result;
00391 }
00392 
00393 <a class="code" href="types_8h.html#a10">Real</a>
<a name="l00394"></a><a class="code" href="classcreditCurve.html#a26">00394</a> <a class="code" href="classcreditCurve.html#a26">creditCurve::riskyDiscountFactor</a>(<a class="code" href="types_8h.html#a10">Real</a> maturity, 
00395                                                                  interestComposition composition) {
00416         <a class="code" href="types_8h.html#a10">Real</a> DF = <a class="code" href="classcreditCurve.html#p0">_underlying</a>-&gt;<a class="code" href="classyieldCurve.html#a12">discountFactor</a>(maturity, composition);
00417         <a class="code" href="types_8h.html#a10">Real</a> RDF = DF * <a class="code" href="classcreditCurve.html#a18">survivalProbability</a>(maturity);
00418 
00419         <span class="keywordflow">return</span> RDF;
00420 }
00421 
00422 ostream&amp; 
<a name="l00423"></a><a class="code" href="creditCurve_8cpp.html#a0">00423</a> <a class="code" href="convertiblebond_8cpp.html#a0">operator &lt;&lt; </a>(ostream &amp;os, <span class="keyword">const</span> <a class="code" href="classcreditCurve.html">creditCurve</a> &amp;c) {
00424         os &lt;&lt; c.<a class="code" href="classcreditCurve.html#p1">_combined</a>;
00425         <span class="keywordflow">return</span> os;
00426 }
</pre></div><hr size="1"><address style="align: right;"><small>
<b>Note: Generated nightly - reload for latest version</b><br>
Generated on Thu Dec 22 13:21:43 2005 for <a href="http://terreneuve.sourceforge.net">terreneuve</a> by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.3.6</small></address>
</body>
</html>
