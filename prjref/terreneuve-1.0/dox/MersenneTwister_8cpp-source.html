<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MersenneTwister.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>MersenneTwister.cpp</h1><a href="MersenneTwister_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include "<a class="code" href="MersenneTwister_8h.html">./MersenneTwister.h</a>"</span>
00002 <span class="preprocessor">#include "time.h"</span>
00003 
00004 <span class="comment">// Period parameters</span>
<a name="l00005"></a><a class="code" href="MersenneTwister_8cpp.html#a0">00005</a> <span class="keyword">const</span> <a class="code" href="types_8h.html#a9">LongNatural</a> <a class="code" href="MersenneTwister_8cpp.html#a0">N</a> = 624;
<a name="l00006"></a><a class="code" href="MersenneTwister_8cpp.html#a1">00006</a> <span class="keyword">const</span> <a class="code" href="types_8h.html#a9">LongNatural</a> <a class="code" href="MersenneTwister_8cpp.html#a1">M</a> = 397;
00007 <span class="comment">// constant vector a</span>
<a name="l00008"></a><a class="code" href="MersenneTwister_8cpp.html#a2">00008</a> <span class="keyword">const</span> <a class="code" href="types_8h.html#a9">LongNatural</a> <a class="code" href="MersenneTwister_8cpp.html#a2">MATRIX_A</a> = 0x9908b0dfUL;
00009 <span class="comment">// most significant w-r bits</span>
<a name="l00010"></a><a class="code" href="MersenneTwister_8cpp.html#a3">00010</a> <span class="keyword">const</span> <a class="code" href="types_8h.html#a9">LongNatural</a> <a class="code" href="MersenneTwister_8cpp.html#a3">UPPER_MASK</a>=0x80000000UL;
00011 <span class="comment">// least significant r bits</span>
<a name="l00012"></a><a class="code" href="MersenneTwister_8cpp.html#a4">00012</a> <span class="keyword">const</span> <a class="code" href="types_8h.html#a9">LongNatural</a> <a class="code" href="MersenneTwister_8cpp.html#a4">LOWER_MASK</a>=0x7fffffffUL;
00013 
<a name="l00014"></a><a class="code" href="classMersenneTwister.html#a0">00014</a> <a class="code" href="classMersenneTwister.html#a0">MersenneTwister::MersenneTwister</a>(<a class="code" href="types_8h.html#a9">LongNatural</a> seed)
00015 : mt(<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>)
00016 {
00017         <a class="code" href="classMersenneTwister.html#a7">SetSeed</a>(seed);
00018 }
00019 
<a name="l00020"></a><a class="code" href="classMersenneTwister.html#a2">00020</a> <a class="code" href="classMersenneTwister.html#a2">MersenneTwister::~MersenneTwister</a>(<span class="keywordtype">void</span>)
00021 {
00022 }
00023 
<a name="l00024"></a><a class="code" href="classMersenneTwister.html#a5">00024</a> <a class="code" href="types_8h.html#a12">VeryLongNatural</a> <a class="code" href="classMersenneTwister.html#a5">MersenneTwister::Max</a>() {
00025         <span class="keywordflow">return</span> 4294967296; <span class="comment">//return 2^32;</span>
00026 }
00027 
<a name="l00028"></a><a class="code" href="classMersenneTwister.html#a6">00028</a> <a class="code" href="types_8h.html#a9">LongNatural</a> <a class="code" href="classMersenneTwister.html#a6">MersenneTwister::Min</a>()
00029 {
00030     <span class="keywordflow">return</span> 1;
00031 }
00032 
<a name="l00033"></a><a class="code" href="classMersenneTwister.html#a7">00033</a> <span class="keywordtype">void</span> <a class="code" href="classMersenneTwister.html#a7">MersenneTwister::SetSeed</a>(<a class="code" href="types_8h.html#a9">LongNatural</a> seed) {
00034         <a class="code" href="types_8h.html#a9">LongNatural</a> s = (seed != 0 ? seed : clock());
00035         <a class="code" href="classMersenneTwister.html#r1">mt</a>[0]= s &amp; 0xffffffffUL;
00036         <span class="keywordflow">for</span> (<a class="code" href="classMersenneTwister.html#r2">mti</a>=1; <a class="code" href="classMersenneTwister.html#r2">mti</a>&lt;<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>; <a class="code" href="classMersenneTwister.html#r2">mti</a>++) {
00037                 <a class="code" href="classMersenneTwister.html#r1">mt</a>[<a class="code" href="classMersenneTwister.html#r2">mti</a>] = (1812433253UL * (<a class="code" href="classMersenneTwister.html#r1">mt</a>[<a class="code" href="classMersenneTwister.html#r2">mti</a>-1] ^ (mt[<a class="code" href="classMersenneTwister.html#r2">mti</a>-1] &gt;&gt; 30)) + <a class="code" href="classMersenneTwister.html#r2">mti</a>);
00038                 mt[<a class="code" href="classMersenneTwister.html#r2">mti</a>] &amp;= 0xffffffffUL;
00039         }
00040 }
00041 
<a name="l00042"></a><a class="code" href="classMersenneTwister.html#a1">00042</a> <a class="code" href="classMersenneTwister.html#a0">MersenneTwister::MersenneTwister</a>(<span class="keyword">const</span> valarray&lt;LongNatural&gt;&amp; seeds)
00043 : mt(<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>) {
00044         <a class="code" href="classMersenneTwister.html#a7">SetSeed</a>(19650218UL);
00045         <a class="code" href="types_8h.html#a9">LongNatural</a> i=1, j=0, k = (<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>&gt;seeds.size() ? <a class="code" href="MersenneTwister_8cpp.html#a0">N</a> : seeds.size());
00046         <span class="keywordflow">for</span> (; k; k--) {
00047                 <a class="code" href="classMersenneTwister.html#r1">mt</a>[i] = (<a class="code" href="classMersenneTwister.html#r1">mt</a>[i] ^ ((mt[i-1] ^ (mt[i-1] &gt;&gt; 30)) * 1664525UL))
00048                         + seeds[j] + j; <span class="comment">/* non linear */</span>
00049                 mt[i] &amp;= 0xffffffffUL;
00050                 i++; j++;
00051                 <span class="keywordflow">if</span> (i&gt;=<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>) { mt[0] = mt[<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>-1]; i=1; }
00052                 <span class="keywordflow">if</span> (j&gt;=seeds.size()) j=0;
00053         }
00054         <span class="keywordflow">for</span> (k=<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>-1; k; k--) {
00055                 <a class="code" href="classMersenneTwister.html#r1">mt</a>[i] = (<a class="code" href="classMersenneTwister.html#r1">mt</a>[i] ^ ((mt[i-1] ^ (mt[i-1] &gt;&gt; 30)) * 1566083941UL))
00056                         - i;
00057                 mt[i] &amp;= 0xffffffffUL;
00058                 i++;
00059                 <span class="keywordflow">if</span> (i&gt;=<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>) { mt[0] = mt[<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>-1]; i=1; }
00060         }
00061 
00062         <a class="code" href="classMersenneTwister.html#r1">mt</a>[0] = 0x80000000UL;
00063 }
00064 
<a name="l00065"></a><a class="code" href="classMersenneTwister.html#a4">00065</a> <a class="code" href="types_8h.html#a9">LongNatural</a> <a class="code" href="classMersenneTwister.html#a4">MersenneTwister::GetOneRandomInteger</a>() {
00066 
00067         <a class="code" href="types_8h.html#a9">LongNatural</a> y;
00068         <span class="keyword">static</span> <a class="code" href="types_8h.html#a9">LongNatural</a> mag01[2]={0x0UL, <a class="code" href="MersenneTwister_8cpp.html#a2">MATRIX_A</a>};
00069 
00070         <span class="keywordflow">if</span> (<a class="code" href="classMersenneTwister.html#r2">mti</a> &gt;= <a class="code" href="MersenneTwister_8cpp.html#a0">N</a>) { <span class="comment">/* generate N words at one time */</span>
00071                 <a class="code" href="types_8h.html#a9">LongNatural</a> kk;
00072 
00073                 <span class="keywordflow">for</span> (kk=0;kk&lt;<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>-<a class="code" href="MersenneTwister_8cpp.html#a1">M</a>;kk++) {
00074                         y = (<a class="code" href="classMersenneTwister.html#r1">mt</a>[kk]&amp;<a class="code" href="MersenneTwister_8cpp.html#a3">UPPER_MASK</a>)|(mt[kk+1]&amp;<a class="code" href="MersenneTwister_8cpp.html#a4">LOWER_MASK</a>);
00075                         mt[kk] = mt[kk+<a class="code" href="MersenneTwister_8cpp.html#a1">M</a>] ^ (y &gt;&gt; 1) ^ mag01[y &amp; 0x1UL];
00076                 }
00077                 <span class="keywordflow">for</span> (;kk&lt;<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>-1;kk++) {
00078                         y = (<a class="code" href="classMersenneTwister.html#r1">mt</a>[kk]&amp;<a class="code" href="MersenneTwister_8cpp.html#a3">UPPER_MASK</a>)|(mt[kk+1]&amp;<a class="code" href="MersenneTwister_8cpp.html#a4">LOWER_MASK</a>);
00079                         mt[kk] = mt[kk+(<a class="code" href="MersenneTwister_8cpp.html#a1">M</a>-<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>)] ^ (y &gt;&gt; 1) ^ mag01[y &amp; 0x1UL];
00080                 }
00081                 y = (<a class="code" href="classMersenneTwister.html#r1">mt</a>[<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>-1]&amp;<a class="code" href="MersenneTwister_8cpp.html#a3">UPPER_MASK</a>)|(mt[0]&amp;<a class="code" href="MersenneTwister_8cpp.html#a4">LOWER_MASK</a>);
00082                 mt[<a class="code" href="MersenneTwister_8cpp.html#a0">N</a>-1] = mt[<a class="code" href="MersenneTwister_8cpp.html#a1">M</a>-1] ^ (y &gt;&gt; 1) ^ mag01[y &amp; 0x1UL];
00083 
00084                 <a class="code" href="classMersenneTwister.html#r2">mti</a> = 0;
00085         }
00086 
00087         y = <a class="code" href="classMersenneTwister.html#r1">mt</a>[<a class="code" href="classMersenneTwister.html#r2">mti</a>++];
00088 
00089         <span class="comment">/* Tempering */</span>
00090         y ^= (y &gt;&gt; 11);
00091         y ^= (y &lt;&lt; 7) &amp; 0x9d2c5680UL;
00092         y ^= (y &lt;&lt; 15) &amp; 0xefc60000UL;
00093         y ^= (y &gt;&gt; 18);
00094 
00095         <span class="keywordflow">return</span> y;
00096 }
</pre></div><hr size="1"><address style="align: right;"><small>
<b>Note: Generated nightly - reload for latest version</b><br>
Generated on Thu Dec 22 13:21:44 2005 for <a href="http://terreneuve.sourceforge.net">terreneuve</a> by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.3.6</small></address>
</body>
</html>
