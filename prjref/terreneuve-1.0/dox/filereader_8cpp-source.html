<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>filereader.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>filereader.cpp</h1><a href="filereader_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include &lt;fstream&gt;</span>
00002 <span class="preprocessor">#include "<a class="code" href="filereader_8h.html">filereader.h</a>"</span>
00003 <span class="preprocessor">#include "<a class="code" href="csvparser_8h.html">csvparser.h</a>"</span>
00004 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00005 
<a name="l00006"></a><a class="code" href="classFileReader.html#t0">00006</a> <span class="keywordtype">char</span> <a class="code" href="classFileReader.html#t0">FileReader::_datadir</a>[128] = <span class="stringliteral">""</span>;
00007 
<a name="l00012"></a><a class="code" href="classFileReader.html#e0">00012</a> <span class="keywordtype">bool</span> <a class="code" href="classFileReader.html#e0">FileReader::fileexists</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
00013   <span class="keywordtype">bool</span> flag = <span class="keyword">false</span>;
00014   fstream fin;
00015 
00016   fin.open(filename, ios::in);
00017   flag = fin.is_open();
00018   fin.close();
00019 
00020   <span class="keywordflow">return</span> flag;
00021 }
00022 
<a name="l00027"></a><a class="code" href="classFileReader.html#e1">00027</a> <span class="keywordtype">bool</span> <a class="code" href="classFileReader.html#e0">FileReader::fileexists</a>(string filename) {
00028         <span class="keywordflow">return</span> <a class="code" href="classFileReader.html#e0">FileReader::fileexists</a>(filename.c_str());
00029 }
00030 
<a name="l00031"></a><a class="code" href="classFileReader.html#e2">00031</a> <span class="keywordtype">bool</span> <a class="code" href="classFileReader.html#e2">FileReader::setdatadir</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *command) {
00037         <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
00038         string mycommand(command);
00039         string filename(<span class="stringliteral">"sample.csv"</span>);
00040         string dir(<span class="stringliteral">""</span>);
00041         string datadir(<span class="stringliteral">""</span>);
00042         string fullfilename(<span class="stringliteral">""</span>);
00043 
00044         <span class="comment">/* possible values for command:</span>
00045 <span class="comment">           program.exe -&gt; datadir: ..\data</span>
00046 <span class="comment">           somepath\program.exe -&gt; datadir: somepath\..\data */</span>
00047 
00048         string::size_type pos = mycommand.rfind(<span class="stringliteral">"\\"</span>, mycommand.length());
00049 
00050         <span class="comment">/* if \ found in command, extract the dir including the \, if not found</span>
00051 <span class="comment">           we'll just continue with dir = "" */</span>
00052         <span class="keywordflow">if</span> (pos != string::npos) {
00053                 dir = mycommand.substr(0, pos + 1);
00054         }
00055         
00056         datadir = dir + <span class="stringliteral">"..\\data\\"</span>;
00057         fullfilename = datadir + filename;
00058         <span class="keywordflow">if</span> (<a class="code" href="classFileReader.html#e0">FileReader::fileexists</a>(fullfilename.c_str())) {
00059                 strcpy(<a class="code" href="classFileReader.html#t0">FileReader::_datadir</a>, datadir.c_str());
00060                 result = <span class="keyword">true</span>;
00061         } <span class="keywordflow">else</span> {
00062                 datadir = dir + <span class="stringliteral">"data\\"</span>;
00063                 fullfilename = datadir + filename;
00064                 <span class="keywordflow">if</span> (<a class="code" href="classFileReader.html#e0">FileReader::fileexists</a>(fullfilename.c_str())) {
00065                         strcpy(<a class="code" href="classFileReader.html#t0">FileReader::_datadir</a>, datadir.c_str());
00066                         result = <span class="keyword">true</span>;
00067                 }
00068         }
00069 
00070         <span class="keywordflow">return</span> result;
00071 }
00072 
00078 valarray&lt;yieldPoint&gt; *
<a name="l00079"></a><a class="code" href="classFileReader.html#e5">00079</a> <a class="code" href="classFileReader.html#e5">FileReader::buildYieldPointArray</a>(string filename) {
00080   string sLine;
00081   <span class="keywordtype">double</span> yieldRate, yieldMaturity;
00082   <a class="code" href="yieldCurve_8h.html#a9">TypeOfRate</a> yieldType;
00083   
00084   <a class="code" href="types_8h.html#a7">Natural</a> ypArrayIdx = 0;
00085   <a class="code" href="types_8h.html#a7">Natural</a> ypArrayMaxIdx = <a class="code" href="yieldCurve_8h.html#a2">YC_MAX_NUMBER_POINTS</a> - 1;
00086   <a class="code" href="classyieldPoint.html">yieldPoint</a> *ypArray[<a class="code" href="yieldCurve_8h.html#a2">YC_MAX_NUMBER_POINTS</a>];
00087   valarray&lt;yieldPoint&gt; *ypValArray;
00088 
00089   <a class="code" href="classCSVParser.html">CSVParser</a> parser;
00090 
00091   <span class="keywordflow">if</span> (!<a class="code" href="classFileReader.html#e0">FileReader::fileexists</a>(filename)) {
00092         cout &lt;&lt; <span class="stringliteral">"could not find file "</span> &lt;&lt; filename &lt;&lt; endl;
00093         <span class="keywordflow">return</span> NULL;
00094   }
00095     
00096   ifstream infile(filename.c_str());
00097   <span class="keywordflow">while</span> (!infile.eof() &amp;&amp; (ypArrayIdx &lt; ypArrayMaxIdx)) {
00098         <span class="keywordflow">if</span> (ypArrayIdx &gt;= ypArrayMaxIdx) {
00099                 cout &lt;&lt; <span class="stringliteral">"File has more than max entries: "</span> &lt;&lt; (ypArrayMaxIdx + 1)
00100                          &lt;&lt; <span class="stringliteral">" - truncating"</span> &lt;&lt; endl;
00101                 <span class="keywordflow">break</span>;
00102         }
00103 
00104     getline(infile, sLine); <span class="comment">// Get a line</span>
00105     <span class="keywordflow">if</span> (sLine == <span class="stringliteral">""</span>)
00106       <span class="keywordflow">continue</span>;
00107 
00108     parser &lt;&lt; sLine; <span class="comment">// Feed the line to the parser</span>
00109 
00110     <span class="comment">// Now extract the columns from the line</span>
00111     parser &gt;&gt; yieldRate &gt;&gt; yieldMaturity &gt;&gt; yieldType;
00112 
00113         ypArray[ypArrayIdx++] = 
00114                 <span class="keyword">new</span> <a class="code" href="classyieldPoint.html">yieldPoint</a>(yieldRate, yieldMaturity, yieldType);
00115   }
00116   infile.close();
00117 
00118   ypValArray = <span class="keyword">new</span> valarray&lt;yieldPoint&gt;(ypArrayIdx);
00119   <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i = 0; i &lt; ypArrayIdx; i++) {
00120           (*ypValArray)[i] = *(ypArray[i]);
00121   }
00122 
00123   <span class="keywordflow">return</span> ypValArray;
00124 }
00125 
00131 valarray&lt;CreditSpreadPoint&gt; *
<a name="l00132"></a><a class="code" href="classFileReader.html#e6">00132</a> <a class="code" href="classFileReader.html#e6">FileReader::buildCreditSpreadPointArray</a>(string filename) {
00133   string sLine;
00134   <span class="keywordtype">double</span> spreadRate, spreadMaturity;
00135   <a class="code" href="creditCurve_8h.html#a7">CreditSpreadType</a> spreadType;
00136   
00137   <a class="code" href="types_8h.html#a7">Natural</a> ArrayIdx = 0;
00138   <a class="code" href="types_8h.html#a7">Natural</a> ArrayMaxIdx = <a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a> - 1;
00139   <a class="code" href="classCreditSpreadPoint.html">CreditSpreadPoint</a> *theArray[<a class="code" href="creditCurve_8h.html#a0">CC_MAX_NUM_SPREADS</a>];
00140   valarray&lt;CreditSpreadPoint&gt; *theValarray;
00141 
00142   <a class="code" href="classCSVParser.html">CSVParser</a> parser;
00143 
00144   <span class="keywordflow">if</span> (!<a class="code" href="classFileReader.html#e0">FileReader::fileexists</a>(filename)) {
00145         cout &lt;&lt; <span class="stringliteral">"could not find file "</span> &lt;&lt; filename &lt;&lt; endl;
00146         <span class="keywordflow">return</span> NULL;
00147   }
00148     
00149   ifstream infile(filename.c_str());
00150   <span class="keywordflow">while</span> (!infile.eof() &amp;&amp; (ArrayIdx &lt; ArrayMaxIdx)) {
00151         <span class="keywordflow">if</span> (ArrayIdx &gt;= ArrayMaxIdx) {
00152                 cout &lt;&lt; <span class="stringliteral">"File has more than max entries: "</span> &lt;&lt; (ArrayMaxIdx + 1)
00153                          &lt;&lt; <span class="stringliteral">" - truncating"</span> &lt;&lt; endl;
00154                 <span class="keywordflow">break</span>;
00155         }
00156 
00157     getline(infile, sLine); <span class="comment">// Get a line</span>
00158     <span class="keywordflow">if</span> (sLine == <span class="stringliteral">""</span>)
00159       <span class="keywordflow">continue</span>;
00160 
00161     parser &lt;&lt; sLine; <span class="comment">// Feed the line to the parser</span>
00162 
00163     <span class="comment">// Now extract the columns from the line</span>
00164     parser &gt;&gt; spreadRate &gt;&gt; spreadMaturity &gt;&gt; spreadType;
00165 
00166         theArray[ArrayIdx++] = 
00167                 <span class="keyword">new</span> <a class="code" href="classCreditSpreadPoint.html">CreditSpreadPoint</a>(spreadRate, spreadMaturity, spreadType);
00168   }
00169   infile.close();
00170 
00171   theValarray = <span class="keyword">new</span> valarray&lt;CreditSpreadPoint&gt;(ArrayIdx);
00172   <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i = 0; i &lt; ArrayIdx; i++) {
00173           (*theValarray)[i] = *(theArray[i]);
00174   }
00175 
00176   <span class="keywordflow">return</span> theValarray;
00177 }
00178 
00184 <a class="code" href="classvolsurfaceparams.html">volsurfaceparams</a> *
<a name="l00185"></a><a class="code" href="classFileReader.html#e7">00185</a> <a class="code" href="classFileReader.html#e7">FileReader::buildVolSurfaceParams</a>(string filename) {
00186         <a class="code" href="classvolsurfaceparams.html">volsurfaceparams</a> *p = <span class="keyword">new</span> <a class="code" href="classvolsurfaceparams.html">volsurfaceparams</a>();
00187 
00188         <a class="code" href="classCSVParser.html">CSVParser</a> parser;
00189         string sLine, dummy;
00190         <a class="code" href="types_8h.html#a7">Natural</a> numStrikes, numMaturities;
00191 
00192         <span class="keywordflow">if</span> (!<a class="code" href="classFileReader.html#e0">FileReader::fileexists</a>(filename)) {
00193                 cout &lt;&lt; <span class="stringliteral">"could not find file "</span> &lt;&lt; filename &lt;&lt; endl;
00194                 <span class="keywordflow">return</span> NULL;
00195         }
00196 
00197         ifstream infile(filename.c_str());
00198 
00199         <span class="comment">// file format is</span>
00200         <span class="comment">// maturities,&lt;num of maturities&gt;</span>
00201         <span class="comment">// strikes,&lt;num of strikes&gt;</span>
00202         <span class="comment">// maturities/strikes,&lt;strike&gt;,type,&lt;strike&gt;,type,...</span>
00203         <span class="comment">// &lt;date&gt;            ,&lt;price&gt;,&lt;c|p&gt;,&lt;price&gt;,&lt;c|p&gt;,...</span>
00204 
00205         getline(infile, sLine); <span class="comment">// Get a line</span>
00206     parser &lt;&lt; sLine; <span class="comment">// Feed the line to the parser</span>
00207     parser &gt;&gt; dummy &gt;&gt; numMaturities;
00208         <span class="comment">// cout &lt;&lt; "maturities = " &lt;&lt; numMaturities &lt;&lt; endl;</span>
00209 
00210         getline(infile, sLine);
00211         parser &lt;&lt; sLine;
00212         parser &gt;&gt; dummy &gt;&gt; numStrikes;
00213         <span class="comment">// cout &lt;&lt; "strikes = " &lt;&lt; numStrikes &lt;&lt; endl;</span>
00214 
00215         p-&gt;<a class="code" href="classvolsurfaceparams.html#o0">strikes</a>.resize(numStrikes);
00216         p-&gt;<a class="code" href="classvolsurfaceparams.html#o1">maturities</a>.resize(numMaturities);
00217         p-&gt;<a class="code" href="classvolsurfaceparams.html#o2">callputprices</a>.resize(numMaturities);
00218         p-&gt;<a class="code" href="classvolsurfaceparams.html#o3">iscallputprices</a>.resize(numMaturities);
00219         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i = 0; i &lt; numMaturities; i++) {
00220                 p-&gt;<a class="code" href="classvolsurfaceparams.html#o2">callputprices</a>[i].resize(numStrikes);
00221                 p-&gt;<a class="code" href="classvolsurfaceparams.html#o3">iscallputprices</a>[i].resize(numStrikes);
00222         }
00223                 
00224         getline(infile, sLine);
00225         parser &lt;&lt; sLine;
00226         parser &gt;&gt; dummy; <span class="comment">// skip past first column</span>
00227         <span class="keywordflow">for</span> (i = 0; i &lt; numStrikes; i++) {
00228                 parser &gt;&gt; p-&gt;<a class="code" href="classvolsurfaceparams.html#o0">strikes</a>[i] &gt;&gt; dummy; <span class="comment">// every other column is "type"</span>
00229                 <span class="comment">// cout &lt;&lt; "dummy: " &lt;&lt; dummy &lt;&lt; ", strike: " &lt;&lt; p-&gt;strikes[i] &lt;&lt; endl;</span>
00230         }
00231 
00232         <a class="code" href="types_8h.html#a7">Natural</a> maturityIdx = 0;
00233         string callorput;
00234 
00235         <span class="keywordflow">while</span> (!infile.eof()) {
00236                 getline(infile, sLine);
00237                 <span class="keywordflow">if</span> (sLine == <span class="stringliteral">""</span>)
00238                         <span class="keywordflow">continue</span>;
00239                 parser &lt;&lt; sLine;
00240                 parser &gt;&gt; p-&gt;<a class="code" href="classvolsurfaceparams.html#o1">maturities</a>[maturityIdx];
00241                 <span class="comment">// cout &lt;&lt; "maturity: " &lt;&lt; p-&gt;maturities[maturityIdx].toString() &lt;&lt; endl;</span>
00242                 
00243                 <span class="keywordflow">for</span> (i = 0; i &lt; numStrikes; i++) {
00244                         parser &gt;&gt; p-&gt;<a class="code" href="classvolsurfaceparams.html#o2">callputprices</a>[maturityIdx][i];
00245                         parser &gt;&gt; callorput;
00246                         <span class="comment">// cout &lt;&lt; "price: " &lt;&lt; p-&gt;callputprices[maturityIdx][i] &lt;&lt; ", " &lt;&lt; callorput &lt;&lt; endl;</span>
00247                         p-&gt;<a class="code" href="classvolsurfaceparams.html#o3">iscallputprices</a>[maturityIdx][i] = 
00248                                 (callorput.compare(<span class="stringliteral">"c"</span>) == 0);
00249                 }
00250                 maturityIdx++;
00251         }
00252 
00253         <span class="keywordflow">return</span> p;
00254 }
</pre></div><hr size="1"><address style="align: right;"><small>
<b>Note: Generated nightly - reload for latest version</b><br>
Generated on Thu Dec 22 13:21:43 2005 for <a href="http://terreneuve.sourceforge.net">terreneuve</a> by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.3.6</small></address>
</body>
</html>
