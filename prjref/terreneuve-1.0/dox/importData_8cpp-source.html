<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>importData.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>importData.cpp</h1><a href="importData_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include ".\importData.h"</span>
00002 
<a name="l00003"></a><a class="code" href="classimportData.html#a0">00003</a> <a class="code" href="classimportData.html#a0">importData::importData</a>(<span class="keywordtype">void</span>)
00004 {
00005 }
00006 
<a name="l00007"></a><a class="code" href="classimportData.html#a1">00007</a> <a class="code" href="classimportData.html#a0">importData::importData</a>(<span class="keywordtype">char</span> *argv)
00008 {
00009         <a class="code" href="classFileReader.html#e2">FileReader::setdatadir</a> (argv); <span class="comment">// memorize the local path if the user wants the predefined data</span>
00010         <a class="code" href="classimportData.html#a2">runInterface</a>();
00011 }
00012 
<a name="l00013"></a><a class="code" href="classimportData.html#a5">00013</a> <span class="keywordtype">void</span> <a class="code" href="classimportData.html#a5">importData::importYieldCurve</a>(string path){
00014         string yieldCurveData = _datadir + <span class="stringliteral">"/"</span>+path;
00015 
00016         valarray&lt;yieldPoint&gt; *rates = 
00017                 <a class="code" href="classFileReader.html#e5">FileReader::buildYieldPointArray</a>(yieldCurveData);
00018 
00019         <a class="code" href="classimportData.html#r1">_yc</a> =<a class="code" href="classyieldCurve.html">yieldCurve</a>(*rates,<span class="stringliteral">"test yc"</span>);
00020         cout&lt;&lt;<span class="stringliteral">"- Yield curve imported"</span>&lt;&lt;endl;
00021 }
00022 
<a name="l00023"></a><a class="code" href="classimportData.html#a6">00023</a> <span class="keywordtype">void</span> <a class="code" href="classimportData.html#a6">importData::importVolSurface</a>(string path,<a class="code" href="types_8h.html#a10">Real</a> spot)
00024 {
00025         <a class="code" href="classDate.html">Date</a> t0=<a class="code" href="classDate.html">Date</a>();
00026         t0.<a class="code" href="classDate.html#a13">setDateToToday</a> ();
00027         string volSurfaceData=_datadir+<span class="stringliteral">"/"</span>+path;
00028         <a class="code" href="classvolsurfaceparams.html">volsurfaceparams</a> *params =
00029                 <a class="code" href="classFileReader.html#e7">FileReader::buildVolSurfaceParams</a>(volSurfaceData);
00030 
00031         <a class="code" href="classimportData.html#r3">_vs</a>= <a class="code" href="classvolsurface.html">volsurface</a>(spot, t0, <a class="code" href="classimportData.html#r1">_yc</a>, *params);
00032         <a class="code" href="classimportData.html#r3">_vs</a>.<a class="code" href="classvolsurface.html#a10">setvolsurface</a>();
00033         cout&lt;&lt;<span class="stringliteral">"- Volatility surface imported"</span>&lt;&lt;endl;
00034 }
00035 
<a name="l00036"></a><a class="code" href="classimportData.html#a7">00036</a> <span class="keywordtype">void</span> <a class="code" href="classimportData.html#a7">importData::importCreditCurve</a>(string path){
00037         string creditSpreadsData= _datadir+<span class="stringliteral">"/"</span>+path;
00038         valarray&lt;CreditSpreadPoint&gt; *creditSpreadArray =
00039                 <a class="code" href="classFileReader.html#e6">FileReader::buildCreditSpreadPointArray</a>(creditSpreadsData);
00040         <a class="code" href="classimportData.html#r2">_cc</a>=<a class="code" href="classcreditCurve.html">creditCurve</a>(<a class="code" href="classimportData.html#r1">_yc</a>,*creditSpreadArray,<span class="stringliteral">"test cc"</span>);
00041         cout&lt;&lt;<span class="stringliteral">"- Credit spreads imported"</span>&lt;&lt;endl;
00042 }
00043 
00044 
<a name="l00045"></a><a class="code" href="classimportData.html#a2">00045</a> <span class="keywordtype">bool</span> <a class="code" href="classimportData.html#a2">importData::runInterface</a>(){
00046         cout&lt;&lt;<span class="stringliteral">"\n**************************************"</span>&lt;&lt;endl;
00047         cout&lt;&lt;<span class="stringliteral">"********* Data import Module *********"</span>&lt;&lt;endl;
00048         cout&lt;&lt;<span class="stringliteral">"**************************************\n"</span>&lt;&lt;endl;
00049         cout&lt;&lt;<span class="stringliteral">"As it is a financial products module, you first need to import market data."</span>&lt;&lt;endl;
00050         cout&lt;&lt;<span class="stringliteral">"Would you like to import your own data or use the stale one provided ? "</span>&lt;&lt;endl;
00051         cout&lt;&lt;<span class="stringliteral">"[The yield points come from the US swap market from Oct 5th, 2005]"</span>&lt;&lt;endl;
00052         cout&lt;&lt;<span class="stringliteral">"[The options are on -- (spot 2994) from July 16th, 2005]"</span>&lt;&lt;endl;
00053         cout&lt;&lt;<span class="stringliteral">"[The credit spreads are on -- from -- ]"</span>&lt;&lt;endl;
00054         cout&lt;&lt;<span class="stringliteral">"Type 1 to input your data files location, 2 to see the files format,\n Else another key to get default inputs:"</span>&lt;&lt;endl;
00055         string userWantsToImport;
00056         cin&gt;&gt;userWantsToImport;
00057         <a class="code" href="types_8h.html#a7">Natural</a> importNAt=atoi(userWantsToImport.c_str());
00058         <span class="keywordflow">if</span>(importNAt==2)
00059                 importNAt=<a class="code" href="classimportData.html#a3">displayFileFormatsMenu</a>();
00060         cout&lt;&lt;((importNAt==1) ? <span class="stringliteral">"\nYou will now choose your data:"</span> : <span class="stringliteral">"\nThe program will get its own data:"</span> )&lt;&lt;endl;
00061         <span class="keywordflow">if</span>(importNAt!=1){
00062                 _datadir=<a class="code" href="classFileReader.html#e4">FileReader::getdatadirasstring</a>();
00063                 <a class="code" href="classimportData.html#a5">importYieldCurve</a>();
00064                 <a class="code" href="classimportData.html#a6">importVolSurface</a>();
00065                 <a class="code" href="classimportData.html#a7">importCreditCurve</a>();
00066                 cout&lt;&lt;<span class="stringliteral">"--&gt; Default data imported\n"</span>&lt;&lt;endl;
00067                 <a class="code" href="classimportData.html#d0">setMarketData</a>();
00068                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00069         }
00070         <span class="keywordflow">else</span>{
00071                 <span class="keywordflow">return</span> <a class="code" href="classimportData.html#a4">runUserDefinedInterface</a>();
00072         }
00073 }
<a name="l00074"></a><a class="code" href="classimportData.html#d0">00074</a> <span class="keywordtype">void</span> <a class="code" href="classimportData.html#d0">importData::setMarketData</a>(){
00075         <a class="code" href="classimportData.html#r4">_marketData</a>.<a class="code" href="structmarketData.html#o0">yieldcurve</a>=<a class="code" href="classimportData.html#r1">_yc</a>;
00076         <a class="code" href="classimportData.html#r4">_marketData</a>.<a class="code" href="structmarketData.html#o2">vols</a>=<a class="code" href="classimportData.html#r3">_vs</a>;
00077         <a class="code" href="classimportData.html#r4">_marketData</a>.<a class="code" href="structmarketData.html#o1">creditcurve</a>=<a class="code" href="classimportData.html#r2">_cc</a>;
00078 }
00079 
<a name="l00080"></a><a class="code" href="classimportData.html#a4">00080</a> <span class="keywordtype">bool</span> <a class="code" href="classimportData.html#a4">importData::runUserDefinedInterface</a>(){
00081         <span class="keywordtype">bool</span> failure=<span class="keyword">true</span>;
00082         <span class="keywordtype">bool</span> input;
00083         <span class="keywordtype">bool</span> yc,vs,cs;
00084         string dataDir;
00085         cout&lt;&lt;<span class="stringliteral">"We need a spot for the call/put prices to calibrate the volatility surface, please input one"</span>&lt;&lt;endl;
00086         <a class="code" href="types_8h.html#a10">Real</a> spot;
00087         cin&gt;&gt;spot;
00088 
00089         <span class="keywordflow">while</span> (failure){
00090                 cout&lt;&lt;<span class="stringliteral">"\nNOTE:\n- Your own data should be in the SAME directory "</span>&lt;&lt;endl;
00091                 cout&lt;&lt;<span class="stringliteral">"- The yield curve name shoud be "</span>&lt;&lt;YCNAME&lt;&lt;endl;
00092                 cout&lt;&lt;<span class="stringliteral">"- The volatility suface name shoud be "</span>&lt;&lt;VSNAME&lt;&lt;endl;
00093                 cout&lt;&lt;<span class="stringliteral">"- The credit spreads name shoud be "</span>&lt;&lt;CSNAME&lt;&lt;endl;
00094                 cout&lt;&lt;<span class="stringliteral">"Please input the path where your data is located, ALL 3 files"</span>&lt;&lt;endl;
00095                 cin&gt;&gt;dataDir;
00096                 cout&lt;&lt;<span class="stringliteral">"\n"</span>&lt;&lt;endl;
00097                 yc=<a class="code" href="classFileReader.html#e0">FileReader::fileexists</a>(dataDir+<span class="stringliteral">"/"</span>+YCNAME);
00098                 vs=<a class="code" href="classFileReader.html#e0">FileReader::fileexists</a>(dataDir+<span class="stringliteral">"/"</span>+VSNAME);
00099                 cs=<a class="code" href="classFileReader.html#e0">FileReader::fileexists</a>(dataDir+<span class="stringliteral">"/"</span>+CSNAME);
00100                 failure=!(yc&amp;&amp;vs&amp;&amp;cs); <span class="comment">//if all are found, then failure will be false</span>
00101                 <span class="keywordflow">if</span>(failure){
00102                         <span class="keywordflow">if</span>(!yc)
00103                                 cout&lt;&lt;<span class="stringliteral">"- "</span>&lt;&lt;YCNAME&lt;&lt;<span class="stringliteral">" not found"</span>&lt;&lt;endl;
00104                         <span class="keywordflow">if</span>(!vs)
00105                                 cout&lt;&lt;<span class="stringliteral">"- "</span>&lt;&lt;VSNAME&lt;&lt;<span class="stringliteral">" not found"</span>&lt;&lt;endl;
00106                         <span class="keywordflow">if</span>(!cs)
00107                                 cout&lt;&lt;<span class="stringliteral">"- "</span>&lt;&lt;CSNAME&lt;&lt;<span class="stringliteral">" not found"</span>&lt;&lt;endl;
00108                         cout&lt;&lt;<span class="stringliteral">"Some data are not located where you speficied - do you want to re-input ?\nType 1 if yes, else another key "</span>&lt;&lt;endl;
00109                         cin&gt;&gt;input;
00110                         <span class="keywordflow">if</span>(!input){
00111                                 cout&lt;&lt;<span class="stringliteral">"Default import launched:"</span>&lt;&lt;endl;
00112                                 _datadir=<a class="code" href="classFileReader.html#e4">FileReader::getdatadirasstring</a>();
00113                                 <a class="code" href="classimportData.html#a5">importYieldCurve</a>();
00114                                 <a class="code" href="classimportData.html#a6">importVolSurface</a>();
00115                                 <a class="code" href="classimportData.html#a7">importCreditCurve</a>();
00116                                 cout&lt;&lt;<span class="stringliteral">"--&gt; Default data imported\n"</span>&lt;&lt;endl;
00117                                 <a class="code" href="classimportData.html#d0">setMarketData</a>();
00118                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00119                         }
00120                 }
00121         }
00122         _datadir=dataDir;
00123         <a class="code" href="classimportData.html#a5">importYieldCurve</a>(YCNAME);
00124         <a class="code" href="classimportData.html#a6">importVolSurface</a>(VSNAME,spot);
00125         <a class="code" href="classimportData.html#a7">importCreditCurve</a>(CSNAME);
00126         cout&lt;&lt;<span class="stringliteral">"--&gt; Personal data imported\n"</span>&lt;&lt;endl;
00127         <a class="code" href="classimportData.html#d0">setMarketData</a>();
00128         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00129 }
00130 
00131 
<a name="l00132"></a><a class="code" href="classimportData.html#a3">00132</a> <a class="code" href="types_8h.html#a7">Natural</a> <a class="code" href="classimportData.html#a3">importData::displayFileFormatsMenu</a>(){
00133         cout&lt;&lt;<span class="stringliteral">"\nHELP ON FILE FORMATS\n"</span>&lt;&lt;endl;
00134         cout&lt;&lt;<span class="stringliteral">"YIELD CURVE\nA csv file as follows, with on each line a rate,a maturity in years,and a rate type (Cash or Swap)."</span>&lt;&lt;endl;
00135         cout&lt;&lt;<span class="stringliteral">"For example a possible first line could be:\n"</span>&lt;&lt;endl;
00136         cout&lt;&lt;<span class="stringliteral">"0.041,0.25,Cash     &lt;-- Meaning the Cash rate of maturity 3 months is 4.1 percent\n\n"</span>&lt;&lt;endl;
00137 
00138         cout&lt;&lt;<span class="stringliteral">"VOLATILITIES\nAs csv file as follows:"</span>&lt;&lt;endl;
00139         cout&lt;&lt;<span class="stringliteral">"- The first 2 lines specify the number of maturities quoted and the number of strikes at these:\n"</span>&lt;&lt;endl;
00140         cout&lt;&lt;<span class="stringliteral">"maturities            ,    1\nstrikes               ,    2\n"</span>&lt;&lt;endl;
00141         cout&lt;&lt;<span class="stringliteral">"- Then a matrix of which the first column has the maturities in DD-MM-YYYY, "</span>&lt;&lt;endl;
00142         cout&lt;&lt;<span class="stringliteral">"and then alternatively prices at the given strike and the option type (c/p). For example:\n"</span>&lt;&lt;endl;
00143         cout&lt;&lt;<span class="stringliteral">"maturities / strikes  , 2395.95  , type, 2545.69  , type"</span>&lt;&lt;endl;
00144         cout&lt;&lt;<span class="stringliteral">"17-3-2006             , 693.1431 ,  c  , 561.4132 ,  c\n"</span>&lt;&lt;endl;
00145         cout&lt;&lt;<span class="stringliteral">"&lt;-- Meaning that for maturity 17-3-2006, the 2395.95 call is quoted 693.1431, and the 2545.69 is 561.4132\n\n"</span>&lt;&lt;endl;
00146 
00147         cout&lt;&lt;<span class="stringliteral">"CREDIT SPREADS\nA csv file as follows, with on each line a spread,a maturity in years,and a spread type (Abs or Rel)."</span>&lt;&lt;endl;
00148         cout&lt;&lt;<span class="stringliteral">"For example a possible first line could be:\n"</span>&lt;&lt;endl;
00149         cout&lt;&lt;<span class="stringliteral">"0.0014,2,Rel     &lt;-- Meaning the realtive credit spread rate of maturity 2 years is 14 bps\n\n"</span>&lt;&lt;endl;
00150 
00151         cout&lt;&lt;<span class="stringliteral">"Now that you know, would you like to import your own data or use the stale one provided ? "</span>&lt;&lt;endl;
00152         cout&lt;&lt;<span class="stringliteral">"Type 1 to input your data files location, else another key to get the default inputs:"</span>&lt;&lt;endl;
00153         <a class="code" href="types_8h.html#a7">Natural</a> userWantsToImport;
00154         cin&gt;&gt;userWantsToImport;
00155         <span class="keywordflow">return</span> userWantsToImport;
00156 }
00157 
</pre></div><hr size="1"><address style="align: right;"><small>
<b>Note: Generated nightly - reload for latest version</b><br>
Generated on Thu Dec 22 13:21:43 2005 for <a href="http://terreneuve.sourceforge.net">terreneuve</a> by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.3.6</small></address>
</body>
</html>
