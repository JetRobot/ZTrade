<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>rainbowoption.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>rainbowoption.cpp</h1><a href="rainbowoption_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include ".\rainbowoption.h"</span>
00002 
<a name="l00003"></a><a class="code" href="classRainbowOption.html#a0">00003</a> <a class="code" href="classRainbowOption.html#a0">RainbowOption::RainbowOption</a>(<span class="keywordtype">void</span>)
00004 {
00005         <a class="code" href="classDate.html">Date</a> today;
00006         today.<a class="code" href="classDate.html#a13">setDateToToday</a>();
00007         <a class="code" href="classRainbowOption.html#r1">_startDate</a>=today;
00008         <a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>=<a class="code" href="rainbowoption_8h.html#a3">RO_DEFAULT_MATURITY</a>;
00009         <a class="code" href="classRainbowOption.html#r4">_Strike</a>=<a class="code" href="rainbowoption_8h.html#a0">RO_DEFAULT_STRIKE</a>;
00010         <a class="code" href="classRainbowOption.html#r6">_Multiplier</a>=1;
00011         <a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>=<a class="code" href="rainbowoption_8h.html#a4">RO_DEFAULT_NB_ASSETS</a>;
00012         <a class="code" href="classRainbowOption.html#r7">_weights</a>=valarray&lt;Real&gt;(1/(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a> ,<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>);  <span class="comment">// equaly weighted</span>
00013         <a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>=<a class="code" href="matrix_8h.html#a0">IdentityMatrix</a>(<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>); <span class="comment">// we need the correlation to compute the paths</span>
00014         <a class="code" href="classRainbowOption.html#r9">_volatilities</a>=valarray&lt;Real&gt;(<a class="code" href="rainbowoption_8h.html#a1">RO_DEFAULT_VOL</a>,<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>);
00015         <a class="code" href="classRainbowOption.html#r10">_volatilitiesSurfaces</a>=valarray&lt;volsurface&gt;(<a class="code" href="classvolsurface.html">volsurface</a>(<a class="code" href="rainbowoption_8h.html#a1">RO_DEFAULT_VOL</a>),<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>);
00016         _yc=<a class="code" href="classyieldCurve.html">yieldCurve</a>(<a class="code" href="rainbowoption_8h.html#a2">RO_DEFAULT_RATE</a>); <span class="comment">// no quanto so risk free rate is unique.</span>
00017         <a class="code" href="classRainbowOption.html#r5">_spots</a>=valarray&lt;Real&gt;(<a class="code" href="rainbowoption_8h.html#a0">RO_DEFAULT_STRIKE</a>,<a class="code" href="rainbowoption_8h.html#a4">RO_DEFAULT_NB_ASSETS</a>);
00018 
00019         <a class="code" href="classRainbowOption.html#r14">_DFTomaturity</a>=_yc.<a class="code" href="classyieldCurve.html#a12">discountFactor</a>(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00020         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00021         <a class="code" href="classRainbowOption.html#r0">_outputMsgs</a>=<span class="keyword">false</span>;
00022         _type=<a class="code" href="rainbowoption_8h.html#a23a14">BestOf2AssetsCash</a>; <span class="comment">// the most famous one</span>
00023 
00024         <a class="code" href="classRainbowOption.html#r21">_seed</a>=(<a class="code" href="types_8h.html#a9">LongNatural</a>)<a class="code" href="rainbowoption_8h.html#a7">RO_SEED</a>;
00025         <a class="code" href="classMersenneTwister.html">MersenneTwister</a>* pRandGen = <span class="keyword">new</span> <a class="code" href="classMersenneTwister.html">MersenneTwister</a>(<a class="code" href="classRainbowOption.html#r21">_seed</a>);
00026         <a class="code" href="classRainbowOption.html#r16">_pRandom</a>=<span class="keyword">new</span> <a class="code" href="classRandom.html">Random</a>(pRandGen);
00027 }
00028 
<a name="l00029"></a><a class="code" href="classRainbowOption.html#a1">00029</a> <a class="code" href="classRainbowOption.html#a0">RainbowOption::RainbowOption</a>(rainbowType type,<a class="code" href="classDate.html">Date</a> startDate,<a class="code" href="types_8h.html#a10">Real</a> expiry,<a class="code" href="types_8h.html#a10">Real</a> Strike,<a class="code" href="classyieldCurve.html">yieldCurve</a> yc,valarray&lt;volsurface&gt; vols,valarray &lt;Real&gt; spots,<a class="code" href="types_8h.html#a10">Real</a> Multiplier,<a class="code" href="classMatrix.html">Matrix</a> Correl,valarray&lt;Real&gt; weights,<span class="keywordtype">bool</span> outputMsgs)
00030                                                          :      _type(type),
00031                                                                 _startDate(startDate),
00032                                                                 _expiryInYears(expiry),
00033                                                                 _Strike(Strike),
00034                                                                 _spots(spots),
00035                                                                 _yc(yc),
00036                                                                 _volatilitiesSurfaces(vols),
00037                                                                 _Multiplier(Multiplier),
00038                                                                 _CorrelationMatrix(Correl),
00039                                                                 _weights(weights),
00040                                                                 _outputMsgs(outputMsgs)
00041 {
00042         <a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>=<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>.<a class="code" href="classMatrix.html#a48">GetRows</a>();
00043         <a class="code" href="classRainbowOption.html#r13">_thePayOff</a>.<a class="code" href="classPayOff.html#a2">SetStrike</a>(<a class="code" href="classRainbowOption.html#r4">_Strike</a>);
00044         <a class="code" href="classRainbowOption.html#r14">_DFTomaturity</a>=_yc.<a class="code" href="classyieldCurve.html#a12">discountFactor</a>(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00045         <a class="code" href="classRainbowOption.html#d18">reassignVolsAtThestrike</a>();
00046         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00047         <a class="code" href="classRainbowOption.html#r21">_seed</a>=(<a class="code" href="types_8h.html#a9">LongNatural</a>)<a class="code" href="rainbowoption_8h.html#a7">RO_SEED</a>;
00048         <a class="code" href="classMersenneTwister.html">MersenneTwister</a>* pRandGen = <span class="keyword">new</span> <a class="code" href="classMersenneTwister.html">MersenneTwister</a>(<a class="code" href="classRainbowOption.html#r21">_seed</a>);
00049         <a class="code" href="classRainbowOption.html#r16">_pRandom</a>=<span class="keyword">new</span> <a class="code" href="classRandom.html">Random</a>(pRandGen);
00050 }
00051 
<a name="l00052"></a><a class="code" href="classRainbowOption.html#a2">00052</a> <a class="code" href="classRainbowOption.html#a0">RainbowOption::RainbowOption</a>(rainbowType type,<a class="code" href="classDate.html">Date</a> start,<a class="code" href="types_8h.html#a10">Real</a> exp,<a class="code" href="types_8h.html#a10">Real</a> Strike,<a class="code" href="classyieldCurve.html">yieldCurve</a> yc,valarray&lt;volsurface&gt; vols,<a class="code" href="types_8h.html#a10">Real</a> Spot1,<a class="code" href="types_8h.html#a10">Real</a> Spot2,<a class="code" href="types_8h.html#a10">Real</a> Mult,<a class="code" href="types_8h.html#a10">Real</a> Correl12,<a class="code" href="types_8h.html#a10">Real</a> weight1,<a class="code" href="types_8h.html#a10">Real</a> weight2,<span class="keywordtype">bool</span> outputMsgs)
00053                                                          :      _type(type),
00054                                                                 _startDate(start),
00055                                                                 _expiryInYears(exp),
00056                                                                 _Strike(Strike),
00057                                                                 _yc(yc),
00058                                                                 _volatilitiesSurfaces(vols),
00059                                                                 _Multiplier(Mult),
00060                                                                 _outputMsgs(outputMsgs)
00061 {
00062         <a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a> =2;
00063         <a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>=<a class="code" href="matrix_8h.html#a0">IdentityMatrix</a>(<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>);
00064         <a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>.<a class="code" href="classMatrix.html#a53">SetValue</a>(1,0,Correl12);
00065         <a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>.<a class="code" href="classMatrix.html#a53">SetValue</a>(0,1,Correl12);
00066 
00067         <a class="code" href="classRainbowOption.html#r7">_weights</a>=valarray&lt;Real&gt;(<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>);
00068         <a class="code" href="classRainbowOption.html#r7">_weights</a>[0]=weight1;
00069         <a class="code" href="classRainbowOption.html#r7">_weights</a>[1]=weight2;
00070 
00071         <a class="code" href="classRainbowOption.html#r5">_spots</a>=valarray&lt;Real&gt;(<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>);
00072         <a class="code" href="classRainbowOption.html#r5">_spots</a>[0]=Spot1 ;
00073         <a class="code" href="classRainbowOption.html#r5">_spots</a>[1]=Spot2 ;
00074         
00075         <a class="code" href="classRainbowOption.html#r14">_DFTomaturity</a>=_yc.<a class="code" href="classyieldCurve.html#a12">discountFactor</a>(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00076         <a class="code" href="classRainbowOption.html#r9">_volatilities</a>.resize(<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>);
00077 
00078         <a class="code" href="classRainbowOption.html#d18">reassignVolsAtThestrike</a>();
00079         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;      
00080         <a class="code" href="classRainbowOption.html#r21">_seed</a>=(<a class="code" href="types_8h.html#a9">LongNatural</a>)<a class="code" href="rainbowoption_8h.html#a7">RO_SEED</a>;
00081         <a class="code" href="classMersenneTwister.html">MersenneTwister</a>* pRandGen = <span class="keyword">new</span> <a class="code" href="classMersenneTwister.html">MersenneTwister</a>(<a class="code" href="classRainbowOption.html#r21">_seed</a>);
00082         <a class="code" href="classRainbowOption.html#r16">_pRandom</a>=<span class="keyword">new</span> <a class="code" href="classRandom.html">Random</a>(pRandGen);
00083 }
00084 
<a name="l00085"></a><a class="code" href="classRainbowOption.html#a4">00085</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#a4">RainbowOption::getPrice</a>(priceType priceMethod,<a class="code" href="types_8h.html#a9">LongNatural</a> nPaths){         
00086         <a class="code" href="types_8h.html#a10">Real</a> price;
00087         <span class="keywordflow">switch</span> (_type) {
00088                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a23a12">SpreadOptionMax</a>:<span class="comment">//no closed form</span>
00089                         <span class="keywordflow">if</span>((priceMethod!=<a class="code" href="rainbowoption_8h.html#a22a10">MonteCarlo</a>)&amp;&amp;(<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a>))
00090                                 cout&lt;&lt;<span class="stringliteral">"In pricing the rainbow spread, you specified Closed form and there is no closed form\nPrice will be MC"</span>&lt;&lt;endl;
00091                         price=<a class="code" href="classRainbowOption.html#d0">PriceByMc_2SpreadOptionMax</a>(nPaths);
00092                         <span class="keywordflow">break</span>;
00093                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a23a13">AssetsBasketMax</a>:<span class="comment">//no closed form</span>
00094                         <span class="keywordflow">if</span>((priceMethod!=<a class="code" href="rainbowoption_8h.html#a22a10">MonteCarlo</a>)&amp;&amp;(<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a>))
00095                                 cout&lt;&lt;<span class="stringliteral">"In pricing the rainbow basket, you specified Closed form and there is no closed form\nPrice will be MC"</span>&lt;&lt;endl;
00096                         price=<a class="code" href="classRainbowOption.html#d1">PriceByMc_2AssetsBasketMax</a>(nPaths);
00097                         <span class="keywordflow">break</span>;
00098                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a23a14">BestOf2AssetsCash</a>:
00099                         <span class="keywordflow">switch</span>(priceMethod){
00100                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a10">MonteCarlo</a>:
00101                                         price=<a class="code" href="classRainbowOption.html#d2">PriceByMc_BestOf2AssetsCash</a>(nPaths);
00102                                         <span class="keywordflow">break</span>;
00103                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a11">ClosedForm</a>:
00104                                         price=<a class="code" href="classRainbowOption.html#d10">PriceByClosedForm_BestOf2_plusCash</a>();
00105                                         <span class="keywordflow">break</span>;
00106                         }
00107                         <span class="keywordflow">break</span>;
00108                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a23a15">WorstOf2AssetsCash</a>:<span class="comment">//no closed form</span>
00109                         <span class="keywordflow">if</span>((priceMethod!=<a class="code" href="rainbowoption_8h.html#a22a10">MonteCarlo</a>)&amp;&amp;(<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a>))
00110                                 cout&lt;&lt;<span class="stringliteral">"In pricing the rainbow Worst of + cash, you specified Closed form and there is no closed form\nPrice will be MC"</span>&lt;&lt;endl;
00111                         price=<a class="code" href="classRainbowOption.html#d3">PriceByMc_WorstOf2AssetsCash</a>(nPaths);
00112                         <span class="keywordflow">break</span>;
00113                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a23a16">BetterOf2Assets</a>:
00114                         <span class="keywordflow">switch</span>(priceMethod){
00115                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a10">MonteCarlo</a>:
00116                                         price=<a class="code" href="classRainbowOption.html#d4">PriceByMc_BetterOf2Assets</a>(nPaths);
00117                                         <span class="keywordflow">break</span>;
00118                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a11">ClosedForm</a>:
00119                                         price=<a class="code" href="classRainbowOption.html#d11">PriceByClosedForm_BetterOf2</a>();
00120                                         <span class="keywordflow">break</span>;
00121                         }
00122                         <span class="keywordflow">break</span>;
00123                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a23a17">WorseOf2Assets</a>:
00124                         <span class="keywordflow">switch</span>(priceMethod){
00125                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a10">MonteCarlo</a>:
00126                                         price=<a class="code" href="classRainbowOption.html#d5">PriceByMc_WorseOf2Assets</a>(nPaths);
00127                                         <span class="keywordflow">break</span>;
00128                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a11">ClosedForm</a>:
00129                                         price=<a class="code" href="classRainbowOption.html#d12">PriceByClosedForm_WorseOf2</a>();
00130                                         <span class="keywordflow">break</span>;
00131                         }
00132                         <span class="keywordflow">break</span>;
00133                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a23a18">Max2AssetsCall</a>:
00134                         <span class="keywordflow">switch</span>(priceMethod){
00135                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a10">MonteCarlo</a>:
00136                                         price=<a class="code" href="classRainbowOption.html#d6">PriceByMc_Max2AssetsCall</a>(nPaths);
00137                                         <span class="keywordflow">break</span>;
00138                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a11">ClosedForm</a>:
00139                                         price=<a class="code" href="classRainbowOption.html#d13">PriceByClosedForm_MaxOf2_call</a>();
00140                                         <span class="keywordflow">break</span>;
00141                         }
00142                         <span class="keywordflow">break</span>;
00143                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a23a19">Min2AssetsCall</a>:
00144                         <span class="keywordflow">switch</span>(priceMethod){
00145                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a10">MonteCarlo</a>:
00146                                         price=<a class="code" href="classRainbowOption.html#d7">PriceByMc_Min2AssetsCall</a>(nPaths);
00147                                         <span class="keywordflow">break</span>;
00148                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a11">ClosedForm</a>:
00149                                         price=<a class="code" href="classRainbowOption.html#d14">PriceByClosedForm_MinOf2_call</a>();
00150                                         <span class="keywordflow">break</span>;
00151                         }
00152                         <span class="keywordflow">break</span>;
00153                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a23a20">Max2AssetsPut</a>:
00154                         <span class="keywordflow">switch</span>(priceMethod){
00155                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a10">MonteCarlo</a>:
00156                                         price=<a class="code" href="classRainbowOption.html#d8">PriceByMc_Max2AssetsPut</a>(nPaths);
00157                                         <span class="keywordflow">break</span>;
00158                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a11">ClosedForm</a>:
00159                                         price=<a class="code" href="classRainbowOption.html#d15">PriceByClosedForm_MaxOf2_put</a>();
00160                                         <span class="keywordflow">break</span>;
00161                         }
00162                         <span class="keywordflow">break</span>;
00163                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a23a21">Min2AssetsPut</a>:
00164                         <span class="keywordflow">switch</span>(priceMethod){
00165                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a10">MonteCarlo</a>:
00166                                         price=<a class="code" href="classRainbowOption.html#d9">PriceByMc_Min2AssetsPut</a>(nPaths);
00167                                         <span class="keywordflow">break</span>;
00168                                 <span class="keywordflow">case</span> <a class="code" href="rainbowoption_8h.html#a22a11">ClosedForm</a>:
00169                                         price=<a class="code" href="classRainbowOption.html#d16">PriceByClosedForm_MinOf2_put</a>();
00170                                         <span class="keywordflow">break</span>;
00171                         }
00172                         <span class="keywordflow">break</span>;
00173         }
00174         <span class="keywordflow">return</span> price;
00175 }
00176 
<a name="l00177"></a><a class="code" href="classRainbowOption.html#a5">00177</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#a5">RainbowOption::getPartialDelta</a>(<a class="code" href="types_8h.html#a7">Natural</a> security,priceType priceMethod){
00178         <span class="keywordtype">bool</span> outputmsgstate=<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a> ;
00179         _outputMsgs=<span class="keyword">false</span>; <span class="comment">// in case we are in the case where user wants to see things</span>
00180         <a class="code" href="types_8h.html#a7">Natural</a> secIndexInSpotArray = (((security &gt; 0)&amp;&amp;(security &lt;=<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>) )? security -1: 0); <span class="comment">// in case he enters 0..</span>
00181         <a class="code" href="types_8h.html#a10">Real</a> priceup,pricedown;
00182 
00183         <a class="code" href="types_8h.html#a10">Real</a> oldSpot=<a class="code" href="classRainbowOption.html#r5">_spots</a>[secIndexInSpotArray]; <span class="comment">// save it</span>
00184         <a class="code" href="types_8h.html#a10">Real</a> spotUp=oldSpot*(1.0+(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="rainbowoption_8h.html#a9">GREEKAPPROX</a>),spotDown=oldSpot*(1.0-(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="rainbowoption_8h.html#a9">GREEKAPPROX</a>);
00185         _spots[secIndexInSpotArray]=spotUp;
00186         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00187         priceup=<a class="code" href="classRainbowOption.html#a4">getPrice</a>(priceMethod);<span class="comment">// even if we do not have the closed form, the switch should get the MC</span>
00188         _spots[secIndexInSpotArray]=spotDown;
00189         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00190         pricedown=<a class="code" href="classRainbowOption.html#a4">getPrice</a>(priceMethod);<span class="comment">// even if we do not have the   closed form, the switch should get the MC</span>
00191         _spots[secIndexInSpotArray]=oldSpot; <span class="comment">// put it back</span>
00192         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00193 
00194         _outputMsgs=outputmsgstate; <span class="comment">// where it was</span>
00195         <span class="keywordflow">return</span> (priceup-pricedown)/(2.0*(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="rainbowoption_8h.html#a9">GREEKAPPROX</a>);
00196 }
00197 
<a name="l00198"></a><a class="code" href="classRainbowOption.html#a6">00198</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#a6">RainbowOption::getPartialGamma</a>(<a class="code" href="types_8h.html#a7">Natural</a> security,priceType priceMethod){
00199         <span class="keywordtype">bool</span> outputmsgstate=<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a> ;
00200         _outputMsgs=<span class="keyword">false</span>; <span class="comment">// in case we are in the case where user wants to see things</span>
00201         <a class="code" href="types_8h.html#a7">Natural</a> secIndexInSpotArray = (((security &gt; 0)&amp;&amp;(security &lt;=<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>) )? security -1: 0); <span class="comment">// in case he enters 0..</span>
00202         <a class="code" href="types_8h.html#a10">Real</a> deltaup,deltadown;
00203 
00204         <a class="code" href="types_8h.html#a10">Real</a> oldSpot=<a class="code" href="classRainbowOption.html#r5">_spots</a>[secIndexInSpotArray]; <span class="comment">// save it</span>
00205         <a class="code" href="types_8h.html#a10">Real</a> spotUp=oldSpot*(1.0+(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="rainbowoption_8h.html#a9">GREEKAPPROX</a>),spotDown=oldSpot*(1.0-(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="rainbowoption_8h.html#a9">GREEKAPPROX</a>);
00206         _spots[secIndexInSpotArray]=spotUp;
00207         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00208         deltaup=<a class="code" href="classRainbowOption.html#a5">getPartialDelta</a>(security,priceMethod);<span class="comment">// even if we do not have the closed form, the switch should get the MC</span>
00209         _spots[secIndexInSpotArray]=spotDown;
00210         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00211         deltadown=<a class="code" href="classRainbowOption.html#a5">getPartialDelta</a>(security,priceMethod);<span class="comment">// even if we do not have the closed form, the switch should get the MC</span>
00212         _spots[secIndexInSpotArray]=oldSpot; <span class="comment">// put it back</span>
00213         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00214 
00215         _outputMsgs=outputmsgstate; <span class="comment">// where it was</span>
00216         <span class="keywordflow">return</span> (deltaup-deltadown)/(2.0*(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="rainbowoption_8h.html#a9">GREEKAPPROX</a>);
00217 }
00218 
<a name="l00219"></a><a class="code" href="classRainbowOption.html#a7">00219</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#a7">RainbowOption::getPartialVega</a>(<a class="code" href="types_8h.html#a7">Natural</a> security,priceType priceMethod){
00220         <span class="keywordtype">bool</span> outputmsgstate=<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a> ;
00221         _outputMsgs=<span class="keyword">false</span>; <span class="comment">// in case we are in the case where user wants to see things</span>
00222         <a class="code" href="types_8h.html#a7">Natural</a> secIndexInSpotArray = (((security &gt; 0)&amp;&amp;(security &lt;=<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>) )? security -1: 0); <span class="comment">// in case he enters 0..</span>
00223         <a class="code" href="types_8h.html#a10">Real</a> priceup,pricedown;
00224 
00225         <a class="code" href="types_8h.html#a10">Real</a> oldVol=<a class="code" href="classRainbowOption.html#r9">_volatilities</a> [secIndexInSpotArray]; <span class="comment">// save it</span>
00226         <a class="code" href="types_8h.html#a10">Real</a> volUp=oldVol*(1.0+(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="rainbowoption_8h.html#a9">GREEKAPPROX</a>),volDown=oldVol*(1.0-(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="rainbowoption_8h.html#a9">GREEKAPPROX</a>);
00227         _volatilities[secIndexInSpotArray]=volUp;
00228         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00229         priceup=<a class="code" href="classRainbowOption.html#a4">getPrice</a>(priceMethod);<span class="comment">// even if we do not have the closed form, the switch should get the MC</span>
00230         _volatilities[secIndexInSpotArray]=volDown;
00231         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00232         pricedown=<a class="code" href="classRainbowOption.html#a4">getPrice</a>(priceMethod);<span class="comment">// even if we do not have the closed form, the switch should get the MC</span>
00233         _volatilities[secIndexInSpotArray]=oldVol; <span class="comment">// put it back</span>
00234         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00235 
00236         _outputMsgs=outputmsgstate; <span class="comment">// where it was</span>
00237         <span class="keywordflow">return</span> (priceup-pricedown)/(2.0*(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="rainbowoption_8h.html#a9">GREEKAPPROX</a>);
00238 }
00239 
<a name="l00240"></a><a class="code" href="classRainbowOption.html#a8">00240</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#a8">RainbowOption::getDelta</a>(priceType priceMethod){
00241         <a class="code" href="classMatrix.html">Matrix</a> partialDeltas=<a class="code" href="classMatrix.html">Matrix</a>(0.0,<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>,1);
00242         <span class="keywordflow">for</span>(<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>;i++){
00243                 partialDeltas.<a class="code" href="classMatrix.html#a53">SetValue</a>(i,0,<a class="code" href="classRainbowOption.html#a5">getPartialDelta</a>(i,priceMethod));
00244         }
00245         <span class="keywordflow">return</span> partialDeltas.<a class="code" href="classMatrix.html#a34">SumColumn</a>(0);
00246 }
00247 
<a name="l00248"></a><a class="code" href="classRainbowOption.html#a9">00248</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#a9">RainbowOption::getGamma</a>(priceType priceMethod){
00249         <a class="code" href="classMatrix.html">Matrix</a> partialGammas=<a class="code" href="classMatrix.html">Matrix</a>(0.0,<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>,1);
00250         <span class="keywordflow">for</span>(<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>;i++){
00251                 partialGammas.<a class="code" href="classMatrix.html#a53">SetValue</a>(i,0,<a class="code" href="classRainbowOption.html#a6">getPartialGamma</a>(i,priceMethod));
00252         }
00253         <span class="keywordflow">return</span> partialGammas.<a class="code" href="classMatrix.html#a34">SumColumn</a>(0);
00254 }
00255 
<a name="l00256"></a><a class="code" href="classRainbowOption.html#a10">00256</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#a10">RainbowOption::getVega</a>(priceType priceMethod){
00257         <a class="code" href="classMatrix.html">Matrix</a> partialVegas=<a class="code" href="classMatrix.html">Matrix</a>(0.0,<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>,1);
00258         <span class="keywordflow">for</span>(<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>;i++){
00259                 partialVegas.<a class="code" href="classMatrix.html#a53">SetValue</a>(i,0,<a class="code" href="classRainbowOption.html#a7">getPartialVega</a>(i,priceMethod));
00260         }
00261         <span class="keywordflow">return</span> partialVegas.<a class="code" href="classMatrix.html#a34">SumColumn</a>(0);
00262 }
00263 
<a name="l00264"></a><a class="code" href="classRainbowOption.html#a11">00264</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#a11">RainbowOption::getCorrelRisk</a>(priceType priceMethod){
00265         <span class="keywordtype">bool</span> outputmsgstate=<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a> ;
00266         _outputMsgs=<span class="keyword">false</span>; <span class="comment">// in case we are in the case where user wants to see things</span>
00267         <a class="code" href="types_8h.html#a10">Real</a> priceup,pricedown;
00268 
00269         <a class="code" href="classMatrix.html">Matrix</a> oldCorrel=<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>; <span class="comment">// save it</span>
00270         <a class="code" href="types_8h.html#a7">Natural</a> size=(<a class="code" href="types_8h.html#a7">Natural</a>)_CorrelationMatrix.<a class="code" href="classMatrix.html#a48">GetRows</a>();
00271         <a class="code" href="classMatrix.html">Matrix</a> corrup=_CorrelationMatrix,corrdown=_CorrelationMatrix;
00272         <a class="code" href="types_8h.html#a10">Real</a> multup=(1.0+(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="rainbowoption_8h.html#a9">GREEKAPPROX</a>);
00273         <a class="code" href="types_8h.html#a10">Real</a> multdown=(1.0-(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="rainbowoption_8h.html#a9">GREEKAPPROX</a>);
00274         <a class="code" href="types_8h.html#a10">Real</a> tempmult;<span class="comment">//if corr =1 or -1, we cannot go beyond...</span>
00275         <span class="keywordflow">for</span>(<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;size;i++){
00276                 <span class="keywordflow">for</span>(<a class="code" href="types_8h.html#a7">Natural</a> j=0;j&lt;size;j++){
00277                         <span class="keywordflow">if</span>(i!=j){
00278                                 <span class="keywordflow">if</span>(<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>(i,j)==1){
00279                                         tempmult=multup;
00280                                         multup=1;
00281                                 }
00282                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>(i,j)==-1){
00283                                         tempmult=multdown ;
00284                                         multdown =1;
00285                                 }
00286                                 corrup.<a class="code" href="classMatrix.html#a53">SetValue</a>(i,j,multup*<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>(i,j));
00287                                 corrdown.<a class="code" href="classMatrix.html#a53">SetValue</a>(i,j,multdown*_CorrelationMatrix (i,j));
00288 
00289                                 <span class="keywordflow">if</span>(<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>(i,j)==1)
00290                                         multup=tempmult;
00291                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>(i,j)==-1)
00292                                         multdown =tempmult;
00293                         }
00294                 }
00295         }
00296         
00297         _CorrelationMatrix =corrup;
00298         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00299         priceup=<a class="code" href="classRainbowOption.html#a4">getPrice</a>(priceMethod);<span class="comment">// even if we do not have the closed form, the switch should get the MC</span>
00300         _CorrelationMatrix =corrdown;
00301         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00302         pricedown=<a class="code" href="classRainbowOption.html#a4">getPrice</a>(priceMethod);<span class="comment">// even if we do not have the closed form, the switch should get the MC</span>
00303         _CorrelationMatrix =oldCorrel; <span class="comment">// put it back</span>
00304         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00305 
00306         _outputMsgs=outputmsgstate; <span class="comment">// where it was</span>
00307         <span class="keywordflow">return</span> (priceup-pricedown)/(2.0*(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="rainbowoption_8h.html#a9">GREEKAPPROX</a>);
00308 }
00309 
<a name="l00310"></a><a class="code" href="classRainbowOption.html#a12">00310</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#a12">RainbowOption::getRho</a>(priceType priceMethod){
00311         <span class="keywordtype">bool</span> outputmsgstate=<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a> ;
00312         _outputMsgs=<span class="keyword">false</span>; <span class="comment">// in case we are in the case where user wants to see things</span>
00313         <a class="code" href="types_8h.html#a10">Real</a> priceup,pricedown;
00314 
00315         <a class="code" href="classyieldCurve.html">yieldCurve</a> oldYc=_yc; <span class="comment">// save it</span>
00316         <a class="code" href="classyieldCurve.html">yieldCurve</a> ycup=_yc.<a class="code" href="classyieldCurve.html#a4">shiftZCBRateCurve</a>(0.001),ycdown=_yc.<a class="code" href="classyieldCurve.html#a4">shiftZCBRateCurve</a>(-0.001);
00317 
00318         _yc =ycup;
00319         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00320         priceup=<a class="code" href="classRainbowOption.html#a4">getPrice</a>(priceMethod);<span class="comment">// even if we do not have the closed form, the switch should get the MC</span>
00321         _yc =ycdown;
00322         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00323         pricedown=<a class="code" href="classRainbowOption.html#a4">getPrice</a>(priceMethod);<span class="comment">// even if we do not have the closed form, the switch should get the MC</span>
00324         _yc =oldYc; <span class="comment">// put it back</span>
00325         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00326 
00327         _outputMsgs=outputmsgstate; <span class="comment">// where it was</span>
00328         <span class="keywordflow">return</span> (priceup-pricedown)/(2.0*(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="rainbowoption_8h.html#a9">GREEKAPPROX</a>);
00329 }
00330 
<a name="l00331"></a><a class="code" href="classRainbowOption.html#a13">00331</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#a13">RainbowOption::getTheta</a>(priceType priceMethod){
00332         <a class="code" href="types_8h.html#a10">Real</a> timeStep=1/365.0;
00333         <span class="keywordtype">bool</span> outputmsgstate=<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a> ;
00334         _outputMsgs=<span class="keyword">false</span>; <span class="comment">// in case we are in the case where user wants to see things</span>
00335         <a class="code" href="types_8h.html#a10">Real</a> priceup,pricedown;
00336 
00337         <a class="code" href="types_8h.html#a10">Real</a> oldMat=<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>; <span class="comment">// save it</span>
00338         <a class="code" href="types_8h.html#a10">Real</a> up=_expiryInYears+timeStep,down=_expiryInYears-timeStep;
00339 
00340         _expiryInYears =up;
00341         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00342         priceup=<a class="code" href="classRainbowOption.html#a4">getPrice</a>(priceMethod);<span class="comment">// even if we do not have the closed form, the switch should get the MC</span>
00343         _expiryInYears =down;
00344         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00345         pricedown=<a class="code" href="classRainbowOption.html#a4">getPrice</a>(priceMethod);<span class="comment">// even if we do not have the closed form, the switch should get the MC</span>
00346         _expiryInYears =oldMat; <span class="comment">// put it back</span>
00347         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;
00348 
00349         _outputMsgs=outputmsgstate; <span class="comment">// where it was</span>
00350         <span class="keywordflow">return</span> (priceup-pricedown)/(2.0*timeStep);      
00351 }
00352 
00353 
<a name="l00354"></a><a class="code" href="classRainbowOption.html#d19">00354</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d19">RainbowOption::instanciateMCVariables</a>()
00355 {
00356         <a class="code" href="types_8h.html#a7">Natural</a> i;
00357         <a class="code" href="classRainbowOption.html#r15">_Drifts</a>.resize(<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>);
00358         <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>;i++){
00359                 <a class="code" href="classRainbowOption.html#r15">_Drifts</a>[i]=<a class="code" href="classDrift.html">Drift</a>(<a class="code" href="classRainbowOption.html#r1">_startDate</a>,<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>,_yc.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>),<a class="code" href="classRainbowOption.html#r9">_volatilities</a>[i]);
00360         }
00361         <a class="code" href="classRainbowOption.html#r13">_thePayOff</a>.<a class="code" href="classPayOff.html#a2">SetStrike</a>(<a class="code" href="classRainbowOption.html#r4">_Strike</a>);
00362         <a class="code" href="classRainbowOption.html#r16">_pRandom</a>-&gt;<a class="code" href="classRandom.html#a7">SetSeed</a>(<a class="code" href="rainbowoption_8h.html#a7">RO_SEED</a>);
00363         <a class="code" href="classRainbowOption.html#r18">_gaussianSample</a>=0.;
00364         <a class="code" href="classRainbowOption.html#r19">_TerminalPoints</a>.resize(_NumberOfAssets);
00365         <a class="code" href="classRainbowOption.html#r20">_pHazardRateProcesses</a>.resize(_NumberOfAssets);
00366         <span class="keywordflow">for</span>(i=0;i&lt;_NumberOfAssets;i++)
00367         {
00368                 <a class="code" href="classRainbowOption.html#r20">_pHazardRateProcesses</a>[i]=<a class="code" href="classGaussianProcess.html">GaussianProcess</a>(<a class="code" href="classRainbowOption.html#r15">_Drifts</a>[i].GetvDates(),1,<a class="code" href="classRainbowOption.html#r5">_spots</a>[i],<a class="code" href="classRainbowOption.html#r15">_Drifts</a>[i].GetvDrift(),0.0,<a class="code" href="classRainbowOption.html#r9">_volatilities</a>[i]);
00369         }
00370 }
00371 
<a name="l00372"></a><a class="code" href="classRainbowOption.html#d18">00372</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d18">RainbowOption::reassignVolsAtThestrike</a>(){
00373         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>;i++)
00374                 <a class="code" href="classRainbowOption.html#r9">_volatilities</a>[i]=<a class="code" href="classRainbowOption.html#r10">_volatilitiesSurfaces</a>[i].volatility(<a class="code" href="classRainbowOption.html#r4">_Strike</a>,<a class="code" href="classRainbowOption.html#r1">_startDate</a>.<a class="code" href="classDate.html#a28">plusDays</a>((<a class="code" href="types_8h.html#a7">Natural</a>)(365*<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>)));
00375 
00376 }
00377 
<a name="l00378"></a><a class="code" href="classRainbowOption.html#d17">00378</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d17">RainbowOption::reassignVolsAtThemoney</a>(){
00379         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;<a class="code" href="classRainbowOption.html#r3">_NumberOfAssets</a>;i++)<span class="comment">// ATM is the more probable approximation</span>
00380                 <a class="code" href="classRainbowOption.html#r9">_volatilities</a>[i]=<a class="code" href="classRainbowOption.html#r10">_volatilitiesSurfaces</a>[i].volatility(<a class="code" href="classRainbowOption.html#r5">_spots</a>[i],<a class="code" href="classRainbowOption.html#r1">_startDate</a>.<a class="code" href="classDate.html#a28">plusDays</a>((<a class="code" href="types_8h.html#a7">Natural</a>)(365*<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>)));
00381 }
00382 
<a name="l00383"></a><a class="code" href="classRainbowOption.html#d0">00383</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d0">RainbowOption::PriceByMc_2SpreadOptionMax</a>(<a class="code" href="types_8h.html#a9">LongNatural</a> nPaths)
00384 {
00385         <span class="comment">// vol is to be adjusted atm, as W1*S1-W2*S2-K, the K has nothing to do with strike in the vol sense</span>
00386         <span class="comment">//reassignVolsAtThemoney();</span>
00387         <a class="code" href="classRainbowOption.html#d19">instanciateMCVariables</a>();
00388         
00389         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>=<a class="code" href="classMCEngine.html">MCEngine</a>(nPaths,<a class="code" href="classRainbowOption.html#r14">_DFTomaturity</a>);
00390         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a4">RunEngineRainbow2SpreadOptionMax</a>(<a class="code" href="classRainbowOption.html#r16">_pRandom</a>,<a class="code" href="classRainbowOption.html#r20">_pHazardRateProcesses</a>,<a class="code" href="classRainbowOption.html#r13">_thePayOff</a>,<a class="code" href="classRainbowOption.html#r18">_gaussianSample</a>,<a class="code" href="classRainbowOption.html#r19">_TerminalPoints</a>,<a class="code" href="classRainbowOption.html#r7">_weights</a>,<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>,<a class="code" href="classRainbowOption.html#r6">_Multiplier</a>);
00391         <span class="comment">//reassignVolsAtThestrike();// put them back</span>
00392         <span class="keywordflow">return</span> <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a23">MCResult</a>();
00393 }
00394 
<a name="l00395"></a><a class="code" href="classRainbowOption.html#d1">00395</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d1">RainbowOption::PriceByMc_2AssetsBasketMax</a>(<a class="code" href="types_8h.html#a9">LongNatural</a> nPaths)
00396 {
00397         <a class="code" href="classRainbowOption.html#d19">instanciateMCVariables</a>();
00398         
00399         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>=<a class="code" href="classMCEngine.html">MCEngine</a>(nPaths,<a class="code" href="classRainbowOption.html#r14">_DFTomaturity</a>);
00400         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a5">RunEngineRainbow2AssetsBasketMax</a>(<a class="code" href="classRainbowOption.html#r16">_pRandom</a>,<a class="code" href="classRainbowOption.html#r20">_pHazardRateProcesses</a>,<a class="code" href="classRainbowOption.html#r13">_thePayOff</a>,<a class="code" href="classRainbowOption.html#r18">_gaussianSample</a>,<a class="code" href="classRainbowOption.html#r19">_TerminalPoints</a>,<a class="code" href="classRainbowOption.html#r7">_weights</a>,<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>,<a class="code" href="classRainbowOption.html#r6">_Multiplier</a>);
00401         <span class="keywordflow">return</span> <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a23">MCResult</a>();
00402 }
00403 
<a name="l00404"></a><a class="code" href="classRainbowOption.html#d2">00404</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d2">RainbowOption::PriceByMc_BestOf2AssetsCash</a>(<a class="code" href="types_8h.html#a9">LongNatural</a> nPaths)
00405 {
00406         <a class="code" href="classRainbowOption.html#d19">instanciateMCVariables</a>();
00407         
00408         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>=<a class="code" href="classMCEngine.html">MCEngine</a>(nPaths,<a class="code" href="classRainbowOption.html#r14">_DFTomaturity</a>);
00409         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a6">RunEngineRainbowBestOf2AssetsCash</a>(<a class="code" href="classRainbowOption.html#r16">_pRandom</a>,<a class="code" href="classRainbowOption.html#r20">_pHazardRateProcesses</a>,<a class="code" href="classRainbowOption.html#r13">_thePayOff</a>,<a class="code" href="classRainbowOption.html#r18">_gaussianSample</a>,<a class="code" href="classRainbowOption.html#r19">_TerminalPoints</a>,<a class="code" href="classRainbowOption.html#r7">_weights</a>,<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>);
00410         <span class="keywordflow">return</span> <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a23">MCResult</a>();
00411 }
00412 
<a name="l00413"></a><a class="code" href="classRainbowOption.html#d3">00413</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d3">RainbowOption::PriceByMc_WorstOf2AssetsCash</a>(<a class="code" href="types_8h.html#a9">LongNatural</a> nPaths)
00414 {
00415         <a class="code" href="classRainbowOption.html#d19">instanciateMCVariables</a>();
00416         
00417         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>=<a class="code" href="classMCEngine.html">MCEngine</a>(nPaths,<a class="code" href="classRainbowOption.html#r14">_DFTomaturity</a>);
00418         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a7">RunEngineRainbowWorstOf2AssetsCash</a>(<a class="code" href="classRainbowOption.html#r16">_pRandom</a>,<a class="code" href="classRainbowOption.html#r20">_pHazardRateProcesses</a>,<a class="code" href="classRainbowOption.html#r13">_thePayOff</a>,<a class="code" href="classRainbowOption.html#r18">_gaussianSample</a>,<a class="code" href="classRainbowOption.html#r19">_TerminalPoints</a>,<a class="code" href="classRainbowOption.html#r7">_weights</a>,<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>);
00419         <span class="keywordflow">return</span> <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a23">MCResult</a>();
00420 }
00421 
<a name="l00422"></a><a class="code" href="classRainbowOption.html#d4">00422</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d4">RainbowOption::PriceByMc_BetterOf2Assets</a>(<a class="code" href="types_8h.html#a9">LongNatural</a> nPaths){
00423         <span class="comment">//a bettor of is a max Call with stike 0</span>
00424         <span class="comment">//reassignVolsAtThemoney();</span>
00425         <a class="code" href="types_8h.html#a10">Real</a> tempStrike=<a class="code" href="classRainbowOption.html#r4">_Strike</a>;
00426         _Strike=<a class="code" href="rainbowoption_8h.html#a8">EPSILON</a>;
00427         <a class="code" href="classRainbowOption.html#d19">instanciateMCVariables</a>();
00428         
00429         <a class="code" href="types_8h.html#a10">Real</a> result=<a class="code" href="classRainbowOption.html#d6">PriceByMc_Max2AssetsCall</a>(nPaths);
00430         _Strike=tempStrike; <span class="comment">// put it back</span>
00431         <span class="comment">//reassignVolsAtThestrike();</span>
00432         <span class="keywordflow">return</span> result;
00433 
00434 }
<a name="l00435"></a><a class="code" href="classRainbowOption.html#d5">00435</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d5">RainbowOption::PriceByMc_WorseOf2Assets</a>(<a class="code" href="types_8h.html#a9">LongNatural</a> nPaths){
00436         <span class="comment">//a worse of is a min Call with stike 0</span>
00437         <span class="comment">//reassignVolsAtThemoney();</span>
00438         <a class="code" href="types_8h.html#a10">Real</a> tempStrike=<a class="code" href="classRainbowOption.html#r4">_Strike</a>;
00439         _Strike=<a class="code" href="rainbowoption_8h.html#a8">EPSILON</a>;
00440         <a class="code" href="classRainbowOption.html#d19">instanciateMCVariables</a>();
00441         <a class="code" href="types_8h.html#a10">Real</a> result=<a class="code" href="classRainbowOption.html#d7">PriceByMc_Min2AssetsCall</a>(nPaths);
00442         _Strike=tempStrike; <span class="comment">// put it back</span>
00443         <span class="comment">//reassignVolsAtThestrike();</span>
00444         <span class="keywordflow">return</span> result;
00445 }
00446 
<a name="l00447"></a><a class="code" href="classRainbowOption.html#d6">00447</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d6">RainbowOption::PriceByMc_Max2AssetsCall</a>(<a class="code" href="types_8h.html#a9">LongNatural</a> nPaths)
00448 {
00449         <a class="code" href="classRainbowOption.html#d19">instanciateMCVariables</a>();
00450 
00451         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>=<a class="code" href="classMCEngine.html">MCEngine</a>(nPaths,<a class="code" href="classRainbowOption.html#r14">_DFTomaturity</a>);
00452         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a8">RunEngineRainbowMax2AssetsCall</a>(<a class="code" href="classRainbowOption.html#r16">_pRandom</a>,<a class="code" href="classRainbowOption.html#r20">_pHazardRateProcesses</a>,<a class="code" href="classRainbowOption.html#r13">_thePayOff</a>,<a class="code" href="classRainbowOption.html#r18">_gaussianSample</a>,<a class="code" href="classRainbowOption.html#r19">_TerminalPoints</a>,<a class="code" href="classRainbowOption.html#r7">_weights</a>,<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>,<a class="code" href="classRainbowOption.html#r6">_Multiplier</a>);
00453         <span class="keywordflow">return</span> <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a23">MCResult</a>();
00454 }
00455 
<a name="l00456"></a><a class="code" href="classRainbowOption.html#d7">00456</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d7">RainbowOption::PriceByMc_Min2AssetsCall</a>(<a class="code" href="types_8h.html#a9">LongNatural</a> nPaths)
00457 {
00458         <a class="code" href="classRainbowOption.html#d19">instanciateMCVariables</a>();
00459 
00460         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>=<a class="code" href="classMCEngine.html">MCEngine</a>(nPaths,<a class="code" href="classRainbowOption.html#r14">_DFTomaturity</a>);
00461         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a9">RunEngineRainbowMin2AssetsCall</a>(<a class="code" href="classRainbowOption.html#r16">_pRandom</a>,<a class="code" href="classRainbowOption.html#r20">_pHazardRateProcesses</a>,<a class="code" href="classRainbowOption.html#r13">_thePayOff</a>,<a class="code" href="classRainbowOption.html#r18">_gaussianSample</a>,<a class="code" href="classRainbowOption.html#r19">_TerminalPoints</a>,<a class="code" href="classRainbowOption.html#r7">_weights</a>,<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>,<a class="code" href="classRainbowOption.html#r6">_Multiplier</a>);
00462         <span class="keywordflow">return</span> <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a23">MCResult</a>();
00463 }
00464 
<a name="l00465"></a><a class="code" href="classRainbowOption.html#d8">00465</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d8">RainbowOption::PriceByMc_Max2AssetsPut</a>(<a class="code" href="types_8h.html#a9">LongNatural</a> nPaths)
00466 {
00467         <a class="code" href="classRainbowOption.html#d19">instanciateMCVariables</a>();
00468         
00469         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>=<a class="code" href="classMCEngine.html">MCEngine</a>(nPaths,<a class="code" href="classRainbowOption.html#r14">_DFTomaturity</a>);
00470         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a10">RunEngineRainbowMax2AssetsPut</a>(<a class="code" href="classRainbowOption.html#r16">_pRandom</a>,<a class="code" href="classRainbowOption.html#r20">_pHazardRateProcesses</a>,<a class="code" href="classRainbowOption.html#r13">_thePayOff</a>,<a class="code" href="classRainbowOption.html#r18">_gaussianSample</a>,<a class="code" href="classRainbowOption.html#r19">_TerminalPoints</a>,<a class="code" href="classRainbowOption.html#r7">_weights</a>,<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>,<a class="code" href="classRainbowOption.html#r6">_Multiplier</a>);
00471         <span class="keywordflow">return</span> <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a23">MCResult</a>();
00472 }
00473 
<a name="l00474"></a><a class="code" href="classRainbowOption.html#d9">00474</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d9">RainbowOption::PriceByMc_Min2AssetsPut</a>(<a class="code" href="types_8h.html#a9">LongNatural</a> nPaths)
00475 {
00476         <a class="code" href="classRainbowOption.html#d19">instanciateMCVariables</a>();
00477         
00478         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>=<a class="code" href="classMCEngine.html">MCEngine</a>(nPaths,<a class="code" href="classRainbowOption.html#r14">_DFTomaturity</a>);
00479         <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a11">RunEngineRainbowMin2AssetsPut</a>(<a class="code" href="classRainbowOption.html#r16">_pRandom</a>,<a class="code" href="classRainbowOption.html#r20">_pHazardRateProcesses</a>,<a class="code" href="classRainbowOption.html#r13">_thePayOff</a>,<a class="code" href="classRainbowOption.html#r18">_gaussianSample</a>,<a class="code" href="classRainbowOption.html#r19">_TerminalPoints</a>,<a class="code" href="classRainbowOption.html#r7">_weights</a>,<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>,<a class="code" href="classRainbowOption.html#r6">_Multiplier</a>);
00480         <span class="keywordflow">return</span> <a class="code" href="classRainbowOption.html#r17">_MCEngine</a>.<a class="code" href="classMCEngine.html#a23">MCResult</a>();
00481 }
00482 
<a name="l00483"></a><a class="code" href="classRainbowOption.html#d20">00483</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d20">RainbowOption::compute_sigmaA</a>(){
00484         <a class="code" href="types_8h.html#a10">Real</a> vol1,vol2,rho;
00485         vol1=<a class="code" href="classRainbowOption.html#r9">_volatilities</a>[0];
00486         vol2=_volatilities[1];
00487         rho=<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>(0,1);
00488         <a class="code" href="classRainbowOption.html#r22">sigmaA</a>=sqrt(pow(vol1,2)+pow(vol2,2)-2*rho*vol1*vol2);
00489 }
00490 
<a name="l00491"></a><a class="code" href="classRainbowOption.html#d21">00491</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d21">RainbowOption::compute_rho1</a>(){
00492         <a class="code" href="types_8h.html#a10">Real</a> vol1,vol2,rho;
00493         vol1=<a class="code" href="classRainbowOption.html#r9">_volatilities</a>[0];
00494         vol2=_volatilities[1];
00495         rho=<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>(0,1);
00496         <a class="code" href="classRainbowOption.html#r23">rho1</a>=(rho*vol2-vol1)/<a class="code" href="classRainbowOption.html#r22">sigmaA</a>;
00497 }
00498 
<a name="l00499"></a><a class="code" href="classRainbowOption.html#d22">00499</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d22">RainbowOption::compute_rho2</a>(){
00500         <a class="code" href="types_8h.html#a10">Real</a> vol1,vol2,rho;
00501         vol1=<a class="code" href="classRainbowOption.html#r9">_volatilities</a>[0];
00502         vol2=_volatilities[1];
00503         rho=<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>(0,1);
00504         <a class="code" href="classRainbowOption.html#r24">rho2</a>=(rho*vol1-vol2)/<a class="code" href="classRainbowOption.html#r22">sigmaA</a>;
00505 }
00506 
<a name="l00507"></a><a class="code" href="classRainbowOption.html#d23">00507</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d23">RainbowOption::compute_d1</a>(){
00508         <a class="code" href="types_8h.html#a10">Real</a> S1,vol1,rate;
00509         S1=<a class="code" href="classRainbowOption.html#r5">_spots</a>[0];
00510         vol1=<a class="code" href="classRainbowOption.html#r9">_volatilities</a>[0];
00511         rate=_yc.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00512         <span class="comment">//if K = 0 like in some BO asset (no cash, the d1 should go to -infinity)</span>
00513         d1=(log(S1/<a class="code" href="classRainbowOption.html#r4">_Strike</a>)+(rate+0.5*pow(vol1,2))*<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>)/(vol1*sqrt(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>));
00514 }
00515 
<a name="l00516"></a><a class="code" href="classRainbowOption.html#d24">00516</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d24">RainbowOption::compute_d2</a>(){
00517         <a class="code" href="types_8h.html#a10">Real</a> S2,vol2,rate;
00518         S2=<a class="code" href="classRainbowOption.html#r5">_spots</a>[1];
00519         vol2=<a class="code" href="classRainbowOption.html#r9">_volatilities</a>[1];
00520         rate=_yc.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00521         <span class="comment">//if K = 0 like in some BO asset (no cash, the d1 should go to -infinity)</span>
00522         d2=(log(S2/<a class="code" href="classRainbowOption.html#r4">_Strike</a>)+(rate+0.5*pow(vol2,2))*<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>)/(vol2*sqrt(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>));
00523 }
00524 
<a name="l00525"></a><a class="code" href="classRainbowOption.html#d25">00525</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d25">RainbowOption::compute_d3</a>(){
00526         <a class="code" href="types_8h.html#a10">Real</a> S1,S2;
00527         S1=<a class="code" href="classRainbowOption.html#r5">_spots</a>[0];
00528         S2=_spots[1];
00529         <span class="comment">//if K = 0 like in some BO asset (no cash, the d1 should go to -infinity)</span>
00530         <a class="code" href="classRainbowOption.html#r27">d3</a>=(log(S1/S2)+(0.5*pow(<a class="code" href="classRainbowOption.html#r22">sigmaA</a>,2))*<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>)/(<a class="code" href="classRainbowOption.html#r22">sigmaA</a>*sqrt(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>));
00531 }
00532 
<a name="l00533"></a><a class="code" href="classRainbowOption.html#d26">00533</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d26">RainbowOption::compute_d4</a>(){
00534         <a class="code" href="types_8h.html#a10">Real</a> S1,S2;
00535         S1=<a class="code" href="classRainbowOption.html#r5">_spots</a>[0];
00536         S2=_spots[1];
00537         <span class="comment">//if K = 0 like in some BO asset (no cash, the d1 should go to -infinity)</span>
00538         <a class="code" href="classRainbowOption.html#r28">d4</a>=(log(S2/S1)+(0.5*pow(<a class="code" href="classRainbowOption.html#r22">sigmaA</a>,2))*<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>)/(<a class="code" href="classRainbowOption.html#r22">sigmaA</a>*sqrt(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>));
00539 }
00540 
<a name="l00541"></a><a class="code" href="classRainbowOption.html#d27">00541</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d27">RainbowOption::compute_A</a>(){
00542         <a class="code" href="types_8h.html#a10">Real</a> S1=<a class="code" href="classRainbowOption.html#r5">_spots</a>[0];
00543         <a class="code" href="types_8h.html#a10">Real</a> cum3=<a class="code" href="Normals_8h.html#a1">CumulativeNormal</a>(<a class="code" href="classRainbowOption.html#r27">d3</a>);
00544         <a class="code" href="classRainbowOption.html#r29">A</a>=S1*(cum3-<a class="code" href="Normals_8h.html#a5">CumulativeBivariateNormal</a>(-d1,<a class="code" href="classRainbowOption.html#r27">d3</a>,<a class="code" href="classRainbowOption.html#r23">rho1</a>));
00545 }
00546 
<a name="l00547"></a><a class="code" href="classRainbowOption.html#d28">00547</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d28">RainbowOption::compute_B</a>(){
00548         <a class="code" href="types_8h.html#a10">Real</a> S2=<a class="code" href="classRainbowOption.html#r5">_spots</a>[1];
00549         <a class="code" href="types_8h.html#a10">Real</a> cum4=<a class="code" href="Normals_8h.html#a1">CumulativeNormal</a>(<a class="code" href="classRainbowOption.html#r28">d4</a>);
00550         <a class="code" href="classRainbowOption.html#r30">B</a>=S2*(cum4-<a class="code" href="Normals_8h.html#a5">CumulativeBivariateNormal</a>(-d2,<a class="code" href="classRainbowOption.html#r28">d4</a>,<a class="code" href="classRainbowOption.html#r24">rho2</a>));
00551 }
00552 
<a name="l00553"></a><a class="code" href="classRainbowOption.html#d29">00553</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d29">RainbowOption::compute_C</a>(){
00554         <a class="code" href="types_8h.html#a10">Real</a> vol1,vol2,rate,<a class="code" href="ParkMiller_8h.html#a0">a</a>,b,rho;
00555         vol1=<a class="code" href="classRainbowOption.html#r9">_volatilities</a>[0];
00556         vol2=_volatilities[1];
00557         rate=_yc.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00558         <a class="code" href="ParkMiller_8h.html#a0">a</a>=-d1+vol1*sqrt(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00559         b=-d2+vol2*sqrt(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00560         rho=<a class="code" href="classRainbowOption.html#r8">_CorrelationMatrix</a>(0,1);
00561         <a class="code" href="classRainbowOption.html#r31">C</a>=<a class="code" href="classRainbowOption.html#r4">_Strike</a>*exp(-rate*<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>)*<a class="code" href="Normals_8h.html#a5">CumulativeBivariateNormal</a>(<a class="code" href="ParkMiller_8h.html#a0">a</a>,b,rho);
00562 }
00563 
<a name="l00564"></a><a class="code" href="classRainbowOption.html#d30">00564</a> <span class="keywordtype">void</span> <a class="code" href="classRainbowOption.html#d30">RainbowOption::compute_ClosedFormsParameters</a>(){
00565         <a class="code" href="classRainbowOption.html#d20">compute_sigmaA</a>();
00566         <a class="code" href="classRainbowOption.html#d21">compute_rho1</a>();
00567         <a class="code" href="classRainbowOption.html#d22">compute_rho2</a>();
00568         <a class="code" href="classRainbowOption.html#d23">compute_d1</a>();
00569         <a class="code" href="classRainbowOption.html#d24">compute_d2</a>();
00570         <a class="code" href="classRainbowOption.html#d25">compute_d3</a>();
00571         <a class="code" href="classRainbowOption.html#d26">compute_d4</a>();
00572         <a class="code" href="classRainbowOption.html#d27">compute_A</a>();
00573         <a class="code" href="classRainbowOption.html#d28">compute_B</a>();
00574         <a class="code" href="classRainbowOption.html#d29">compute_C</a>();
00575 }
00576 
<a name="l00577"></a><a class="code" href="classRainbowOption.html#d10">00577</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d10">RainbowOption::PriceByClosedForm_BestOf2_plusCash</a>(){
00578         <span class="keywordflow">if</span>(!<a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>){
00579                 <a class="code" href="classRainbowOption.html#d30">compute_ClosedFormsParameters</a>();
00580                 <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">true</span>;
00581         }
00582         <span class="keywordflow">if</span>(<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a>)
00583                 cout&lt;&lt;<span class="stringliteral">" Note to the user:\n This closed form solution of BestOf2+Cash reflects weight1=weight2=1 - MAX(S1,S2,Cash)"</span>&lt;&lt;endl;
00584         <span class="keywordflow">return</span> <a class="code" href="classRainbowOption.html#r29">A</a> + <a class="code" href="classRainbowOption.html#r30">B</a> + <a class="code" href="classRainbowOption.html#r31">C</a>;
00585 }
00586 
<a name="l00587"></a><a class="code" href="classRainbowOption.html#d11">00587</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d11">RainbowOption::PriceByClosedForm_BetterOf2</a>(){
00588         <span class="keywordflow">if</span>(<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a>)
00589                 cout&lt;&lt;<span class="stringliteral">" Note to the user:\n This closed form solution of BetterOf2 reflects weight1=weight2=1 and K=0 - MAX(S1,S2,0)"</span>&lt;&lt;endl;
00590         
00591         <span class="comment">//reassignVolsAtThemoney();</span>
00592         <a class="code" href="types_8h.html#a10">Real</a> temp=<a class="code" href="classRainbowOption.html#r4">_Strike</a>; <span class="comment">//store it</span>
00593         _Strike=<a class="code" href="rainbowoption_8h.html#a8">EPSILON</a>;
00594         <a class="code" href="classRainbowOption.html#d30">compute_ClosedFormsParameters</a>();<span class="comment">// need to recompute in this case</span>
00595         <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">false</span>;<span class="comment">//so that if we price another one we can reuse the real values by recomputing.</span>
00596         _Strike=temp;<span class="comment">//memorize it back as key variables have been computed.</span>
00597         <span class="comment">//reassignVolsAtThestrike();// and the vols for future use</span>
00598         <span class="keywordflow">return</span> <a class="code" href="classRainbowOption.html#r29">A</a> + <a class="code" href="classRainbowOption.html#r30">B</a> + <a class="code" href="classRainbowOption.html#r31">C</a>; <span class="comment">// with strike = 0 (that puts d1=d2=1)</span>
00599 }
00600 
<a name="l00601"></a><a class="code" href="classRainbowOption.html#d12">00601</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d12">RainbowOption::PriceByClosedForm_WorseOf2</a>(){
00602         <span class="keywordflow">if</span>(<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a>)
00603                 cout&lt;&lt;<span class="stringliteral">" Note to the user:\n This closed form solution of WorstOf2 reflects weight1=weight2=1 and K=0 - MAX(MIN(S1,S2),0)"</span>&lt;&lt;endl;
00604 
00605         <a class="code" href="types_8h.html#a10">Real</a> S1,S2,vol1,vol2,rate,bscall1,bscall2,bo;
00606         S1=<a class="code" href="classRainbowOption.html#r5">_spots</a>[0];
00607         S2=_spots[1];
00608         vol1=<a class="code" href="classRainbowOption.html#r9">_volatilities</a>[0];
00609         vol2=_volatilities[1];
00610         rate=_yc.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00611         <a class="code" href="classBlackScholes.html">BlackScholes</a> bs1= <a class="code" href="classBlackScholes.html">BlackScholes</a>(S1,vol1,<span class="keyword">true</span>,rate,<a class="code" href="rainbowoption_8h.html#a8">EPSILON</a>,<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>,<a class="code" href="BlackScholes_8h.html#a2a0">Call</a>);
00612         bscall1=bs1.<a class="code" href="classBlackScholes.html#a3">getPrice</a>();
00613         BlackScholes bs2= BlackScholes(S2,vol2,<span class="keyword">true</span>,rate,<a class="code" href="rainbowoption_8h.html#a8">EPSILON</a>,<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>,<a class="code" href="BlackScholes_8h.html#a2a0">Call</a>);
00614         bscall2=bs2.<a class="code" href="classBlackScholes.html#a3">getPrice</a>();
00615         bo=<a class="code" href="classRainbowOption.html#d11">PriceByClosedForm_BetterOf2</a>();
00616 
00617         <span class="keywordflow">return</span> bscall1+bscall2-bo;
00618 }
00619 
<a name="l00620"></a><a class="code" href="classRainbowOption.html#d13">00620</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d13">RainbowOption::PriceByClosedForm_MaxOf2_call</a>(){
00621         <span class="keywordflow">if</span>(!<a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>){
00622                 <a class="code" href="classRainbowOption.html#d30">compute_ClosedFormsParameters</a>();
00623                 <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">true</span>;
00624         }
00625         <span class="keywordflow">if</span>(<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a>)
00626                 cout&lt;&lt;<span class="stringliteral">" Note to the user:\n This closed form solution of MaxOf2_call reflects multiplier=weight1=weight2=1 - MAX(MAX(S1,S2)-K,0)"</span>&lt;&lt;endl;
00627 
00628         <a class="code" href="types_8h.html#a10">Real</a> rate= _yc.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00629         <span class="keywordflow">return</span> <a class="code" href="classRainbowOption.html#r29">A</a> + <a class="code" href="classRainbowOption.html#r30">B</a> + <a class="code" href="classRainbowOption.html#r31">C</a> - <a class="code" href="classRainbowOption.html#r4">_Strike</a>*exp(-rate*<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00630 }
00631 
<a name="l00632"></a><a class="code" href="classRainbowOption.html#d14">00632</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d14">RainbowOption::PriceByClosedForm_MinOf2_call</a>(){
00633         <span class="keywordflow">if</span>(<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a>)
00634                 cout&lt;&lt;<span class="stringliteral">" Note to the user:\n This closed form solution of MinOf2_call reflects multiplier=weight1=weight2=1 - MAX(MIN(S1,S2)-K,0)"</span>&lt;&lt;endl;
00635 
00636         <a class="code" href="types_8h.html#a10">Real</a> S1,S2,vol1,vol2,rate,bscall1,bscall2,maxcall;
00637         S1=<a class="code" href="classRainbowOption.html#r5">_spots</a>[0];
00638         S2=_spots[1];
00639         vol1=<a class="code" href="classRainbowOption.html#r9">_volatilities</a>[0];
00640         vol2=_volatilities[1];
00641         rate=_yc.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00642         <a class="code" href="classBlackScholes.html">BlackScholes</a> bs1= <a class="code" href="classBlackScholes.html">BlackScholes</a>(S1,vol1,<span class="keyword">true</span>,rate,<a class="code" href="classRainbowOption.html#r4">_Strike</a>,<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>,<a class="code" href="BlackScholes_8h.html#a2a0">Call</a>);
00643         bscall1=bs1.<a class="code" href="classBlackScholes.html#a3">getPrice</a>();
00644         BlackScholes bs2= BlackScholes(S2,vol2,<span class="keyword">true</span>,rate,<a class="code" href="classRainbowOption.html#r4">_Strike</a>,<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>,<a class="code" href="BlackScholes_8h.html#a2a0">Call</a>);
00645         bscall2=bs2.<a class="code" href="classBlackScholes.html#a3">getPrice</a>();
00646         maxcall=<a class="code" href="classRainbowOption.html#d13">PriceByClosedForm_MaxOf2_call</a>();
00647 
00648         <span class="keywordflow">return</span> bscall1+bscall2-maxcall;
00649 }
00650 
<a name="l00651"></a><a class="code" href="classRainbowOption.html#d15">00651</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d15">RainbowOption::PriceByClosedForm_MaxOf2_put</a>(){
00652         <span class="keywordflow">if</span>(!<a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>){
00653                 <a class="code" href="classRainbowOption.html#d30">compute_ClosedFormsParameters</a>();
00654                 <a class="code" href="classRainbowOption.html#r32">haveClosedFormVariablesBeenComputed</a>=<span class="keyword">true</span>;
00655         }
00656         <span class="keywordflow">if</span>(<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a>)
00657                 cout&lt;&lt;<span class="stringliteral">" Note to the user:\n This closed form solution of MaxOf2_put reflects multiplier=weight1=weight2=1 - MAX(K-MAX(S1,S2),0)"</span>&lt;&lt;endl;
00658         <a class="code" href="types_8h.html#a10">Real</a> rate= _yc.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00659         <span class="keywordflow">return</span> <a class="code" href="classRainbowOption.html#d13">PriceByClosedForm_MaxOf2_call</a>()-<a class="code" href="classRainbowOption.html#d11">PriceByClosedForm_BetterOf2</a>()+ <a class="code" href="classRainbowOption.html#r4">_Strike</a>*exp(-rate*<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00660 }
00661 
<a name="l00662"></a><a class="code" href="classRainbowOption.html#d16">00662</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classRainbowOption.html#d16">RainbowOption::PriceByClosedForm_MinOf2_put</a>(){
00663         <span class="keywordflow">if</span>(<a class="code" href="classRainbowOption.html#r0">_outputMsgs</a>)
00664                 cout&lt;&lt;<span class="stringliteral">" Note to the user:\n This closed form solution of MinOf2_put reflects multiplier=weight1=weight2=1 - MAX(K-MIN(S1,S2),0)"</span>&lt;&lt;endl;
00665         <a class="code" href="types_8h.html#a10">Real</a> S1,S2,vol1,vol2,rate,bsput1,bsput2;
00666         S1=<a class="code" href="classRainbowOption.html#r5">_spots</a>[0];
00667         S2=_spots[1];
00668         vol1=<a class="code" href="classRainbowOption.html#r9">_volatilities</a>[0];
00669         vol2=_volatilities[1];
00670         rate=_yc.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>);
00671         <a class="code" href="classBlackScholes.html">BlackScholes</a> bs1= <a class="code" href="classBlackScholes.html">BlackScholes</a>(S1,vol1,<span class="keyword">true</span>,rate,<a class="code" href="classRainbowOption.html#r4">_Strike</a>,<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>,<a class="code" href="BlackScholes_8h.html#a2a1">Put</a>);
00672         bsput1=bs1.<a class="code" href="classBlackScholes.html#a3">getPrice</a>();
00673         BlackScholes bs2= BlackScholes(S2,vol2,<span class="keyword">true</span>,rate,<a class="code" href="classRainbowOption.html#r4">_Strike</a>,<a class="code" href="classRainbowOption.html#r2">_expiryInYears</a>,<a class="code" href="BlackScholes_8h.html#a2a1">Put</a>);
00674         bsput2=bs2.<a class="code" href="classBlackScholes.html#a3">getPrice</a>();
00675 
00676         <span class="keywordflow">return</span> bsput1+bsput2-<a class="code" href="classRainbowOption.html#d15">PriceByClosedForm_MaxOf2_put</a>();
00677 }
00678 
<a name="l00679"></a><a class="code" href="classRainbowOption.html#a3">00679</a> <a class="code" href="classRainbowOption.html#a3">RainbowOption::~RainbowOption</a>(<span class="keywordtype">void</span>)
00680 {
00681         <span class="comment">//Should be deleted but if I do, I cannot price...</span>
00682         <span class="comment">//delete _pRandom; </span>
00683         <span class="comment">//delete _MCEngine;</span>
00684 }
</pre></div><hr size="1"><address style="align: right;"><small>
<b>Note: Generated nightly - reload for latest version</b><br>
Generated on Thu Dec 22 13:21:44 2005 for <a href="http://terreneuve.sourceforge.net">terreneuve</a> by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.3.6</small></address>
</body>
</html>
