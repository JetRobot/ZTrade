<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Normals.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>Normals.cpp</h1><a href="Normals_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include ".\normals.h"</span>
00002 <span class="comment">/*</span>
00003 <span class="comment">code to implement the basic distribution functions necessary in mathematical finance</span>
00004 <span class="comment">via rational approximations</span>
00005 <span class="comment">  */</span>
00006  
00007 <span class="preprocessor">#include &lt;cmath&gt;</span>
00008 
00009 <span class="comment">// the basic math functions should be in namespace std but aren't in VCPP6</span>
00010 <span class="preprocessor">#if !defined(_MSC_VER)</span>
00011 <span class="preprocessor"></span><span class="keyword">using</span> <span class="keyword">namespace </span>std;
00012 <span class="preprocessor">#endif</span>
00013 <span class="preprocessor"></span>
<a name="l00014"></a><a class="code" href="Normals_8cpp.html#a0">00014</a> <span class="keyword">const</span> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="Normals_8cpp.html#a0">OneOverRootTwoPi</a> = 0.398942280401433; 
00015 
00016 <span class="comment">// probability density for a standard Gaussian distribution</span>
<a name="l00017"></a><a class="code" href="Normals_8h.html#a0">00017</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="Normals_8h.html#a0">NormalDensity</a>(<a class="code" href="types_8h.html#a10">Real</a> x)
00018 {
00019     <span class="keywordflow">return</span> <a class="code" href="Normals_8cpp.html#a0">OneOverRootTwoPi</a>*exp(-x*x/2);
00020 }
00021 
00022 <span class="comment">// the InverseCumulativeNormal function via the Beasley-Springer/Moro approximation</span>
<a name="l00023"></a><a class="code" href="Normals_8h.html#a2">00023</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="Normals_8h.html#a2">InverseCumulativeNormal</a>(<a class="code" href="types_8h.html#a10">Real</a> u)
00024 {
00025 
00026 
00027     <span class="keyword">static</span> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="ParkMiller_8h.html#a0">a</a>[4]={  2.50662823884,
00028                         -18.61500062529,
00029                          41.39119773534,
00030                         -25.44106049637};
00031 
00032     <span class="keyword">static</span> <a class="code" href="types_8h.html#a10">Real</a> b[4]={-8.47351093090,
00033                         23.08336743743,
00034                        -21.06224101826,
00035                          3.13082909833};
00036 
00037     <span class="keyword">static</span> <a class="code" href="types_8h.html#a10">Real</a> c[9]={0.3374754822726147,
00038                         0.9761690190917186,
00039                         0.1607979714918209,
00040                         0.0276438810333863,
00041                         0.0038405729373609,
00042                         0.0003951896511919,
00043                         0.0000321767881768,
00044                         0.0000002888167364,
00045                         0.0000003960315187};
00046 
00047     
00048     <a class="code" href="types_8h.html#a10">Real</a> x=u-0.5;
00049     <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="ParkMiller_8h.html#a3">r</a>;
00050 
00051     <span class="keywordflow">if</span> (fabs(x)&lt;0.42) <span class="comment">// Beasley-Springer</span>
00052     {
00053         <a class="code" href="types_8h.html#a10">Real</a> y=x*x;
00054         
00055         <a class="code" href="ParkMiller_8h.html#a3">r</a>=x*(((<a class="code" href="ParkMiller_8h.html#a0">a</a>[3]*y+<a class="code" href="ParkMiller_8h.html#a0">a</a>[2])*y+<a class="code" href="ParkMiller_8h.html#a0">a</a>[1])*y+<a class="code" href="ParkMiller_8h.html#a0">a</a>[0])/
00056                 ((((b[3]*y+b[2])*y+b[1])*y+b[0])*y+1.0);
00057                
00058     }
00059     <span class="keywordflow">else</span> <span class="comment">// Moro</span>
00060     {
00061     
00062         <a class="code" href="ParkMiller_8h.html#a3">r</a>=u;
00063     
00064         <span class="keywordflow">if</span> (x&gt;0.0) 
00065             <a class="code" href="ParkMiller_8h.html#a3">r</a>=1.0-u;
00066         
00067         <a class="code" href="ParkMiller_8h.html#a3">r</a>=log(-log(<a class="code" href="ParkMiller_8h.html#a3">r</a>));
00068         
00069         <a class="code" href="ParkMiller_8h.html#a3">r</a>=c[0]+<a class="code" href="ParkMiller_8h.html#a3">r</a>*(c[1]+<a class="code" href="ParkMiller_8h.html#a3">r</a>*(c[2]+<a class="code" href="ParkMiller_8h.html#a3">r</a>*(c[3]+<a class="code" href="ParkMiller_8h.html#a3">r</a>*(c[4]+<a class="code" href="ParkMiller_8h.html#a3">r</a>*(c[5]+<a class="code" href="ParkMiller_8h.html#a3">r</a>*(c[6]+
00070                 <a class="code" href="ParkMiller_8h.html#a3">r</a>*(c[7]+<a class="code" href="ParkMiller_8h.html#a3">r</a>*c[8])))))));
00071         
00072         <span class="keywordflow">if</span> (x&lt;0.0) 
00073             <a class="code" href="ParkMiller_8h.html#a3">r</a>=-<a class="code" href="ParkMiller_8h.html#a3">r</a>;
00074     
00075     }
00076 
00077     <span class="keywordflow">return</span> <a class="code" href="ParkMiller_8h.html#a3">r</a>;
00078 }
00079 
00080 
00081 <span class="comment">// standard normal cumulative distribution function</span>
<a name="l00082"></a><a class="code" href="Normals_8h.html#a1">00082</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="Normals_8h.html#a1">CumulativeNormal</a>(<a class="code" href="types_8h.html#a10">Real</a> x)
00083 {
00084     <span class="keyword">static</span> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="ParkMiller_8h.html#a0">a</a>[5] = { 0.319381530,
00085                           -0.356563782,
00086                            1.781477937,
00087                           -1.821255978,
00088                            1.330274429};
00089 
00090     <a class="code" href="types_8h.html#a10">Real</a> result;
00091     
00092     <span class="keywordflow">if</span> (x&lt;-7.0)
00093         result = <a class="code" href="Normals_8h.html#a0">NormalDensity</a>(x)/sqrt(1.+x*x);
00094     
00095     <span class="keywordflow">else</span> 
00096     {
00097         <span class="keywordflow">if</span> (x&gt;7.0)
00098             result = 1.0 - <a class="code" href="Normals_8h.html#a1">CumulativeNormal</a>(-x);
00099         <span class="keywordflow">else</span>
00100         {
00101             <a class="code" href="types_8h.html#a10">Real</a> tmp = 1.0/(1.0+0.2316419*fabs(x));
00102 
00103             result=1-<a class="code" href="Normals_8h.html#a0">NormalDensity</a>(x)*
00104                      (tmp*(<a class="code" href="ParkMiller_8h.html#a0">a</a>[0]+tmp*(<a class="code" href="ParkMiller_8h.html#a0">a</a>[1]+tmp*(<a class="code" href="ParkMiller_8h.html#a0">a</a>[2]+tmp*(<a class="code" href="ParkMiller_8h.html#a0">a</a>[3]+tmp*<a class="code" href="ParkMiller_8h.html#a0">a</a>[4])))));
00105 
00106             <span class="keywordflow">if</span> (x&lt;=0.0) 
00107                 result=1.0-result;
00108 
00109         }
00110     }
00111 
00112     <span class="keywordflow">return</span> result;
00113 }
00114 
00115 
<a name="l00116"></a><a class="code" href="Normals_8h.html#a3">00116</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="Normals_8h.html#a3">Average</a>(valarray&lt;Real&gt; Ptr,<a class="code" href="types_8h.html#a9">LongNatural</a> dim)
00117 {
00118         <a class="code" href="types_8h.html#a9">LongNatural</a> i;
00119         <a class="code" href="types_8h.html#a10">Real</a> result=0;
00120 
00121         <span class="keywordflow">for</span> (i=0;i&lt;dim;i++)
00122         {
00123                 result+=Ptr[i];
00124         }
00125 
00126         result/=<a class="code" href="types_8h.html#a10">Real</a>(dim);
00127         <span class="keywordflow">return</span> result;
00128 }
00129 
<a name="l00130"></a><a class="code" href="Normals_8h.html#a4">00130</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="Normals_8h.html#a4">Maximize</a>(valarray&lt;Real&gt; Ptr,<a class="code" href="types_8h.html#a9">LongNatural</a> dim)
00131 {
00132         <a class="code" href="types_8h.html#a9">LongNatural</a> i;
00133         <a class="code" href="types_8h.html#a10">Real</a> result=0;
00134 
00135         <span class="keywordflow">for</span> (i=0;i&lt;dim;i++)
00136         {
00137                 <span class="keywordflow">if</span> (Ptr[i]&gt;result)
00138                         result=Ptr[i];
00139         }
00140 
00141         <span class="keywordflow">return</span> result;
00142 }
00143 
<a name="l00144"></a><a class="code" href="Normals_8h.html#a5">00144</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="Normals_8h.html#a5">CumulativeBivariateNormal</a>(<a class="code" href="types_8h.html#a10">Real</a> a,<a class="code" href="types_8h.html#a10">Real</a> b,<a class="code" href="types_8h.html#a10">Real</a> rho)
00145 {
00146     <span class="keyword">static</span> <a class="code" href="types_8h.html#a10">Real</a> aarray[5]= {0.24840615, 0.39233107, 0.21141819, 0.03324666, 0.00082485334};
00147         <span class="keyword">static</span> <a class="code" href="types_8h.html#a10">Real</a> barray[5]={0.10024215, 0.48281397, 1.0609498, 1.7797294, 2.6697604};
00148  <span class="comment">//   static Real aarray[4]= {0.325303, 0.4211071, 0.1334425, 0.006374323};</span>
00149         <span class="comment">//static Real barray[4]={0.1337764, 0.6243247, 1.3425378, 2.2626645};</span>
00150     <a class="code" href="types_8h.html#a10">Real</a> rho1 , rho2 , delta ;
00151     <a class="code" href="types_8h.html#a10">Real</a> ap , bp ;
00152     <a class="code" href="types_8h.html#a10">Real</a> Sum, Pi;
00153         <a class="code" href="types_8h.html#a10">Real</a> sgnA,sgnB;
00154     <a class="code" href="types_8h.html#a7">Natural</a> i , j ;
00155         <a class="code" href="types_8h.html#a10">Real</a> BivN, denum;
00156 
00157         sgnA=(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="utils_8h.html#a1">sign</a>(<a class="code" href="ParkMiller_8h.html#a0">a</a>);
00158         sgnB=(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="utils_8h.html#a1">sign</a>(b);
00159     
00160         Pi = 3.14159265358979;
00161     <span class="keywordflow">if</span>(pow(rho,2)==1)
00162                 rho=(<a class="code" href="types_8h.html#a10">Real</a>)<a class="code" href="utils_8h.html#a1">sign</a>(rho)*0.99999;
00163     ap = <a class="code" href="ParkMiller_8h.html#a0">a</a> / sqrt(2 * (1 - pow(rho,2)));
00164     bp = b / sqrt(2 * (1 - pow(rho,2)));
00165     
00166         <span class="keywordflow">if</span>( (<a class="code" href="ParkMiller_8h.html#a0">a</a> &lt;= 0) &amp;&amp; (b &lt;= 0) &amp;&amp; (rho &lt;= 0) ){
00167         Sum = 0;
00168                 <span class="keywordflow">for</span> (i = 0 ;i&lt; 5;i++)
00169             <span class="keywordflow">for</span> (j = 0 ;j&lt; 5;j++)
00170                 Sum +=  + aarray[i] * aarray[j] * <a class="code" href="Normals_8h.html#a6">SubFunctionForBivariateNormal</a>(barray[i], barray[j], ap, bp, rho);
00171         BivN = Sum * sqrt(1 - pow(rho,2)) / Pi;
00172         }  
00173         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((a &lt;= 0 )&amp;&amp; (b &gt;= 0) &amp;&amp; (rho &gt;= 0)) 
00174         BivN = <a class="code" href="Normals_8h.html#a1">CumulativeNormal</a>(<a class="code" href="ParkMiller_8h.html#a0">a</a>) - <a class="code" href="Normals_8h.html#a5">CumulativeBivariateNormal</a>(<a class="code" href="ParkMiller_8h.html#a0">a</a>, -b, -rho); 
00175     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="ParkMiller_8h.html#a0">a</a> &gt;= 0) &amp;&amp; (b &lt;= 0) &amp;&amp; (rho &gt;= 0)) 
00176         BivN = <a class="code" href="Normals_8h.html#a1">CumulativeNormal</a>(b) - <a class="code" href="Normals_8h.html#a5">CumulativeBivariateNormal</a>(-<a class="code" href="ParkMiller_8h.html#a0">a</a>, b, -rho);
00177     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="ParkMiller_8h.html#a0">a</a> &gt;= 0) &amp;&amp; (b &gt;= 0) &amp;&amp; (rho &lt;= 0))
00178         BivN = <a class="code" href="Normals_8h.html#a1">CumulativeNormal</a>(<a class="code" href="ParkMiller_8h.html#a0">a</a>) + <a class="code" href="Normals_8h.html#a1">CumulativeNormal</a>(b) - 1 + <a class="code" href="Normals_8h.html#a5">CumulativeBivariateNormal</a>(-<a class="code" href="ParkMiller_8h.html#a0">a</a>, -b, rho);
00179         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ParkMiller_8h.html#a0">a</a> * b * rho &gt;= 0) {
00180         denum = sqrt(pow(<a class="code" href="ParkMiller_8h.html#a0">a</a>,2) - 2 * rho * <a class="code" href="ParkMiller_8h.html#a0">a</a> * b + pow(b,2));
00181         rho1 = (rho * <a class="code" href="ParkMiller_8h.html#a0">a</a> - b) * sgnA / denum;
00182         rho2 = (rho * b - <a class="code" href="ParkMiller_8h.html#a0">a</a>) * sgnB / denum;
00183         delta = (1 - sgnA*sgnB) / 4;
00184         BivN = <a class="code" href="Normals_8h.html#a5">CumulativeBivariateNormal</a>(<a class="code" href="ParkMiller_8h.html#a0">a</a>, 0, rho1) + <a class="code" href="Normals_8h.html#a5">CumulativeBivariateNormal</a>(b, 0, rho2) - delta;
00185         }       
00186         <span class="keywordflow">return</span> BivN;
00187 }
00188 
<a name="l00189"></a><a class="code" href="Normals_8h.html#a6">00189</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="Normals_8h.html#a6">SubFunctionForBivariateNormal</a>(<a class="code" href="types_8h.html#a10">Real</a> X,<a class="code" href="types_8h.html#a10">Real</a> y,<a class="code" href="types_8h.html#a10">Real</a> ap,<a class="code" href="types_8h.html#a10">Real</a> bp,<a class="code" href="types_8h.html#a10">Real</a> rho){
00190         <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="ParkMiller_8h.html#a3">r</a>;
00191         <a class="code" href="ParkMiller_8h.html#a3">r</a> = ap * (2 * X - ap) + bp * (2 * y - bp) + 2 * rho * (X - ap) * (y - bp);
00192         <span class="keywordflow">return</span> exp(<a class="code" href="ParkMiller_8h.html#a3">r</a>);
00193 }
</pre></div><hr size="1"><address style="align: right;"><small>
<b>Note: Generated nightly - reload for latest version</b><br>
Generated on Thu Dec 22 13:21:44 2005 for <a href="http://terreneuve.sourceforge.net">terreneuve</a> by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.3.6</small></address>
</body>
</html>
