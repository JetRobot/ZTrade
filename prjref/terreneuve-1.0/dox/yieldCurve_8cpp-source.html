<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>yieldCurve.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>yieldCurve.cpp</h1><a href="yieldCurve_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include ".\yieldCurve.h"</span>
00002 
00003 <span class="comment">/*------------------------------------------------------*/</span>
00004 <span class="comment">/*                 Yield Point Implementation           */</span>
00005 <span class="comment">/*------------------------------------------------------*/</span>
00006 
<a name="l00007"></a><a class="code" href="classyieldPoint.html#a0">00007</a> <a class="code" href="classyieldPoint.html#a0">yieldPoint::yieldPoint</a>(<span class="keywordtype">void</span>) {
00008    <a class="code" href="classyieldPoint.html#r0">_rate</a>     = 0.0;
00009    <a class="code" href="classyieldPoint.html#r1">_maturity</a> = 0.0;
00010    _type     = <a class="code" href="yieldCurve_8h.html#a9a6">Cash</a>;
00011    <a class="code" href="classyieldPoint.html#r3">_dayCount</a> = <a class="code" href="date_8h.html#a48a40">ACT_360</a>;
00012 }
00013 
<a name="l00014"></a><a class="code" href="classyieldPoint.html#a1">00014</a> <a class="code" href="classyieldPoint.html#a0">yieldPoint::yieldPoint</a>(<a class="code" href="types_8h.html#a10">Real</a> r,<a class="code" href="types_8h.html#a10">Real</a> T,TypeOfRate type,DayCountConvention dayCount)
00015 {
00016    <a class="code" href="classyieldPoint.html#r0">_rate</a>     = <a class="code" href="ParkMiller_8h.html#a3">r</a>;
00017    <a class="code" href="classyieldPoint.html#r1">_maturity</a> = T;
00018    _type     = type;
00019    <a class="code" href="classyieldPoint.html#r3">_dayCount</a> = dayCount;                              
00020 }
00021 
00022 
<a name="l00023"></a><a class="code" href="classyieldPoint.html#e0">00023</a> <span class="keywordtype">char</span> *<a class="code" href="classyieldPoint.html#e0">yieldPoint::TypeAsString</a>(TypeOfRate t)
00024 {
00025         <span class="keywordflow">switch</span> (t) {
00026                 <span class="keywordflow">case</span> <a class="code" href="yieldCurve_8h.html#a9a6">Cash</a>:
00027                         <span class="keywordflow">return</span> <span class="stringliteral">"Cash"</span>;
00028                 <span class="keywordflow">case</span> <a class="code" href="yieldCurve_8h.html#a9a7">Swap</a>:
00029                         <span class="keywordflow">return</span> <span class="stringliteral">"Swap"</span>;
00030                 <span class="keywordflow">default</span>:
00031                         <span class="keywordflow">return</span> <span class="stringliteral">"No rate type has been defined"</span>;
00032         }
00033 }
00034 
<a name="l00035"></a><a class="code" href="classyieldPoint.html#a2">00035</a> <a class="code" href="classyieldPoint.html#a2">yieldPoint::~yieldPoint</a>(<span class="keywordtype">void</span>)
00036 {
00037 };
00038 
00039 <span class="comment">/*------------------------------------------------------*/</span>
00040 <span class="comment">/*                 Yield Curve Implementation           */</span>
00041 <span class="comment">/*------------------------------------------------------*/</span>
<a name="l00042"></a><a class="code" href="classyieldCurve.html#a0">00042</a> <a class="code" href="classyieldCurve.html#a0">yieldCurve::yieldCurve</a>(<span class="keywordtype">void</span>)
00043 :_marketRates(<a class="code" href="yieldCurve_8h.html#a2">YC_MAX_NUMBER_POINTS</a>),
00044  _zcbRates(<a class="code" href="yieldCurve_8h.html#a2">YC_MAX_NUMBER_POINTS</a>)
00045 {
00046       sprintf(<a class="code" href="classyieldCurve.html#r2">_name</a>, <span class="stringliteral">"unamed"</span>);
00048       <a class="code" href="classyieldCurve.html#a2">assignFlatRate</a>();
00049       <a class="code" href="classyieldCurve.html#d5">computeZCBRatesBootstrap</a>();
00050 }
00051 
00052 
<a name="l00053"></a><a class="code" href="classyieldCurve.html#a2">00053</a> <span class="keywordtype">void</span> <a class="code" href="classyieldCurve.html#a2">yieldCurve::assignFlatRate</a>(<a class="code" href="types_8h.html#a10">Real</a> r)
00054 {
00055      <a class="code" href="types_8h.html#a7">Natural</a> size = <a class="code" href="classyieldCurve.html#r0">_marketRates</a>.size();
00056      <span class="keywordflow">for</span>(<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;size;i++){
00057          <a class="code" href="classyieldCurve.html#r0">_marketRates</a>[i].setRate(<a class="code" href="ParkMiller_8h.html#a3">r</a>);       
00058                  <a class="code" href="classyieldCurve.html#r0">_marketRates</a>[i].setDayCount(<a class="code" href="date_8h.html#a48a40">ACT_360</a>);   
00059                  <a class="code" href="classyieldCurve.html#r0">_marketRates</a>[i].setType(<a class="code" href="yieldCurve_8h.html#a9a6">Cash</a>);   
00060                  <a class="code" href="classyieldCurve.html#r0">_marketRates</a>[i].setMaturity(i);   
00061      }    
00062 }
00063 
<a name="l00064"></a><a class="code" href="classyieldCurve.html#a1">00064</a> <a class="code" href="classyieldCurve.html#a0">yieldCurve::yieldCurve</a>(<a class="code" href="types_8h.html#a10">Real</a> flatRate)
00065 :_marketRates(<a class="code" href="yieldCurve_8h.html#a2">YC_MAX_NUMBER_POINTS</a>),
00066  _zcbRates(<a class="code" href="yieldCurve_8h.html#a2">YC_MAX_NUMBER_POINTS</a>)
00067 {
00068       sprintf(<a class="code" href="classyieldCurve.html#r2">_name</a>, <span class="stringliteral">"unamed"</span>);
00070       <a class="code" href="classyieldCurve.html#a2">assignFlatRate</a>(flatRate);  
00071       <a class="code" href="classyieldCurve.html#d5">computeZCBRatesBootstrap</a>();                         
00072 }
00073 
<a name="l00074"></a><a class="code" href="classyieldCurve.html#a6">00074</a> <a class="code" href="classyieldCurve.html#a0">yieldCurve::yieldCurve</a>(valarray&lt;yieldPoint&gt; yieldPoints,<span class="keywordtype">char</span> *name)
00075 :_marketRates(yieldPoints),
00076  _zcbRates(yieldPoints) <span class="comment">//default they are equal</span>
00077 {
00078       strcpy(<a class="code" href="classyieldCurve.html#r2">_name</a>,name);
00079           <a class="code" href="classyieldCurve.html#d1">sortMarketRatesByMaturity</a>();
00080           <a class="code" href="classyieldCurve.html#d2">sortCashSwap</a>();
00082       <a class="code" href="classyieldCurve.html#d5">computeZCBRatesBootstrap</a>();
00083 }
00084 
<a name="l00085"></a><a class="code" href="classyieldCurve.html#a7">00085</a> <a class="code" href="classyieldCurve.html#a7">yieldCurve::~yieldCurve</a>(<span class="keywordtype">void</span>)
00086 {
00087 }
00088 
<a name="l00089"></a><a class="code" href="classyieldCurve.html#d0">00089</a> <a class="code" href="classyieldPoint.html">yieldPoint</a> <a class="code" href="classyieldCurve.html#d0">yieldCurve::getPointAtMaturity</a>(<a class="code" href="types_8h.html#a10">Real</a> maturity)
00090 {
00091         <a class="code" href="types_8h.html#a7">Natural</a> size =<a class="code" href="classyieldCurve.html#r0">_marketRates</a>.size(),i=0,indexFound=0;
00092         <a class="code" href="classyieldPoint.html">yieldPoint</a> y;
00093         <span class="keywordtype">bool</span> hasFound=<span class="keyword">false</span>;
00094 
00095         <span class="keywordflow">while</span> (i&lt;size &amp;&amp; !hasFound){
00096                 <span class="keywordflow">if</span>(<a class="code" href="classyieldCurve.html#r0">_marketRates</a>[i].getMaturity()==maturity){
00097                         hasFound=<span class="keyword">true</span>;
00098                         indexFound =i;
00099                 }
00100                 i++;
00101         }
00102         <span class="keywordflow">if</span>(hasFound){
00103                 y=<a class="code" href="classyieldCurve.html#r0">_marketRates</a>[indexFound];
00104         }
00105         <span class="keywordflow">else</span>{
00106                 y=<a class="code" href="classyieldPoint.html">yieldPoint</a>();
00107         }
00108         <span class="keywordflow">return</span> y;
00109 }
00110 
00111 
<a name="l00112"></a><a class="code" href="classyieldCurve.html#d1">00112</a> <span class="keywordtype">void</span> <a class="code" href="classyieldCurve.html#d1">yieldCurve::sortMarketRatesByMaturity</a>()
00113 {
00114         <a class="code" href="types_8h.html#a7">Natural</a> size = <a class="code" href="classyieldCurve.html#r0">_marketRates</a>.size();
00115         valarray&lt;yieldPoint&gt; tempstorage(size);
00116         <a class="code" href="types_8h.html#a10">Real</a> toSort[<a class="code" href="yieldCurve_8h.html#a2">YC_MAX_NUMBER_POINTS</a>];
00117         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;size;i++) 
00118         {
00119                 toSort[i]=<a class="code" href="classyieldCurve.html#r0">_marketRates</a>[i].getMaturity();
00120         }
00121         sort(toSort,toSort+size);
00122         <span class="comment">// toSort now is sorted by ascending maturity</span>
00123         <span class="keywordflow">for</span> (i=0;i&lt;size;i++) 
00124         {
00125                 tempstorage[i]=<a class="code" href="classyieldCurve.html#d0">getPointAtMaturity</a>(toSort[i]);
00126                 <span class="comment">// we just have to assign the yieldPoints corresponding to the maturity sorted</span>
00127                 <span class="comment">// no need to handle not found maturities here as we know that the maturities in toSort</span>
00128                 <span class="comment">// are bijectively taken from _marketRates</span>
00129         }
00130         <a class="code" href="classyieldCurve.html#r0">_marketRates</a> = tempstorage;
00131 }
00132 
00133 
<a name="l00134"></a><a class="code" href="classyieldCurve.html#d2">00134</a> <span class="keywordtype">void</span> <a class="code" href="classyieldCurve.html#d2">yieldCurve::sortCashSwap</a>()
00135 {
00136         valarray&lt;yieldPoint&gt; tempstorage(<a class="code" href="classyieldCurve.html#r0">_marketRates</a>.size());
00137         <a class="code" href="types_8h.html#a7">Natural</a> count=0;
00138         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;<a class="code" href="classyieldCurve.html#r0">_marketRates</a>.size();i++)
00139         {
00140                 <span class="keywordflow">if</span>(<a class="code" href="classyieldCurve.html#r0">_marketRates</a>[i].getType()==<a class="code" href="yieldCurve_8h.html#a9a6">Cash</a>){
00141                         tempstorage[count]=<a class="code" href="classyieldCurve.html#r0">_marketRates</a>[i];
00142                         count++;
00143                 }
00144         }
00145         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;<a class="code" href="classyieldCurve.html#r0">_marketRates</a>.size();i++)
00146         {
00147                 <span class="keywordflow">if</span>(<a class="code" href="classyieldCurve.html#r0">_marketRates</a>[i].getType()==<a class="code" href="yieldCurve_8h.html#a9a7">Swap</a>){
00148                         tempstorage[count]=<a class="code" href="classyieldCurve.html#r0">_marketRates</a>[i];
00149                         count++;
00150                 }
00151         }
00152         <a class="code" href="classyieldCurve.html#r0">_marketRates</a>=tempstorage;
00153 }
00154 
<a name="l00155"></a><a class="code" href="classyieldCurve.html#d3">00155</a> valarray&lt;yieldPoint&gt; <a class="code" href="classyieldCurve.html#d3">yieldCurve::getSwapRates</a>()
00156 {
00157         valarray&lt;yieldPoint&gt; tempstorage(<a class="code" href="yieldCurve_8h.html#a2">YC_MAX_NUMBER_POINTS</a>);
00158         tempstorage[0]=<a class="code" href="classyieldPoint.html">yieldPoint</a>(<a class="code" href="classyieldCurve.html#a8">spotRate</a>(1),1,<a class="code" href="yieldCurve_8h.html#a9a7">Swap</a>); <span class="comment">//1Y swap rate = 1y cash rate as (1+s1Y)*DF1=1</span>
00159         <a class="code" href="types_8h.html#a7">Natural</a> i=0,count=1;
00160         <span class="keywordflow">while</span>(i&lt;<a class="code" href="classyieldCurve.html#r0">_marketRates</a>.size() &amp;&amp; <a class="code" href="classyieldCurve.html#r0">_marketRates</a>[i].getType()==<a class="code" href="yieldCurve_8h.html#a9a6">Cash</a>) {i++;} <span class="comment">//get to the first swap rate of the array</span>
00161         <span class="keywordflow">while</span>(i&lt;<a class="code" href="classyieldCurve.html#r0">_marketRates</a>.size())
00162         {
00163                 tempstorage[count]=<a class="code" href="classyieldCurve.html#r0">_marketRates</a>[i];
00164                 count++;
00165                 i++;
00166         }
00167 
00168         tempstorage.resize(count);
00169         <span class="keywordflow">return</span> tempstorage;
00170 }
00171 
<a name="l00172"></a><a class="code" href="classyieldCurve.html#d4">00172</a> valarray&lt;yieldPoint&gt; <a class="code" href="classyieldCurve.html#d4">yieldCurve::getSequentSwapRates</a>()
00173 {
00175         valarray&lt;yieldPoint&gt; tempstorage(<a class="code" href="classyieldCurve.html#d3">getSwapRates</a>());
00176         <a class="code" href="types_8h.html#a7">Natural</a> size=tempstorage.size();
00177         valarray&lt;yieldPoint&gt; res((<a class="code" href="types_8h.html#a7">Natural</a>)tempstorage[size-1].getMaturity());
00178         <a class="code" href="types_8h.html#a7">Natural</a> i=1,diff=0,j=0,nextMat=0,prevMat=0,start=0;
00181         <span class="keywordflow">while</span>(i&lt;size &amp;&amp; tempstorage[i-1].getMaturity()==(tempstorage[i].getMaturity()-1)) {
00182                 res[j]=tempstorage[i-1];
00183                 i++;
00184                 j++;
00185         }
00186         start=j;
00187         <span class="comment">// set natural year maturities from 1 up to the last swap maturity </span>
00188 <span class="comment">//and tests if maturities are sequent or not</span>
00189         <span class="keywordflow">while</span> (j&lt;res.size() &amp;&amp; i&lt;size){ 
00190                 <span class="keywordflow">if</span>(tempstorage[i].getMaturity()==(<a class="code" href="types_8h.html#a10">Real</a>)(j+1)){
00191                         res[j]=tempstorage[i];
00192                         i++;
00193                 }
00194                 <span class="keywordflow">else</span>{
00195                         res[j].setMaturity((<a class="code" href="types_8h.html#a10">Real</a>)(j+1)); 
00196                         res[j].setType(<a class="code" href="yieldCurve_8h.html#a9a7">Swap</a>);
00197                         nextMat=(<a class="code" href="types_8h.html#a7">Natural</a>)tempstorage[i].getMaturity();
00198                         prevMat=(<a class="code" href="types_8h.html#a7">Natural</a>)tempstorage[i-1].getMaturity();
00199                         diff= nextMat-prevMat;
00200                         res[j].setRate( (tempstorage[i-1].getRate()*(nextMat-j-1)+  tempstorage[i].getRate()*(j+1-prevMat )) /diff);
00201                 }       
00202                 j++;
00203         }
00204         <span class="keywordflow">return</span> res;     
00205 }
00206 
<a name="l00207"></a><a class="code" href="classyieldCurve.html#a8">00207</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classyieldCurve.html#a8">yieldCurve::spotRate</a>(<a class="code" href="types_8h.html#a10">Real</a> maturity)<span class="keyword"> const</span>
00208 <span class="keyword"></span>{
00209       <a class="code" href="types_8h.html#a7">Natural</a> i =0;
00210       <span class="keywordflow">while</span>(i&lt;<a class="code" href="classyieldCurve.html#r1">_zcbRates</a>.size() &amp;&amp;  <a class="code" href="classyieldCurve.html#r1">_zcbRates</a>[i].getMaturity()&lt;maturity ) {i++;}
00211       <span class="keywordflow">if</span> (i==<a class="code" href="classyieldCurve.html#r1">_zcbRates</a>.size())
00212                         <span class="comment">//longer term than we know : best approximation is the last Point</span>
00213             <span class="keywordflow">return</span> <a class="code" href="classyieldCurve.html#r1">_zcbRates</a>[i-1].getRate(); 
00214       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(i==0)
00215                         <span class="comment">// we are looking for a rate of a shorter term : best approximation is the 1st rate on the curve</span>
00216             <span class="keywordflow">return</span> <a class="code" href="classyieldCurve.html#r1">_zcbRates</a>[i].getRate();
00217       <span class="keywordflow">else</span>{
00218                         <span class="comment">// linear Naturalepolation</span>
00219             <a class="code" href="types_8h.html#a10">Real</a> rmin=<a class="code" href="classyieldCurve.html#r1">_zcbRates</a>[i-1].getRate();
00220             <a class="code" href="types_8h.html#a10">Real</a> rmax=_zcbRates[i].getRate();
00221             <a class="code" href="types_8h.html#a10">Real</a> tmin=_zcbRates[i-1].getMaturity();
00222             <a class="code" href="types_8h.html#a10">Real</a> tmax=_zcbRates[i].getMaturity();
00223             
00224             <span class="comment">//in the zcb calculation we get sure that there is no redundant rate</span>
00225             <span class="keywordflow">return</span> ( (tmax-maturity)*rmin + (maturity-tmin)*rmax )/(tmax-tmin);
00226       }
00227 }
00228 
<a name="l00229"></a><a class="code" href="classyieldCurve.html#a11">00229</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classyieldCurve.html#a8">yieldCurve::spotRate</a>(<a class="code" href="classDate.html">Date</a> maturityDate)<span class="keyword"> const </span>{
00230         <a class="code" href="classDate.html">Date</a> today=<a class="code" href="classDate.html">Date</a>();
00231         today.<a class="code" href="classDate.html#a13">setDateToToday</a>();
00232         <span class="keywordflow">return</span>  <a class="code" href="classyieldCurve.html#a8">spotRate</a>(today.<a class="code" href="classDate.html#a36">dayCount</a>(maturityDate,<a class="code" href="date_8h.html#a48a42">Day30_360</a>));
00233 }
00234 
<a name="l00235"></a><a class="code" href="classyieldCurve.html#a12">00235</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classyieldCurve.html#a12">yieldCurve::discountFactor</a>(<a class="code" href="types_8h.html#a10">Real</a> maturity,interestComposition composition) <span class="comment">// continuously compound for now - see dayCOunt later</span>
00236 {
00237         <span class="keywordflow">switch</span> (composition) {
00238                   <span class="keywordflow">case</span> <a class="code" href="yieldCurve_8h.html#a8a4">Discrete</a>:
00239                           <span class="keywordflow">return</span> (<a class="code" href="types_8h.html#a10">Real</a>)pow(1/(1+<a class="code" href="classyieldCurve.html#a8">spotRate</a>(maturity)),maturity);
00240                   <span class="keywordflow">case</span> <a class="code" href="yieldCurve_8h.html#a8a5">Continuous</a>:
00241                           <span class="keywordflow">return</span> (<a class="code" href="types_8h.html#a10">Real</a>)exp(-maturity*<a class="code" href="classyieldCurve.html#a8">spotRate</a>(maturity));
00242                   <span class="keywordflow">default</span>:
00243                           <span class="keywordflow">return</span> (<a class="code" href="types_8h.html#a10">Real</a>)exp(-maturity*<a class="code" href="classyieldCurve.html#a8">spotRate</a>(maturity));
00244         }
00245 }
00246 
<a name="l00247"></a><a class="code" href="classyieldCurve.html#a13">00247</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classyieldCurve.html#a12">yieldCurve::discountFactor</a>(<a class="code" href="classDate.html">Date</a> maturityDate,interestComposition composition){
00248         <a class="code" href="classDate.html">Date</a> today=<a class="code" href="classDate.html">Date</a>();
00249         today.<a class="code" href="classDate.html#a13">setDateToToday</a>();
00250         <span class="keywordflow">return</span> <a class="code" href="classyieldCurve.html#a12">discountFactor</a>(today.<a class="code" href="classDate.html#a36">dayCount</a>(maturityDate,<a class="code" href="date_8h.html#a48a42">Day30_360</a>),composition);
00251 }
00252 
<a name="l00253"></a><a class="code" href="classyieldCurve.html#a14">00253</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classyieldCurve.html#a14">yieldCurve::forwardDiscountFactor</a>(<a class="code" href="types_8h.html#a10">Real</a> forwardstart,<a class="code" href="types_8h.html#a10">Real</a> lengthofcontractafterstart,interestComposition composition){
00254         <span class="keywordflow">switch</span> (composition) {
00255                   <span class="keywordflow">case</span> <a class="code" href="yieldCurve_8h.html#a8a4">Discrete</a>:
00256                           <span class="keywordflow">return</span> (<a class="code" href="types_8h.html#a10">Real</a>)pow(1/(1+<a class="code" href="classyieldCurve.html#a15">forwardRate</a>(forwardstart,lengthofcontractafterstart,composition)),lengthofcontractafterstart);
00257                   <span class="keywordflow">case</span> <a class="code" href="yieldCurve_8h.html#a8a5">Continuous</a>:
00258                           <span class="keywordflow">return</span> (<a class="code" href="types_8h.html#a10">Real</a>)exp(-lengthofcontractafterstart*<a class="code" href="classyieldCurve.html#a15">forwardRate</a>(forwardstart,lengthofcontractafterstart,composition));
00259                   <span class="keywordflow">default</span>:
00260                           <span class="keywordflow">return</span> (<a class="code" href="types_8h.html#a10">Real</a>)exp(-lengthofcontractafterstart*<a class="code" href="classyieldCurve.html#a15">forwardRate</a>(forwardstart,lengthofcontractafterstart,composition));
00261         }       
00262 }
00263 
<a name="l00264"></a><a class="code" href="classyieldCurve.html#a15">00264</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classyieldCurve.html#a15">yieldCurve::forwardRate</a>(<a class="code" href="types_8h.html#a10">Real</a> forwardStart,<a class="code" href="types_8h.html#a10">Real</a> effectiveLengthOfTheContractAfterStart,interestComposition composition)
00265 {
00266         <span class="keywordflow">switch</span> (composition) {
00267         <span class="keywordflow">case</span> <a class="code" href="yieldCurve_8h.html#a8a4">Discrete</a>:
00268                 <span class="keywordflow">return</span> (<a class="code" href="types_8h.html#a10">Real</a>)(pow(<a class="code" href="classyieldCurve.html#a12">discountFactor</a>(forwardStart,composition)/<a class="code" href="classyieldCurve.html#a12">discountFactor</a>(forwardStart+effectiveLengthOfTheContractAfterStart,composition),1/effectiveLengthOfTheContractAfterStart)-1) ;
00269         <span class="keywordflow">case</span> <a class="code" href="yieldCurve_8h.html#a8a5">Continuous</a>:
00270                 <span class="keywordflow">return</span> (<a class="code" href="types_8h.html#a10">Real</a>) (<a class="code" href="classyieldCurve.html#a8">spotRate</a>(forwardStart+effectiveLengthOfTheContractAfterStart)*(forwardStart+effectiveLengthOfTheContractAfterStart)
00271                         -<a class="code" href="classyieldCurve.html#a8">spotRate</a>(forwardStart)*forwardStart)/effectiveLengthOfTheContractAfterStart;
00272         <span class="keywordflow">default</span>:
00273                 <span class="keywordflow">return</span> (<a class="code" href="types_8h.html#a10">Real</a>) (<a class="code" href="classyieldCurve.html#a8">spotRate</a>(forwardStart+effectiveLengthOfTheContractAfterStart)*(forwardStart+effectiveLengthOfTheContractAfterStart)
00274                         -<a class="code" href="classyieldCurve.html#a8">spotRate</a>(forwardStart)*forwardStart)/effectiveLengthOfTheContractAfterStart;
00275         }
00276 
00277 }
00278 
<a name="l00279"></a><a class="code" href="classyieldCurve.html#a17">00279</a> <a class="code" href="classyieldCurve.html">yieldCurve</a> <a class="code" href="classyieldCurve.html#a17">yieldCurve::forwardZCBCurve</a>(<a class="code" href="types_8h.html#a10">Real</a> forwardStart){
00280         valarray&lt;yieldPoint&gt; fwdPts(<a class="code" href="classyieldCurve.html#r1">_zcbRates</a>);
00281         <a class="code" href="types_8h.html#a7">Natural</a> i=0,size=fwdPts.size(),start;
00282         <span class="keywordflow">while</span>(i&lt;size &amp;&amp; forwardStart&gt;=<a class="code" href="classyieldCurve.html#r1">_zcbRates</a>[i].getRate())
00283                 i++;
00284         <span class="keywordflow">if</span>(i==size) <span class="comment">//fwd term too high</span>
00285                 <span class="keywordflow">return</span> <a class="code" href="classyieldCurve.html#a0">yieldCurve</a>();
00286         <span class="keywordflow">else</span>{
00287                 start=i;
00288                 fwdPts.resize(size-start);
00289                 <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i=start;i&lt;fwdPts.size();i++){
00290                         fwdPts[i-start].setRate(<a class="code" href="classyieldCurve.html#a15">forwardRate</a>(forwardStart,_zcbRates[i].getMaturity()-forwardStart));
00291                         fwdPts[i-start].setMaturity(_zcbRates[i].getMaturity()-forwardStart);
00292                 }
00293                 <span class="keywordflow">return</span> <a class="code" href="classyieldCurve.html#a0">yieldCurve</a>(fwdPts,<span class="stringliteral">"forwardCurve"</span>);
00294         }
00295 
00296 }
00297 
<a name="l00298"></a><a class="code" href="classyieldCurve.html#a16">00298</a> <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="classyieldCurve.html#a15">yieldCurve::forwardRate</a>(<a class="code" href="classDate.html">Date</a> forwardStart,<a class="code" href="classDate.html">Date</a> forwardEnd,interestComposition composition){
00299         <a class="code" href="classDate.html">Date</a> today=<a class="code" href="classDate.html">Date</a>();
00300         today.<a class="code" href="classDate.html#a13">setDateToToday</a>(); 
00301         <span class="keywordflow">return</span> <a class="code" href="classyieldCurve.html#a15">forwardRate</a>(today.<a class="code" href="classDate.html#a36">dayCount</a>(forwardStart,<a class="code" href="date_8h.html#a48a42">Day30_360</a>),forwardStart.<a class="code" href="classDate.html#a36">dayCount</a>(forwardEnd,<a class="code" href="date_8h.html#a48a42">Day30_360</a>),composition);
00302 }
00303 
00304 
<a name="l00305"></a><a class="code" href="classyieldCurve.html#d6">00305</a> valarray&lt;Real&gt; <a class="code" href="classyieldCurve.html#d6">yieldCurve::SequentDiscountFactorsByInvertSwapMatrix</a>()
00306 {
00307         valarray&lt;yieldPoint&gt; tempstorage(<a class="code" href="classyieldCurve.html#d4">getSequentSwapRates</a>());
00308 
00309         <a class="code" href="types_8h.html#a7">Natural</a> size = tempstorage.size();
00310         <a class="code" href="classMatrix.html">Matrix</a> *<a class="code" href="MersenneTwister_8cpp.html#a1">M</a>= <span class="keyword">new</span> <a class="code" href="classMatrix.html">Matrix</a> (0.0,size,size);
00311         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i=0; i &lt; size; i++)  
00312         {
00313                 <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> j=0; j&lt;size; j++)
00314                 {
00315                         <span class="keywordflow">if</span>(i==j) 
00316                                 <a class="code" href="MersenneTwister_8cpp.html#a1">M</a>-&gt;SetValue(i,j,1+tempstorage[i].getRate()); <span class="comment">// diagonals are 1 + s(i)</span>
00317                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i&gt;j)
00318                                 <a class="code" href="MersenneTwister_8cpp.html#a1">M</a>-&gt;SetValue(i,j,tempstorage[i].getRate()); <span class="comment">// inferior triangle are s(i)</span>
00319                         <span class="keywordflow">else</span>
00320                                 <a class="code" href="MersenneTwister_8cpp.html#a1">M</a>-&gt;SetValue(i,j,0); <span class="comment">// superior triangle are 0</span>
00321                 }
00322         }
00323         <a class="code" href="MersenneTwister_8cpp.html#a1">M</a>-&gt;Invert();<span class="comment">//M now contains the invert of the swap formatted matrix</span>
00324         valarray&lt;Real&gt; res(size);
00325         <span class="keywordflow">for</span>(i=0;i&lt;size;i++){
00326                 res[i]=<a class="code" href="MersenneTwister_8cpp.html#a1">M</a>-&gt;SumRow (i);
00327         }
00328         <span class="keyword">delete</span> <a class="code" href="MersenneTwister_8cpp.html#a1">M</a>;
00329 
00330         <span class="keywordflow">return</span> res;
00331 }
00332 
<a name="l00333"></a><a class="code" href="classyieldCurve.html#a9">00333</a> valarray&lt;Real&gt; <a class="code" href="classyieldCurve.html#a9">yieldCurve::getMaturitiesInTheMarketCurve</a>()<span class="keyword"> const</span>
00334 <span class="keyword"></span>{
00335         <a class="code" href="types_8h.html#a7">Natural</a> size=<a class="code" href="classyieldCurve.html#r0">_marketRates</a>.size();
00336         valarray&lt;Real&gt; maturities(size);
00337         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;size;i++){
00338                 maturities[i]=<a class="code" href="classyieldCurve.html#r0">_marketRates</a>[i].getMaturity();
00339         }
00340         <span class="keywordflow">return</span> maturities;
00341 }
00342 
<a name="l00343"></a><a class="code" href="classyieldCurve.html#a10">00343</a> valarray&lt;Real&gt; <a class="code" href="classyieldCurve.html#a10">yieldCurve::getMaturitiesInTheZCBCurve</a>()<span class="keyword"> const</span>
00344 <span class="keyword"></span>{
00345         <a class="code" href="types_8h.html#a7">Natural</a> size= <a class="code" href="classyieldCurve.html#r1">_zcbRates</a>.size();
00346         valarray&lt;Real&gt; maturities(size);
00347         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;size;i++){
00348                 maturities[i]=<a class="code" href="classyieldCurve.html#r1">_zcbRates</a>[i].getMaturity();
00349         }
00350         <span class="keywordflow">return</span> maturities;
00351 }
00352 
00353 
<a name="l00354"></a><a class="code" href="classyieldCurve.html#d5">00354</a> <span class="keywordtype">void</span> <a class="code" href="classyieldCurve.html#d5">yieldCurve::computeZCBRatesBootstrap</a>()
00355 {
00356     <a class="code" href="classyieldCurve.html#r1">_zcbRates</a>=<a class="code" href="classyieldCurve.html#r0">_marketRates</a>;
00357         
00358         <span class="keywordflow">if</span>(_marketRates[_marketRates.size()-1].getType()!=<a class="code" href="yieldCurve_8h.html#a9a6">Cash</a>){
00359                 <span class="comment">// if the last rate (as it is sorted) of the mkt is a cash rate, then it means that all the curve is already ZCB'd</span>
00360                 valarray&lt;Real&gt; DFs(<a class="code" href="classyieldCurve.html#d6">SequentDiscountFactorsByInvertSwapMatrix</a>());
00361                 <a class="code" href="types_8h.html#a7">Natural</a> start=0,size = DFs.size();
00362 
00363                 <span class="keywordflow">while</span> (<a class="code" href="classyieldCurve.html#r1">_zcbRates</a>[start].getType()==<a class="code" href="yieldCurve_8h.html#a9a6">Cash</a>) {start ++;}
00364                 start --; <span class="comment">// as 1Y ZC = 1 Y swap</span>
00365                 <a class="code" href="classyieldCurve.html#r1">_zcbRates</a>.resize(size+start);
00366                 <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;size;i++){
00367                         
00368                 
00369                         <span class="comment">//they are 1Y sequent swap rates</span>
00370                         <a class="code" href="classyieldCurve.html#r1">_zcbRates</a>[start+i].setRate((<a class="code" href="types_8h.html#a10">Real</a>)pow(1/DFs[i],1/((<a class="code" href="types_8h.html#a10">Real</a>)(i+1)))-1);<span class="comment">// Rm = (1/DFm)^(1/m)</span>
00371                         <a class="code" href="classyieldCurve.html#r1">_zcbRates</a>[start+i].setMaturity((<a class="code" href="types_8h.html#a10">Real</a>)i+1);
00372                         <a class="code" href="classyieldCurve.html#r1">_zcbRates</a>[start+i].setType(<a class="code" href="yieldCurve_8h.html#a9a6">Cash</a>);
00373                 }
00374         }
00375 }
00376 
<a name="l00377"></a><a class="code" href="classyieldCurve.html#a3">00377</a> <span class="keywordtype">void</span> <a class="code" href="classyieldCurve.html#a3">yieldCurve::assignZCBrateAtIndex</a>(<a class="code" href="types_8h.html#a10">Real</a> rate,<a class="code" href="types_8h.html#a7">Natural</a> i){
00378         <span class="keywordflow">if</span> (i&lt;<a class="code" href="classyieldCurve.html#r1">_zcbRates</a>.size())
00379                 <a class="code" href="classyieldCurve.html#r1">_zcbRates</a>[i].setRate(rate); <span class="comment">//else do nothing</span>
00380 }
00381 
<a name="l00382"></a><a class="code" href="classyieldCurve.html#a4">00382</a> <a class="code" href="classyieldCurve.html">yieldCurve</a> <a class="code" href="classyieldCurve.html#a4">yieldCurve::shiftZCBRateCurve</a>(<a class="code" href="types_8h.html#a10">Real</a> shift)
00383 {
00384         <span class="keywordtype">char</span> * name=<span class="keyword">new</span> <span class="keywordtype">char</span>[50];
00385         sprintf (name,<span class="stringliteral">"%f"</span>,shift);
00386         strcat (name,<span class="stringliteral">" shift on the current ZCB curve"</span>);
00387         
00388         <a class="code" href="classyieldCurve.html">yieldCurve</a> resultShifted=<a class="code" href="classyieldCurve.html#a0">yieldCurve</a>(<a class="code" href="classyieldCurve.html#r1">_zcbRates</a>,name);<span class="comment">//new yc to output, already ZCB is good</span>
00389         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;<a class="code" href="classyieldCurve.html#r1">_zcbRates</a>.size();i++)
00390                 resultShifted.<a class="code" href="classyieldCurve.html#a3">assignZCBrateAtIndex</a>(<a class="code" href="classyieldCurve.html#r1">_zcbRates</a>[i].getRate()+shift,i);
00391         <span class="keywordflow">return</span> resultShifted;
00392 }
00393 
<a name="l00399"></a><a class="code" href="classyieldCurve.html#a5">00399</a> <a class="code" href="classyieldCurve.html">yieldCurve</a> <a class="code" href="classyieldCurve.html#a5">yieldCurve::rotateZCBRateCurve</a>(<a class="code" href="types_8h.html#a10">Real</a> moveInShortestRate,<a class="code" href="types_8h.html#a10">Real</a> maturityOfRotation){
00400         <span class="keywordtype">char</span> * name=<span class="keyword">new</span> <span class="keywordtype">char</span>[64];
00401         sprintf (name,<span class="stringliteral">"%f"</span>,moveInShortestRate);
00402         strcat (name,<span class="stringliteral">" move on short rate and rotation around 7Y"</span>);
00403         
00404         <a class="code" href="classyieldCurve.html">yieldCurve</a> resultRotated=<a class="code" href="classyieldCurve.html#a0">yieldCurve</a>(<a class="code" href="classyieldCurve.html#r1">_zcbRates</a>,name);<span class="comment">//new yc to output, already ZCB is good</span>
00405         <a class="code" href="types_8h.html#a10">Real</a> move=0.;
00406         <a class="code" href="types_8h.html#a10">Real</a> difmat=<a class="code" href="classyieldCurve.html#r1">_zcbRates</a>[0].getMaturity()-min(2*maturityOfRotation,_zcbRates[_zcbRates.size()-1].getMaturity()); <span class="comment">// &lt;0</span>
00407         <a class="code" href="types_8h.html#a10">Real</a> summat=_zcbRates[0].getMaturity()+min(2*maturityOfRotation,_zcbRates[_zcbRates.size()-1].getMaturity());
00408         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i=0;i&lt;_zcbRates.size();i++){
00409                 move= (moveInShortestRate/difmat)*(2*_zcbRates[i].getMaturity()-summat);
00410                 resultRotated.<a class="code" href="classyieldCurve.html#a3">assignZCBrateAtIndex</a>(_zcbRates[i].getRate()+move,i);
00411         }
00412         <span class="keywordflow">return</span> resultRotated;   
00413 }
00414 
00422 <span class="keywordtype">bool</span>
<a name="l00423"></a><a class="code" href="classyieldCurve.html#a19">00423</a> <a class="code" href="classyieldCurve.html#a19">yieldCurve::operator==</a>(<span class="keyword">const</span> <a class="code" href="classyieldCurve.html">yieldCurve</a>&amp; yours) {
00424         <span class="keywordtype">bool</span> result = <span class="keyword">true</span>;
00425 
00426         valarray&lt;Real&gt; myMaturities =
00427                 <a class="code" href="classyieldCurve.html#a10">getMaturitiesInTheZCBCurve</a>();
00428         valarray&lt;Real&gt; yourMaturities =
00429                 yours.<a class="code" href="classyieldCurve.html#a10">getMaturitiesInTheZCBCurve</a>();
00430         valarray&lt;Real&gt; termValues = 
00431                 <a class="code" href="utils_8h.html#a6">mergeunique</a>(myMaturities, yourMaturities);
00432         <a class="code" href="types_8h.html#a7">Natural</a> numTermValues = termValues.size();
00433 
00434         <a class="code" href="types_8h.html#a10">Real</a> <a class="code" href="ParkMiller_8h.html#a1">m</a> = 0;
00435         <a class="code" href="types_8h.html#a10">Real</a> y = 0;
00436         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i = 0; (i &lt; numTermValues) &amp;&amp; result; i++) {
00437                 <a class="code" href="ParkMiller_8h.html#a1">m</a> = <a class="code" href="classyieldCurve.html#a8">spotRate</a>(termValues[i]);
00438                 y = yours.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(termValues[i]);
00439 
00440                 <span class="comment">// if difference is &gt; .1 basis Points we say they are not equal</span>
00441                 <span class="comment">// (a function of precision in the input file)</span>
00442                 <span class="keywordflow">if</span> (fabs(<a class="code" href="ParkMiller_8h.html#a1">m</a> - y) &gt; 0.00001) {
00443                         cout &lt;&lt; <span class="stringliteral">"mismatch m: "</span> &lt;&lt; <a class="code" href="ParkMiller_8h.html#a1">m</a> &lt;&lt; <span class="stringliteral">" y: "</span> &lt;&lt; y &lt;&lt; endl;
00444                         result &amp;= <span class="keyword">false</span>;
00445                 }
00446         }
00447 
00448         <span class="keywordflow">return</span> result;
00449 }
00450 
00451 <span class="keywordtype">bool</span>
<a name="l00452"></a><a class="code" href="classyieldCurve.html#a20">00452</a> <a class="code" href="classyieldCurve.html#a20">yieldCurve::operator!=</a>(<span class="keyword">const</span> <a class="code" href="classyieldCurve.html">yieldCurve</a>&amp; yours) {
00453         <span class="keywordflow">return</span> !<a class="code" href="classyieldCurve.html#a19">operator==</a>(yours);
00454 }
00455 
00456 ostream&amp; 
<a name="l00457"></a><a class="code" href="yieldCurve_8cpp.html#a0">00457</a> <a class="code" href="convertiblebond_8cpp.html#a0">operator &lt;&lt; </a>(ostream &amp;os, <span class="keyword">const</span> <a class="code" href="classyieldCurve.html">yieldCurve</a> &amp;c) {
00458         valarray&lt;Real&gt; myMaturities = 
00459                 c.<a class="code" href="classyieldCurve.html#a10">getMaturitiesInTheZCBCurve</a>();
00460         <a class="code" href="types_8h.html#a7">Natural</a> numTermValues = myMaturities.size();
00461 
00462         <span class="keywordflow">for</span> (<a class="code" href="types_8h.html#a7">Natural</a> i = 0; i &lt; numTermValues; i++) {
00463                 os &lt;&lt; myMaturities[i] &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; c.<a class="code" href="classyieldCurve.html#a8">spotRate</a>(myMaturities[i]) &lt;&lt; endl;
00464         }
00465 
00466         <span class="keywordflow">return</span> os;
00467 }
00468   
00469 
</pre></div><hr size="1"><address style="align: right;"><small>
<b>Note: Generated nightly - reload for latest version</b><br>
Generated on Thu Dec 22 13:21:45 2005 for <a href="http://terreneuve.sourceforge.net">terreneuve</a> by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.3.6</small></address>
</body>
</html>
