<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>convertiblebond.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>convertiblebond.cpp</h1><a href="convertiblebond_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include ".\convertiblebond.h"</span>
00002 <span class="preprocessor">#include ".\binomialTree.h"</span>
00003 <span class="preprocessor">#include "../PartA/MonteCarlo1/PayOff.h"</span>
00004 
<a name="l00005"></a><a class="code" href="classconvertiblebond.html#a0">00005</a> <a class="code" href="classconvertiblebond.html#a0">convertiblebond::convertiblebond</a>(<a class="code" href="classasset.html">asset</a> Stock, 
00006                                                                  <a class="code" href="classriskybond.html">riskybond</a> Bond, 
00007                                                                  <a class="code" href="types_8h.html#a10">Real</a> conversionRatio, 
00008                                                                  <a class="code" href="types_8h.html#a7">Natural</a> nSteps, 
00009                                                                  <a class="code" href="types_8h.html#a10">Real</a> callPrice, 
00010                                                                  <a class="code" href="types_8h.html#a10">Real</a> putPrice) :
00011 <a class="code" href="classriskybond.html">riskybond</a>(Bond), 
00012 _bond(Bond),
00013 _stock(Stock), 
00014 _conversionRatio(conversionRatio), 
00015 _n(nSteps), 
00016 _callPrice(callPrice), 
00017 _putPrice(putPrice) {
00018         <a class="code" href="classconvertiblebond.html#r7">_priceCached</a> = 
00019                 <a class="code" href="classconvertiblebond.html#r10">_deltaCached</a> = 
00020                 <a class="code" href="classconvertiblebond.html#r13">_interestRateDeltaCached</a> = 
00021                 <a class="code" href="classconvertiblebond.html#r16">_gammaCached</a> = 
00022                 <a class="code" href="classconvertiblebond.html#p1">_btCached</a> =
00023                 <span class="keyword">false</span>;
00024 
00025         <span class="comment">// cout &lt;&lt; "DEBUG convertible underlying yc: " &lt;&lt; _yc &lt;&lt; endl;</span>
00026         <span class="comment">// cout &lt;&lt; "issue: " &lt;&lt; _issue.toString() &lt;&lt; " maturity: " &lt;&lt; _maturity.toString() &lt;&lt; endl;;</span>
00027 }
00028 
<a name="l00029"></a><a class="code" href="classconvertiblebond.html#a1">00029</a> <a class="code" href="classconvertiblebond.html#a1">convertiblebond::~convertiblebond</a>(<span class="keywordtype">void</span>) { 
00030 }
00031 
00032 <a class="code" href="types_8h.html#a10">Real</a>
<a name="l00033"></a><a class="code" href="classconvertiblebond.html#a2">00033</a> <a class="code" href="classconvertiblebond.html#a3">convertiblebond::fairvalue</a>(<a class="code" href="classDate.html">Date</a> today){
00034         <span class="keywordflow">if</span> ((<a class="code" href="classconvertiblebond.html#r7">_priceCached</a>) &amp;&amp; (<a class="code" href="classconvertiblebond.html#r8">_datepriceCached</a> == today)) {
00035                 <span class="keywordflow">return</span> _price;
00036         }
00037 
00038         <span class="keywordflow">if</span> (<a class="code" href="classconvertiblebond.html#p1">_btCached</a>) {
00039                 <span class="keyword">delete</span> <a class="code" href="classconvertiblebond.html#p0">_bt</a>;
00040         }
00041         <a class="code" href="classconvertiblebond.html#p0">_bt</a> = 
00042                 <span class="keyword">new</span> <a class="code" href="classbinomialTree.html">binomialTree</a>(<a class="code" href="classconvertiblebond.html#r0">_stock</a>, 
00043                 _yc, <a class="code" href="classbond.html#a15">getMaturityInYears</a>(today), _n);
00044         <a class="code" href="classPayOff.html">PayOff</a> *payoff = 
00045                 <span class="keyword">new</span> <a class="code" href="classPayOff.html">PayOff</a>();
00046 
00047         <a class="code" href="classconvertiblebond.html#p0">_bt</a>-&gt;<a class="code" href="classbinomialTree.html#a10">runEngineConvertibleBond</a>(*payoff, 
00048                 <a class="code" href="classconvertiblebond.html#r5">_conversionRatio</a> / <a class="code" href="classbond.html#a17">getFaceAmount</a>() * 100, 
00049                 <a class="code" href="classconvertiblebond.html#r3">_callPrice</a>, 
00050                 <a class="code" href="classconvertiblebond.html#r4">_putPrice</a>);
00051 
00052         <a class="code" href="classconvertiblebond.html#p1">_btCached</a> = <span class="keyword">true</span>;
00053 
00054         <span class="comment">// cout &lt;&lt; "DEBUG convertible pricing tree: " &lt;&lt; endl &lt;&lt; _bt &lt;&lt; endl;</span>
00055 
00056         <span class="keyword">const</span> valarray&lt;Real&gt; *prices = <a class="code" href="classconvertiblebond.html#p0">_bt</a>-&gt;<a class="code" href="classbinomialTree.html#a8">getClaimProcess</a>(0);
00057         _price = (*prices)[0];
00058         <a class="code" href="classconvertiblebond.html#r7">_priceCached</a> = <span class="keyword">true</span>;
00059         <a class="code" href="classconvertiblebond.html#r8">_datepriceCached</a> = today;
00060 
00061         <span class="keywordflow">return</span> _price;
00062 }
00063 
00064 <a class="code" href="types_8h.html#a10">Real</a>
<a name="l00065"></a><a class="code" href="classconvertiblebond.html#a7">00065</a> <a class="code" href="classconvertiblebond.html#a6">convertiblebond::delta</a>(<a class="code" href="classDate.html">Date</a> today)<span class="keyword"> const </span>{
00066         <span class="keywordflow">if</span> ((<a class="code" href="classconvertiblebond.html#r10">_deltaCached</a>) &amp;&amp; (<a class="code" href="classconvertiblebond.html#r11">_datedeltaCached</a> == today)) {
00067                 <span class="keywordflow">return</span> <a class="code" href="classconvertiblebond.html#r9">_delta</a>;
00068         }
00069 
00070         <span class="comment">// create a new convertible bond with delta stock price</span>
00071         <a class="code" href="types_8h.html#a10">Real</a> So = <a class="code" href="classconvertiblebond.html#r0">_stock</a>.<a class="code" href="classasset.html#a11">getPrice</a>();
00072         <span class="comment">// workaround to preserve const-correctness</span>
00073         <a class="code" href="types_8h.html#a10">Real</a> price = const_cast&lt;convertiblebond *&gt;(<span class="keyword">this</span>)-&gt;fairvalue(today);
00074         <a class="code" href="types_8h.html#a10">Real</a> Soplus = So * (1 + 0.01);
00075         <a class="code" href="classasset.html">asset</a> *stockDelta = <span class="keyword">new</span> <a class="code" href="classasset.html">asset</a>(Soplus, <a class="code" href="classconvertiblebond.html#r0">_stock</a>.<a class="code" href="classasset.html#a17">GetVolatility</a>());
00076         
00077         <span class="comment">// instantiate a new convertiblebond</span>
00078         <a class="code" href="classconvertiblebond.html">convertiblebond</a> *cbDelta = 
00079                 <span class="keyword">new</span> <a class="code" href="classconvertiblebond.html#a0">convertiblebond</a>(*stockDelta,
00080                 <a class="code" href="classconvertiblebond.html#r1">_bond</a>, 
00081                 <a class="code" href="classconvertiblebond.html#r5">_conversionRatio</a>, 
00082                 _n, 
00083                 <a class="code" href="classconvertiblebond.html#r3">_callPrice</a>, 
00084                 <a class="code" href="classconvertiblebond.html#r4">_putPrice</a>);
00085 
00086         <a class="code" href="types_8h.html#a10">Real</a> priceplus = cbDelta-&gt;<a class="code" href="classconvertiblebond.html#a2">fairvalue</a>(today);
00087         
00088         <a class="code" href="classconvertiblebond.html#r9">_delta</a> = (priceplus - price)/(Soplus - So);
00089         <a class="code" href="classconvertiblebond.html#r10">_deltaCached</a> = <span class="keyword">true</span>;
00090         <a class="code" href="classconvertiblebond.html#r11">_datedeltaCached</a> = today;
00091 
00092         <span class="keyword">delete</span> cbDelta;
00093         <span class="keyword">delete</span> stockDelta;
00094 
00095         <span class="keywordflow">return</span> <a class="code" href="classconvertiblebond.html#r9">_delta</a>;
00096 }
00097 
00098 <a class="code" href="classconvertiblebond.html">convertiblebond</a>
<a name="l00099"></a><a class="code" href="classconvertiblebond.html#a10">00099</a> <a class="code" href="classconvertiblebond.html#a10">convertiblebond::shiftedcbond</a>(<a class="code" href="types_8h.html#a10">Real</a> shift) {
00100         <a class="code" href="classriskybond.html">riskybond</a> shiftedrbond = <a class="code" href="classconvertiblebond.html#r1">_bond</a>.<a class="code" href="classriskybond.html#a4">shiftedbond</a>(shift);
00101         <a class="code" href="classconvertiblebond.html">convertiblebond</a> <a class="code" href="classconvertiblebond.html#a10">shiftedcbond</a> = 
00102                 <a class="code" href="classconvertiblebond.html#a0">convertiblebond</a>(<a class="code" href="classconvertiblebond.html#r0">_stock</a>, shiftedrbond, <a class="code" href="classconvertiblebond.html#r5">_conversionRatio</a>, _n, <a class="code" href="classconvertiblebond.html#r3">_callPrice</a>, <a class="code" href="classconvertiblebond.html#r4">_putPrice</a>);
00103         <span class="keywordflow">return</span> shiftedcbond;
00104 }
00105 
00106 <a class="code" href="types_8h.html#a10">Real</a> 
<a name="l00107"></a><a class="code" href="classconvertiblebond.html#a14">00107</a> <a class="code" href="classconvertiblebond.html#a13">convertiblebond::interestRateDelta</a>(<a class="code" href="classDate.html">Date</a> today)<span class="keyword"> const </span>{
00108         <span class="keywordflow">if</span> ((<a class="code" href="classconvertiblebond.html#r13">_interestRateDeltaCached</a>) &amp;&amp; (<a class="code" href="classconvertiblebond.html#r14">_dateinterestRateDeltaCached</a> == today)) {
00109                 <span class="keywordflow">return</span> <a class="code" href="classconvertiblebond.html#r12">_interestRateDelta</a>;
00110         }
00111 
00112         <a class="code" href="classconvertiblebond.html">convertiblebond</a> cb = 
00113                 const_cast&lt;convertiblebond *&gt;(<span class="keyword">this</span>)-&gt;shiftedcbond(0.001);
00114         <a class="code" href="classconvertiblebond.html#r12">_interestRateDelta</a> = (cb.<a class="code" href="classconvertiblebond.html#a2">fairvalue</a>(today) - 
00115                 const_cast&lt;convertiblebond *&gt;(<span class="keyword">this</span>)-&gt;fairvalue(today))/0.001;
00116         <a class="code" href="classconvertiblebond.html#r13">_interestRateDeltaCached</a> = <span class="keyword">true</span>;
00117         <a class="code" href="classconvertiblebond.html#r14">_dateinterestRateDeltaCached</a> = today;
00118 
00119         <span class="keywordflow">return</span> <a class="code" href="classconvertiblebond.html#r12">_interestRateDelta</a>;
00120 }
00121 
00122 <a class="code" href="types_8h.html#a10">Real</a> 
<a name="l00123"></a><a class="code" href="classconvertiblebond.html#a16">00123</a> <a class="code" href="classconvertiblebond.html#a15">convertiblebond::gamma</a>(<a class="code" href="classDate.html">Date</a> today)<span class="keyword"> const </span>{
00124         <span class="keywordflow">if</span> ((<a class="code" href="classconvertiblebond.html#r16">_gammaCached</a>) &amp;&amp; (<a class="code" href="classconvertiblebond.html#r17">_dategammaCached</a> == today)) {
00125                 <span class="keywordflow">return</span> <a class="code" href="classconvertiblebond.html#r15">_gamma</a>;
00126         }
00127 
00128         <span class="comment">// create a new convertible bond with delta stock price</span>
00129         <a class="code" href="types_8h.html#a10">Real</a> So = <a class="code" href="classconvertiblebond.html#r0">_stock</a>.<a class="code" href="classasset.html#a11">getPrice</a>();
00130         <a class="code" href="types_8h.html#a10">Real</a> deltao = <a class="code" href="classconvertiblebond.html#a6">delta</a>(today);
00131         <a class="code" href="types_8h.html#a10">Real</a> Soplus = So * (1 + 0.01);
00132         <a class="code" href="classasset.html">asset</a> *stockDelta = <span class="keyword">new</span> <a class="code" href="classasset.html">asset</a>(Soplus, <a class="code" href="classconvertiblebond.html#r0">_stock</a>.<a class="code" href="classasset.html#a17">GetVolatility</a>());
00133         
00134         <span class="comment">// instantiate a new convertiblebond</span>
00135         <a class="code" href="classconvertiblebond.html">convertiblebond</a> *cbDelta = 
00136                 <span class="keyword">new</span> <a class="code" href="classconvertiblebond.html#a0">convertiblebond</a>(*stockDelta,
00137                 <a class="code" href="classconvertiblebond.html#r1">_bond</a>, 
00138                 <a class="code" href="classconvertiblebond.html#r5">_conversionRatio</a>, 
00139                 _n, 
00140                 <a class="code" href="classconvertiblebond.html#r3">_callPrice</a>, 
00141                 <a class="code" href="classconvertiblebond.html#r4">_putPrice</a>);
00142 
00143         <a class="code" href="types_8h.html#a10">Real</a> deltaplus = cbDelta-&gt;<a class="code" href="classconvertiblebond.html#a6">delta</a>(today);
00144 
00145         <a class="code" href="classconvertiblebond.html#r15">_gamma</a> = (deltaplus - deltao)/(Soplus - So);
00146         <a class="code" href="classconvertiblebond.html#r16">_gammaCached</a> = <span class="keyword">true</span>;
00147         <a class="code" href="classconvertiblebond.html#r17">_dategammaCached</a> = today;
00148 
00149         <span class="keyword">delete</span> cbDelta;
00150         <span class="keyword">delete</span> stockDelta;
00151 
00152         <span class="keywordflow">return</span> <a class="code" href="classconvertiblebond.html#r15">_gamma</a>;
00153 }
00154 
00155 ostream&amp; 
<a name="l00156"></a><a class="code" href="convertiblebond_8cpp.html#a0">00156</a> <a class="code" href="convertiblebond_8cpp.html#a0">operator &lt;&lt; </a>(ostream &amp;os, <a class="code" href="classconvertiblebond.html">convertiblebond</a> &amp;cb) {
00157         os &lt;&lt; <span class="stringliteral">"convertible bond - price: "</span> &lt;&lt; cb.<a class="code" href="classconvertiblebond.html#a2">fairvalue</a>() &lt;&lt; endl;
00158         os &lt;&lt; <span class="stringliteral">" issue: "</span> &lt;&lt; cb.<a class="code" href="classbond.html#p0">_issue</a>.<a class="code" href="classDate.html#a37">toString</a>() &lt;&lt; endl;
00159         os &lt;&lt; <span class="stringliteral">" maturity: "</span> &lt;&lt; cb.<a class="code" href="classbond.html#p1">_maturity</a>.<a class="code" href="classDate.html#a37">toString</a>() &lt;&lt; endl;
00160         os &lt;&lt; <span class="stringliteral">" face: "</span> &lt;&lt; cb.<a class="code" href="classbond.html#p5">_faceamount</a> &lt;&lt; endl;
00161         os &lt;&lt; <span class="stringliteral">" stock price: "</span> &lt;&lt; cb.<a class="code" href="classconvertiblebond.html#r0">_stock</a>.<a class="code" href="classasset.html#a11">getPrice</a>() &lt;&lt; endl;
00162         os &lt;&lt; <span class="stringliteral">" stock vol: "</span> &lt;&lt; cb.<a class="code" href="classconvertiblebond.html#r0">_stock</a>.<a class="code" href="classasset.html#a17">GetVolatility</a>() &lt;&lt; endl;
00163         os &lt;&lt; <span class="stringliteral">" conversion ratio: "</span> &lt;&lt; cb.<a class="code" href="classconvertiblebond.html#r5">_conversionRatio</a> &lt;&lt; endl;
00164         os &lt;&lt; <span class="stringliteral">" callprice: "</span>;
00165         <span class="keywordflow">if</span> (cb.<a class="code" href="classconvertiblebond.html#r3">_callPrice</a> == <a class="code" href="convertiblebond_8h.html#a9">CB_DEFAULT_CALLPRICE</a>) {
00166                 os &lt;&lt; <span class="stringliteral">"n/a"</span> &lt;&lt; endl;
00167         } <span class="keywordflow">else</span> {
00168                 os &lt;&lt; cb.<a class="code" href="classconvertiblebond.html#r3">_callPrice</a> &lt;&lt; endl;
00169         }
00170         os &lt;&lt; <span class="stringliteral">" putprice: "</span>;
00171         <span class="keywordflow">if</span> (cb.<a class="code" href="classconvertiblebond.html#r4">_putPrice</a> == <a class="code" href="convertiblebond_8h.html#a10">CB_DEFAULT_PUTPRICE</a>) {
00172                 os &lt;&lt; <span class="stringliteral">"n/a"</span> &lt;&lt; endl;
00173         } <span class="keywordflow">else</span> {
00174                 os &lt;&lt; cb.<a class="code" href="classconvertiblebond.html#r4">_putPrice</a> &lt;&lt; endl;
00175         }
00176         os &lt;&lt; <span class="stringliteral">" nsteps: "</span> &lt;&lt; cb.<a class="code" href="classconvertiblebond.html#r2">_n</a> &lt;&lt; endl;
00177         os &lt;&lt; <span class="stringliteral">" delta: "</span> &lt;&lt; cb.<a class="code" href="classconvertiblebond.html#a6">delta</a>() &lt;&lt; endl;
00178         os &lt;&lt; <span class="stringliteral">" paritydelta: "</span> &lt;&lt; cb.<a class="code" href="classconvertiblebond.html#a8">parityDelta</a>() &lt;&lt; endl;
00179         os &lt;&lt; <span class="stringliteral">" interestratedelta: "</span> &lt;&lt; cb.<a class="code" href="classconvertiblebond.html#a13">interestRateDelta</a>() &lt;&lt; endl;
00180         os &lt;&lt; <span class="stringliteral">" gamma: "</span> &lt;&lt; cb.<a class="code" href="classconvertiblebond.html#a15">gamma</a>() &lt;&lt; endl;
00181         os &lt;&lt; <span class="stringliteral">" paritygamma: "</span> &lt;&lt; cb.<a class="code" href="classconvertiblebond.html#a17">parityGamma</a>() &lt;&lt; endl;
00182         <span class="keywordflow">if</span> (cb.<a class="code" href="classconvertiblebond.html#p1">_btCached</a>) {
00183                 os &lt;&lt; <span class="stringliteral">" underlying binomial tree: "</span> &lt;&lt; endl;
00184                 os &lt;&lt; cb.<a class="code" href="classconvertiblebond.html#p0">_bt</a> &lt;&lt; endl;
00185         }
00186 
00187         <span class="keywordflow">return</span> os;
00188 }
</pre></div><hr size="1"><address style="align: right;"><small>
<b>Note: Generated nightly - reload for latest version</b><br>
Generated on Thu Dec 22 13:21:43 2005 for <a href="http://terreneuve.sourceforge.net">terreneuve</a> by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.3.6</small></address>
</body>
</html>
